<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Matrix: cs_utils.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>cs_utils.c</h1>  </div>
</div>
<div class="contents">
<a href="cs__utils_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;<a class="code" href="cs__utils_8h.html">cs_utils.h</a>&quot;</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">/* Borrowed from one of Tim Davis&#39; examples in the CSparse Demo directory */</span>
<a name="l00004"></a>00004 <span class="comment">/* 1 if A is square &amp; upper tri., -1 if square &amp; lower tri., 0 otherwise */</span>
<a name="l00005"></a><a class="code" href="cs__utils_8c.html#a0b2592041f5b822459b7052a451c07a5">00005</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="cs__utils_8c.html#a0b2592041f5b822459b7052a451c07a5">is_sym</a> (<a class="code" href="structcs__sparse.html">cs</a> *A)
<a name="l00006"></a>00006 {
<a name="l00007"></a>00007     <span class="keywordtype">int</span> is_upper, is_lower, j, p, n = A-&gt;<a class="code" href="structcs__sparse.html#a86c18870dc1551c71f8ea551efe68625">n</a>, m = A-&gt;<a class="code" href="structcs__sparse.html#a8aeba3ffed4d599a4906e78329d3448b">m</a>, *Ap = A-&gt;<a class="code" href="structcs__sparse.html#a263a2347e8dcf1a7a20ee66730297b85">p</a>, *Ai = A-&gt;<a class="code" href="structcs__sparse.html#aeb6831b93f8a901b4a5d520c46990f44">i</a> ;
<a name="l00008"></a>00008     <span class="keywordflow">if</span> (m != n) <span class="keywordflow">return</span> (0) ;
<a name="l00009"></a>00009     is_upper = 1 ;
<a name="l00010"></a>00010     is_lower = 1 ;
<a name="l00011"></a>00011     <span class="keywordflow">for</span> (j = 0 ; j &lt; n ; j++)
<a name="l00012"></a>00012     {
<a name="l00013"></a>00013         <span class="keywordflow">for</span> (p = Ap [j] ; p &lt; Ap [j+1] ; p++)
<a name="l00014"></a>00014         {
<a name="l00015"></a>00015             <span class="keywordflow">if</span> (Ai [p] &gt; j) is_upper = 0 ;
<a name="l00016"></a>00016             <span class="keywordflow">if</span> (Ai [p] &lt; j) is_lower = 0 ;
<a name="l00017"></a>00017         }
<a name="l00018"></a>00018     }
<a name="l00019"></a>00019     <span class="keywordflow">return</span> (is_upper ? 1 : (is_lower ? -1 : 0)) ;
<a name="l00020"></a>00020 }
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 
<a name="l00031"></a><a class="code" href="cs__utils_8c.html#a3f4422610da1a3e9e7268e1843ca6de5">00031</a> <span class="keyword">static</span> <a class="code" href="structcs__sparse.html">CSP</a> <a class="code" href="cs__utils_8c.html#a3f4422610da1a3e9e7268e1843ca6de5" title="Create an identity matrix of size n as a cs struct.">csp_eye</a>(<span class="keywordtype">int</span> n)
<a name="l00032"></a>00032 {
<a name="l00033"></a>00033     <a class="code" href="structcs__sparse.html">CSP</a> eye = <a class="code" href="cs_8c.html#aad3a584d9185a4fe4497a36f892b9c72">cs_spalloc</a>(n, n, n, 1, 0);
<a name="l00034"></a>00034     <span class="keywordtype">int</span> *ep = eye-&gt;<a class="code" href="structcs__sparse.html#a263a2347e8dcf1a7a20ee66730297b85">p</a>, *ei = eye-&gt;<a class="code" href="structcs__sparse.html#aeb6831b93f8a901b4a5d520c46990f44">i</a>;
<a name="l00035"></a>00035     <span class="keywordtype">double</span> *ex = eye-&gt;<a class="code" href="structcs__sparse.html#a0d6d06e4893a7d4d86e94ce49358d9c1">x</a>;
<a name="l00036"></a>00036 
<a name="l00037"></a>00037     <span class="keywordflow">if</span> (n &lt;= 0) error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;csp_eye argument n must be positive&quot;</span>));
<a name="l00038"></a>00038     eye-&gt;<a class="code" href="structcs__sparse.html#a707363d7869d3fc4126027c1c9c7cf7c">nz</a> = -1;               <span class="comment">/* compressed column storage */</span>
<a name="l00039"></a>00039     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; n; j++) {
<a name="l00040"></a>00040         ep[j] = ei[j] = j;
<a name="l00041"></a>00041         ex[j] = 1;
<a name="l00042"></a>00042     }
<a name="l00043"></a>00043     eye-&gt;<a class="code" href="structcs__sparse.html#aab49fc365ddf6273376a96d3a6aa751f">nzmax</a> = ep[n] = n;
<a name="l00044"></a>00044     <span class="keywordflow">return</span> eye;
<a name="l00045"></a>00045 }
<a name="l00046"></a>00046 
<a name="l00061"></a><a class="code" href="cs__utils_8c.html#ae015ca3e4a6c1b3a7265208ab035a1c7">00061</a> <a class="code" href="structcs__sparse.html">cs</a> *<a class="code" href="cs__utils_8c.html#ae015ca3e4a6c1b3a7265208ab035a1c7" title="Create a cs object with the contents of x.">Matrix_as_cs</a>(<a class="code" href="structcs__sparse.html">cs</a> *ans, SEXP x, Rboolean check_Udiag)
<a name="l00062"></a>00062 {
<a name="l00063"></a>00063     <span class="keywordtype">char</span> *valid[] = {<span class="stringliteral">&quot;dgCMatrix&quot;</span>, <span class="stringliteral">&quot;dtCMatrix&quot;</span>, <span class="stringliteral">&quot;&quot;</span>};
<a name="l00064"></a>00064     <span class="comment">/* had also &quot;dsCMatrix&quot;, but that only stores one triangle */</span>
<a name="l00065"></a>00065     <span class="keywordtype">int</span> *dims, ctype = <a class="code" href="Mutils_8c.html#a8ed2ff2e1a0de240a9c5b5a617f46838" title="Return the 0-based index of an is() match in a vector of class-name strings terminated by an empty st...">Matrix_check_class_etc</a>(x, valid);
<a name="l00066"></a>00066     SEXP islot;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068     <span class="keywordflow">if</span> (ctype &lt; 0) error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;invalid class of &#39;x&#39; in Matrix_as_cs(a, x)&quot;</span>));
<a name="l00069"></a>00069                                 <span class="comment">/* dimensions and nzmax */</span>
<a name="l00070"></a>00070     dims = INTEGER(GET_SLOT(x, <a class="code" href="Syms_8h.html#a2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>));
<a name="l00071"></a>00071     ans-&gt;<a class="code" href="structcs__sparse.html#a8aeba3ffed4d599a4906e78329d3448b">m</a> = dims[0]; ans-&gt;<a class="code" href="structcs__sparse.html#a86c18870dc1551c71f8ea551efe68625">n</a> = dims[1];
<a name="l00072"></a>00072     islot = GET_SLOT(x, <a class="code" href="Syms_8h.html#a900b6b19a8e80b529c1a26eb9fb6156d">Matrix_iSym</a>);
<a name="l00073"></a>00073     ans-&gt;<a class="code" href="structcs__sparse.html#a707363d7869d3fc4126027c1c9c7cf7c">nz</a> = -1;               <span class="comment">/* indicates compressed column storage */</span>
<a name="l00074"></a>00074     ans-&gt;<a class="code" href="structcs__sparse.html#aab49fc365ddf6273376a96d3a6aa751f">nzmax</a> = LENGTH(islot);
<a name="l00075"></a>00075     ans-&gt;<a class="code" href="structcs__sparse.html#aeb6831b93f8a901b4a5d520c46990f44">i</a> = INTEGER(islot);
<a name="l00076"></a>00076     ans-&gt;<a class="code" href="structcs__sparse.html#a263a2347e8dcf1a7a20ee66730297b85">p</a> = INTEGER(GET_SLOT(x, <a class="code" href="Syms_8h.html#af08cd6c75b2da4b71c2eb605e00e94ab">Matrix_pSym</a>));
<a name="l00077"></a>00077     ans-&gt;<a class="code" href="structcs__sparse.html#a0d6d06e4893a7d4d86e94ce49358d9c1">x</a> = REAL(GET_SLOT(x, <a class="code" href="Syms_8h.html#a8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>));
<a name="l00078"></a>00078 
<a name="l00079"></a>00079     <span class="keywordflow">if</span>(check_Udiag &amp;&amp; ctype == 1 &amp;&amp; (*<a class="code" href="Mutils_8h.html#a1e1f224c5e72ee3eb2583024db2c59e6">diag_P</a>(x) == <span class="charliteral">&#39;U&#39;</span>)) { <span class="comment">/* diagU2N(.) : */</span>
<a name="l00080"></a>00080         <span class="keywordtype">int</span> n = dims[0];
<a name="l00081"></a>00081         <a class="code" href="structcs__sparse.html">CSP</a> I_n = <a class="code" href="cs__utils_8c.html#a3f4422610da1a3e9e7268e1843ca6de5" title="Create an identity matrix of size n as a cs struct.">csp_eye</a>(n);
<a name="l00082"></a>00082 
<a name="l00083"></a>00083         <span class="comment">/* tmp := 1*ans + 1*eye -- result is newly allocated in cs_add(): */</span>
<a name="l00084"></a>00084         <a class="code" href="structcs__sparse.html">CSP</a> tmp = <a class="code" href="cs_8c.html#a12000fbd0b9198d3852978cca8386afe">cs_add</a>(ans, I_n, 1., 1.), t2;
<a name="l00085"></a>00085         <span class="keywordtype">int</span> nz = (tmp-&gt;<a class="code" href="structcs__sparse.html#a263a2347e8dcf1a7a20ee66730297b85">p</a>)[n];
<a name="l00086"></a>00086 
<a name="l00087"></a>00087         <span class="comment">/* double transpose trick to sort the columns */</span>
<a name="l00088"></a>00088         <a class="code" href="cs_8c.html#a6d705e404a7831ccf01bc0ea064215b9">cs_spfree</a>(I_n);
<a name="l00089"></a>00089         t2 = <a class="code" href="cs_8c.html#a090225477a18abe5f8d5ab26e4efaf3a">cs_transpose</a>(tmp, 1); <span class="comment">/* transpose including values */</span>
<a name="l00090"></a>00090         <a class="code" href="cs_8c.html#a6d705e404a7831ccf01bc0ea064215b9">cs_spfree</a>(tmp);
<a name="l00091"></a>00091         tmp = <a class="code" href="cs_8c.html#a090225477a18abe5f8d5ab26e4efaf3a">cs_transpose</a>(t2, 1);
<a name="l00092"></a>00092         <a class="code" href="cs_8c.html#a6d705e404a7831ccf01bc0ea064215b9">cs_spfree</a>(t2);
<a name="l00093"></a>00093 
<a name="l00094"></a>00094         <span class="comment">/* content(ans) := content(tmp) : */</span>
<a name="l00095"></a>00095         ans-&gt;<a class="code" href="structcs__sparse.html#aab49fc365ddf6273376a96d3a6aa751f">nzmax</a> = nz;
<a name="l00096"></a>00096         <span class="comment">/* The ans &quot;slots&quot; were pointers to x@ &lt;slots&gt;; all need new content now: */</span>
<a name="l00097"></a>00097         ans-&gt;<a class="code" href="structcs__sparse.html#a263a2347e8dcf1a7a20ee66730297b85">p</a> = Memcpy((   <span class="keywordtype">int</span>*) R_alloc(<span class="keyword">sizeof</span>(   <span class="keywordtype">int</span>), n+1),
<a name="l00098"></a>00098                         (   <span class="keywordtype">int</span>*) tmp-&gt;<a class="code" href="structcs__sparse.html#a263a2347e8dcf1a7a20ee66730297b85">p</a>, n+1);
<a name="l00099"></a>00099         ans-&gt;<a class="code" href="structcs__sparse.html#aeb6831b93f8a901b4a5d520c46990f44">i</a> = Memcpy((   <span class="keywordtype">int</span>*) R_alloc(<span class="keyword">sizeof</span>(   <span class="keywordtype">int</span>), nz),
<a name="l00100"></a>00100                         (   <span class="keywordtype">int</span>*) tmp-&gt;<a class="code" href="structcs__sparse.html#aeb6831b93f8a901b4a5d520c46990f44">i</a>, nz);
<a name="l00101"></a>00101         ans-&gt;<a class="code" href="structcs__sparse.html#a0d6d06e4893a7d4d86e94ce49358d9c1">x</a> = Memcpy((<span class="keywordtype">double</span>*) R_alloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>), nz),
<a name="l00102"></a>00102                         (<span class="keywordtype">double</span>*) tmp-&gt;<a class="code" href="structcs__sparse.html#a0d6d06e4893a7d4d86e94ce49358d9c1">x</a>, nz);
<a name="l00103"></a>00103 
<a name="l00104"></a>00104         <a class="code" href="cs_8c.html#a6d705e404a7831ccf01bc0ea064215b9">cs_spfree</a>(tmp);
<a name="l00105"></a>00105     }
<a name="l00106"></a>00106     <span class="keywordflow">return</span> ans;
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 
<a name="l00119"></a>00119 <span class="comment">/* FIXME:  Change API : May need object,  not just class */</span>
<a name="l00120"></a><a class="code" href="cs__utils_8c.html#ae53880c709c9977b041217226c202deb">00120</a> SEXP <a class="code" href="cs__utils_8c.html#ae53880c709c9977b041217226c202deb" title="Copy the contents of a to an appropriate CsparseMatrix object and, optionally, free a or free both a ...">Matrix_cs_to_SEXP</a>(<a class="code" href="structcs__sparse.html">cs</a> *a, <span class="keywordtype">char</span> *cl, <span class="keywordtype">int</span> dofree)
<a name="l00121"></a>00121 {
<a name="l00122"></a>00122     SEXP ans;
<a name="l00123"></a>00123     <span class="keywordtype">char</span> *valid[] = {<span class="stringliteral">&quot;dgCMatrix&quot;</span>, <span class="stringliteral">&quot;dsCMatrix&quot;</span>, <span class="stringliteral">&quot;dtCMatrix&quot;</span>, <span class="stringliteral">&quot;&quot;</span>};
<a name="l00124"></a>00124     <span class="keywordtype">int</span> *dims, ctype = <a class="code" href="Mutils_8h.html#a2206f293e563a99c83fa8480b7e26912" title="Return the 0-based index of a string match in a vector of strings terminated by an empty string...">Matrix_check_class</a>(cl, valid), nz;
<a name="l00125"></a>00125 
<a name="l00126"></a>00126     <span class="keywordflow">if</span> (ctype &lt; 0)
<a name="l00127"></a>00127         error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;invalid class of object to %s&quot;</span>), <span class="stringliteral">&quot;Matrix_cs_to_SEXP&quot;</span>);
<a name="l00128"></a>00128     ans = PROTECT(NEW_OBJECT(MAKE_CLASS(cl)));
<a name="l00129"></a>00129                                 <span class="comment">/* allocate and copy common slots */</span>
<a name="l00130"></a>00130     dims = INTEGER(<a class="code" href="Mutils_8h.html#af7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and return the SEXP...">ALLOC_SLOT</a>(ans, <a class="code" href="Syms_8h.html#a2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>, INTSXP, 2));
<a name="l00131"></a>00131     dims[0] = a-&gt;<a class="code" href="structcs__sparse.html#a8aeba3ffed4d599a4906e78329d3448b">m</a>; dims[1] = a-&gt;<a class="code" href="structcs__sparse.html#a86c18870dc1551c71f8ea551efe68625">n</a>;
<a name="l00132"></a>00132     Memcpy(INTEGER(<a class="code" href="Mutils_8h.html#af7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and return the SEXP...">ALLOC_SLOT</a>(ans, <a class="code" href="Syms_8h.html#af08cd6c75b2da4b71c2eb605e00e94ab">Matrix_pSym</a>, INTSXP, a-&gt;<a class="code" href="structcs__sparse.html#a86c18870dc1551c71f8ea551efe68625">n</a> + 1)),
<a name="l00133"></a>00133            a-&gt;<a class="code" href="structcs__sparse.html#a263a2347e8dcf1a7a20ee66730297b85">p</a>, a-&gt;<a class="code" href="structcs__sparse.html#a86c18870dc1551c71f8ea551efe68625">n</a> + 1);
<a name="l00134"></a>00134     nz = a-&gt;<a class="code" href="structcs__sparse.html#a263a2347e8dcf1a7a20ee66730297b85">p</a>[a-&gt;<a class="code" href="structcs__sparse.html#a86c18870dc1551c71f8ea551efe68625">n</a>];
<a name="l00135"></a>00135     Memcpy(INTEGER(<a class="code" href="Mutils_8h.html#af7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and return the SEXP...">ALLOC_SLOT</a>(ans, <a class="code" href="Syms_8h.html#a900b6b19a8e80b529c1a26eb9fb6156d">Matrix_iSym</a>, INTSXP, nz)), a-&gt;<a class="code" href="structcs__sparse.html#aeb6831b93f8a901b4a5d520c46990f44">i</a>, nz);
<a name="l00136"></a>00136     Memcpy(REAL(<a class="code" href="Mutils_8h.html#af7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and return the SEXP...">ALLOC_SLOT</a>(ans, <a class="code" href="Syms_8h.html#a8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>, REALSXP, nz)), a-&gt;<a class="code" href="structcs__sparse.html#a0d6d06e4893a7d4d86e94ce49358d9c1">x</a>, nz);
<a name="l00137"></a>00137     <span class="keywordflow">if</span> (ctype &gt; 0) { <span class="comment">/* dsC or dtC */</span>
<a name="l00138"></a>00138         <span class="keywordtype">int</span> uplo = <a class="code" href="cs__utils_8c.html#a0b2592041f5b822459b7052a451c07a5">is_sym</a>(a);
<a name="l00139"></a>00139         <span class="keywordflow">if</span> (!uplo)
<a name="l00140"></a>00140             error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;cs matrix not compatible with class &#39;%s&#39;&quot;</span>), valid[ctype]);
<a name="l00141"></a>00141         <span class="keywordflow">if</span> (ctype == 2) <span class="comment">/* dtC* */</span>
<a name="l00142"></a>00142             SET_SLOT(ans, <a class="code" href="Syms_8h.html#aaaa2d2105381747118da72d6f1aba4e9">Matrix_diagSym</a>, mkString(<span class="stringliteral">&quot;N&quot;</span>));
<a name="l00143"></a>00143         SET_SLOT(ans, <a class="code" href="Syms_8h.html#ac4fa9962123be6abbeaf9c7219b62644">Matrix_uploSym</a>, mkString(uplo &lt; 0 ? <span class="stringliteral">&quot;L&quot;</span> : <span class="stringliteral">&quot;U&quot;</span>));
<a name="l00144"></a>00144     }
<a name="l00145"></a>00145     <span class="keywordflow">if</span> (dofree &gt; 0) <a class="code" href="cs_8c.html#a6d705e404a7831ccf01bc0ea064215b9">cs_spfree</a>(a);
<a name="l00146"></a>00146     <span class="keywordflow">if</span> (dofree &lt; 0) Free(a);
<a name="l00147"></a>00147     UNPROTECT(1);
<a name="l00148"></a>00148     <span class="keywordflow">return</span> ans;
<a name="l00149"></a>00149 }
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 <span class="preprocessor">#if 0                           </span><span class="comment">/* unused ------------------------------------*/</span>
<a name="l00152"></a>00152 <span class="comment">/*  -------------------------------------*/</span>
<a name="l00153"></a>00153 
<a name="l00163"></a>00163 <a class="code" href="structcs__symbolic.html">css</a> *Matrix_as_css(<a class="code" href="structcs__symbolic.html">css</a> *ans, SEXP x)
<a name="l00164"></a>00164 {
<a name="l00165"></a>00165     <span class="keywordtype">char</span> *<a class="code" href="chm__common_8h.html#ac49bea018a4b4cb10cd713589039cdda">cl</a> = <a class="code" href="Mutils_8h.html#ae692d23e2a86a20fccc024b05fc23df9">class_P</a>(x);
<a name="l00166"></a>00166         *valid[] = {<span class="stringliteral">&quot;css_LU&quot;</span>, <span class="stringliteral">&quot;css_QR&quot;</span>, <span class="stringliteral">&quot;&quot;</span>};
<a name="l00167"></a>00167     <span class="keywordtype">int</span> *nz = INTEGER(GET_SLOT(x, install(<span class="stringliteral">&quot;nz&quot;</span>))),
<a name="l00168"></a>00168         ctype = <a class="code" href="Mutils_8h.html#a2206f293e563a99c83fa8480b7e26912" title="Return the 0-based index of a string match in a vector of strings terminated by an empty string...">Matrix_check_class</a>(cl, valid);
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     <span class="keywordflow">if</span> (ctype &lt; 0)
<a name="l00171"></a>00171         error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;invalid class of object to %s&quot;</span>), <span class="stringliteral">&quot;Matrix_as_css&quot;</span>);
<a name="l00172"></a>00172     ans-&gt;<a class="code" href="structcs__symbolic.html#aecc57aadbdfe0598bf00fb3648fcf098">q</a> = INTEGER(GET_SLOT(x, install(<span class="stringliteral">&quot;Q&quot;</span>)));
<a name="l00173"></a>00173     ans-&gt;<a class="code" href="structcs__symbolic.html#a6e76dde6232a98e3b5d96d942c08b12e">m2</a> = nz[0]; ans-&gt;<a class="code" href="structcs__symbolic.html#a4f723af5f9ae0047f678a82a146d17b0">lnz</a> = nz[1]; ans-&gt;<a class="code" href="structcs__symbolic.html#a75ba99f8c206d85c4936e11053e7f5e3">unz</a> = nz[2];
<a name="l00174"></a>00174     <span class="keywordflow">switch</span>(ctype) {
<a name="l00175"></a>00175     <span class="keywordflow">case</span> 0:                     <span class="comment">/* css_LU */</span>
<a name="l00176"></a>00176         ans-&gt;<a class="code" href="structcs__symbolic.html#a4724390fc87ae2fb8f82a93ce1ddf55d">pinv</a> = (<span class="keywordtype">int</span> *) NULL;
<a name="l00177"></a>00177         ans-&gt;<a class="code" href="structcs__symbolic.html#aefc6fc6ae59f5c51b225c93a549b6838">parent</a> = (<span class="keywordtype">int</span> *) NULL;
<a name="l00178"></a>00178         ans-&gt;<a class="code" href="structcs__symbolic.html#a85eed6fd134282ada142ebaae0fe2403">cp</a> = (<span class="keywordtype">int</span> *) NULL;
<a name="l00179"></a>00179         <span class="keywordflow">break</span>;
<a name="l00180"></a>00180     <span class="keywordflow">case</span> 1:                     <span class="comment">/* css_QR */</span>
<a name="l00181"></a>00181         ans-&gt;<a class="code" href="structcs__symbolic.html#a4724390fc87ae2fb8f82a93ce1ddf55d">pinv</a> = INTEGER(GET_SLOT(x, install(<span class="stringliteral">&quot;Pinv&quot;</span>)));
<a name="l00182"></a>00182         ans-&gt;<a class="code" href="structcs__symbolic.html#aefc6fc6ae59f5c51b225c93a549b6838">parent</a> = INTEGER(GET_SLOT(x, install(<span class="stringliteral">&quot;parent&quot;</span>)));
<a name="l00183"></a>00183         ans-&gt;<a class="code" href="structcs__symbolic.html#a85eed6fd134282ada142ebaae0fe2403">cp</a> = INTEGER(GET_SLOT(x, install(<span class="stringliteral">&quot;cp&quot;</span>)));
<a name="l00184"></a>00184         <span class="keywordflow">break</span>;
<a name="l00185"></a>00185     <span class="keywordflow">default</span>:
<a name="l00186"></a>00186         error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;invalid class of object to %s&quot;</span>), <span class="stringliteral">&quot;Matrix_as_css&quot;</span>);
<a name="l00187"></a>00187     }
<a name="l00188"></a>00188     <span class="keywordflow">return</span> ans;
<a name="l00189"></a>00189 }
<a name="l00190"></a>00190 
<a name="l00200"></a>00200 <a class="code" href="structcs__numeric.html">csn</a> *Matrix_as_csn(<a class="code" href="structcs__numeric.html">csn</a> *ans, SEXP x)
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202     <span class="keywordtype">char</span> *valid[] = {<span class="stringliteral">&quot;csn_LU&quot;</span>, <span class="stringliteral">&quot;csn_QR&quot;</span>, <span class="stringliteral">&quot;&quot;</span>};
<a name="l00203"></a>00203     <span class="keywordtype">int</span> ctype = <a class="code" href="Mutils_8h.html#a2206f293e563a99c83fa8480b7e26912" title="Return the 0-based index of a string match in a vector of strings terminated by an empty string...">Matrix_check_class</a>(<a class="code" href="Mutils_8h.html#ae692d23e2a86a20fccc024b05fc23df9">class_P</a>(x), valid);
<a name="l00204"></a>00204 
<a name="l00205"></a>00205     <span class="keywordflow">if</span> (ctype &lt; 0)
<a name="l00206"></a>00206         error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;invalid class of object to %s&quot;</span>), <span class="stringliteral">&quot;Matrix_as_csn&quot;</span>);
<a name="l00207"></a>00207     ans-&gt;<a class="code" href="structcs__numeric.html#a1e07204edb10064ca1e471289fced1cb">U</a> = <a class="code" href="cs__utils_8c.html#ae015ca3e4a6c1b3a7265208ab035a1c7" title="Create a cs object with the contents of x.">Matrix_as_cs</a>(GET_SLOT(x, install(<span class="stringliteral">&quot;U&quot;</span>)));
<a name="l00208"></a>00208     ans-&gt;<a class="code" href="structcs__numeric.html#a93a8cf26f01d3df51b41acc690f120d7">L</a> = <a class="code" href="cs__utils_8c.html#ae015ca3e4a6c1b3a7265208ab035a1c7" title="Create a cs object with the contents of x.">Matrix_as_cs</a>(GET_SLOT(x, install(<span class="stringliteral">&quot;L&quot;</span>)));
<a name="l00209"></a>00209     <span class="keywordflow">switch</span>(ctype) {
<a name="l00210"></a>00210     <span class="keywordflow">case</span> 0:
<a name="l00211"></a>00211         ans-&gt;<a class="code" href="structcs__numeric.html#ad81bc354670c58c7e715293e98316152">B</a> = (<span class="keywordtype">double</span>*) NULL;
<a name="l00212"></a>00212         ans-&gt;<a class="code" href="structcs__numeric.html#a43298b46a89a885b6cb2a2414ace6308">pinv</a> = INTEGER(GET_SLOT(x, install(<span class="stringliteral">&quot;Pinv&quot;</span>)));
<a name="l00213"></a>00213         <span class="keywordflow">break</span>;
<a name="l00214"></a>00214     <span class="keywordflow">case</span> 1:
<a name="l00215"></a>00215         ans-&gt;<a class="code" href="structcs__numeric.html#ad81bc354670c58c7e715293e98316152">B</a> = REAL(GET_SLOT(x, install(<span class="stringliteral">&quot;beta&quot;</span>)));
<a name="l00216"></a>00216         ans-&gt;<a class="code" href="structcs__numeric.html#a43298b46a89a885b6cb2a2414ace6308">pinv</a> = (<span class="keywordtype">int</span>*) NULL;
<a name="l00217"></a>00217         <span class="keywordflow">break</span>;
<a name="l00218"></a>00218     <span class="keywordflow">default</span>:
<a name="l00219"></a>00219         error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;invalid class of object to %s&quot;</span>), <span class="stringliteral">&quot;Matrix_as_csn&quot;</span>);
<a name="l00220"></a>00220     }
<a name="l00221"></a>00221     <span class="keywordflow">return</span> ans;
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 
<a name="l00236"></a>00236 SEXP Matrix_css_to_SEXP(<a class="code" href="structcs__symbolic.html">css</a> *S, <span class="keywordtype">char</span> *cl, <span class="keywordtype">int</span> dofree, <span class="keywordtype">int</span> m, <span class="keywordtype">int</span> n)
<a name="l00237"></a>00237 {
<a name="l00238"></a>00238     SEXP ans;
<a name="l00239"></a>00239     <span class="keywordtype">char</span> *valid[] = {<span class="stringliteral">&quot;css_LU&quot;</span>, <span class="stringliteral">&quot;css_QR&quot;</span>, <span class="stringliteral">&quot;&quot;</span>};
<a name="l00240"></a>00240     <span class="keywordtype">int</span> *nz, ctype = <a class="code" href="Mutils_8h.html#a2206f293e563a99c83fa8480b7e26912" title="Return the 0-based index of a string match in a vector of strings terminated by an empty string...">Matrix_check_class</a>(cl, valid);
<a name="l00241"></a>00241 
<a name="l00242"></a>00242     <span class="keywordflow">if</span> (ctype &lt; 0)
<a name="l00243"></a>00243         error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Inappropriate class cl=&#39;%s&#39; in Matrix_css_to_SEXP(S, cl, ..)&quot;</span>),
<a name="l00244"></a>00244               cl);
<a name="l00245"></a>00245     ans = PROTECT(NEW_OBJECT(MAKE_CLASS(cl)));
<a name="l00246"></a>00246                                 <span class="comment">/* allocate and copy common slots */</span>
<a name="l00247"></a>00247     Memcpy(INTEGER(<a class="code" href="Mutils_8h.html#af7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and return the SEXP...">ALLOC_SLOT</a>(ans, install(<span class="stringliteral">&quot;Q&quot;</span>), INTSXP, n)), S-&gt;<a class="code" href="structcs__symbolic.html#aecc57aadbdfe0598bf00fb3648fcf098">q</a>, n);
<a name="l00248"></a>00248     nz = INTEGER(<a class="code" href="Mutils_8h.html#af7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and return the SEXP...">ALLOC_SLOT</a>(ans, install(<span class="stringliteral">&quot;nz&quot;</span>), INTSXP, 3));
<a name="l00249"></a>00249     nz[0] = S-&gt;<a class="code" href="structcs__symbolic.html#a6e76dde6232a98e3b5d96d942c08b12e">m2</a>; nz[1] = S-&gt;<a class="code" href="structcs__symbolic.html#a4f723af5f9ae0047f678a82a146d17b0">lnz</a>; nz[2] = S-&gt;<a class="code" href="structcs__symbolic.html#a75ba99f8c206d85c4936e11053e7f5e3">unz</a>;
<a name="l00250"></a>00250     <span class="keywordflow">switch</span>(ctype) {
<a name="l00251"></a>00251     <span class="keywordflow">case</span> 0:
<a name="l00252"></a>00252         <span class="keywordflow">break</span>;
<a name="l00253"></a>00253     <span class="keywordflow">case</span> 1:
<a name="l00254"></a>00254         Memcpy(INTEGER(<a class="code" href="Mutils_8h.html#af7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and return the SEXP...">ALLOC_SLOT</a>(ans, install(<span class="stringliteral">&quot;Pinv&quot;</span>), INTSXP, m)),
<a name="l00255"></a>00255                S-&gt;<a class="code" href="structcs__symbolic.html#a4724390fc87ae2fb8f82a93ce1ddf55d">pinv</a>, m);
<a name="l00256"></a>00256         Memcpy(INTEGER(<a class="code" href="Mutils_8h.html#af7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and return the SEXP...">ALLOC_SLOT</a>(ans, install(<span class="stringliteral">&quot;parent&quot;</span>), INTSXP, n)),
<a name="l00257"></a>00257                S-&gt;<a class="code" href="structcs__symbolic.html#aefc6fc6ae59f5c51b225c93a549b6838">parent</a>, n);
<a name="l00258"></a>00258         Memcpy(INTEGER(<a class="code" href="Mutils_8h.html#af7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and return the SEXP...">ALLOC_SLOT</a>(ans, install(<span class="stringliteral">&quot;cp&quot;</span>), INTSXP, n)),
<a name="l00259"></a>00259                S-&gt;<a class="code" href="structcs__symbolic.html#a85eed6fd134282ada142ebaae0fe2403">cp</a>, n);
<a name="l00260"></a>00260         <span class="keywordflow">break</span>;
<a name="l00261"></a>00261     <span class="keywordflow">default</span>:
<a name="l00262"></a>00262         error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Inappropriate class cl=&#39;%s&#39; in Matrix_css_to_SEXP(S, cl, ..)&quot;</span>),
<a name="l00263"></a>00263               cl);
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265     <span class="keywordflow">if</span> (dofree &gt; 0) <a class="code" href="cs_8c.html#ace766075ef439ad6e4347f6b076eb4b7">cs_sfree</a>(S);
<a name="l00266"></a>00266     <span class="keywordflow">if</span> (dofree &lt; 0) Free(S);
<a name="l00267"></a>00267     UNPROTECT(1);
<a name="l00268"></a>00268     <span class="keywordflow">return</span> ans;
<a name="l00269"></a>00269 }
<a name="l00270"></a>00270 
<a name="l00281"></a>00281 SEXP Matrix_csn_to_SEXP(<a class="code" href="structcs__numeric.html">csn</a> *N, <span class="keywordtype">char</span> *cl, <span class="keywordtype">int</span> dofree)
<a name="l00282"></a>00282 {
<a name="l00283"></a>00283     SEXP ans;
<a name="l00284"></a>00284     <span class="keywordtype">char</span> *valid[] = {<span class="stringliteral">&quot;csn_LU&quot;</span>, <span class="stringliteral">&quot;csn_QR&quot;</span>, <span class="stringliteral">&quot;&quot;</span>};
<a name="l00285"></a>00285     <span class="keywordtype">int</span> ctype = <a class="code" href="Mutils_8h.html#a2206f293e563a99c83fa8480b7e26912" title="Return the 0-based index of a string match in a vector of strings terminated by an empty string...">Matrix_check_class</a>(cl, valid), n = (N-&gt;<a class="code" href="structcs__numeric.html#a1e07204edb10064ca1e471289fced1cb">U</a>)-&gt;n;
<a name="l00286"></a>00286 
<a name="l00287"></a>00287     <span class="keywordflow">if</span> (ctype &lt; 0)
<a name="l00288"></a>00288         error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Inappropriate class cl=&#39;%s&#39; in Matrix_csn_to_SEXP(S, cl, ..)&quot;</span>),
<a name="l00289"></a>00289               cl);
<a name="l00290"></a>00290     ans = PROTECT(NEW_OBJECT(MAKE_CLASS(cl)));
<a name="l00291"></a>00291                                 <span class="comment">/* allocate and copy common slots */</span>
<a name="l00292"></a>00292     <span class="comment">/* FIXME: Use the triangular matrix classes for csn_LU */</span>
<a name="l00293"></a>00293     SET_SLOT(ans, install(<span class="stringliteral">&quot;L&quot;</span>), <span class="comment">/* these are free&#39;d later if requested */</span>
<a name="l00294"></a>00294              <a class="code" href="cs__utils_8c.html#ae53880c709c9977b041217226c202deb" title="Copy the contents of a to an appropriate CsparseMatrix object and, optionally, free a or free both a ...">Matrix_cs_to_SEXP</a>(N-&gt;<a class="code" href="structcs__numeric.html#a93a8cf26f01d3df51b41acc690f120d7">L</a>, <span class="stringliteral">&quot;dgCMatrix&quot;</span>, 0));
<a name="l00295"></a>00295     SET_SLOT(ans, install(<span class="stringliteral">&quot;U&quot;</span>),
<a name="l00296"></a>00296              <a class="code" href="cs__utils_8c.html#ae53880c709c9977b041217226c202deb" title="Copy the contents of a to an appropriate CsparseMatrix object and, optionally, free a or free both a ...">Matrix_cs_to_SEXP</a>(N-&gt;<a class="code" href="structcs__numeric.html#a1e07204edb10064ca1e471289fced1cb">U</a>, <span class="stringliteral">&quot;dgCMatrix&quot;</span>, 0));
<a name="l00297"></a>00297     <span class="keywordflow">switch</span>(ctype) {
<a name="l00298"></a>00298     <span class="keywordflow">case</span> 0:
<a name="l00299"></a>00299         Memcpy(INTEGER(<a class="code" href="Mutils_8h.html#af7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and return the SEXP...">ALLOC_SLOT</a>(ans, install(<span class="stringliteral">&quot;Pinv&quot;</span>), INTSXP, n)),
<a name="l00300"></a>00300                N-&gt;<a class="code" href="structcs__numeric.html#a43298b46a89a885b6cb2a2414ace6308">pinv</a>, n);
<a name="l00301"></a>00301         <span class="keywordflow">break</span>;
<a name="l00302"></a>00302     <span class="keywordflow">case</span> 1:
<a name="l00303"></a>00303         Memcpy(REAL(<a class="code" href="Mutils_8h.html#af7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and return the SEXP...">ALLOC_SLOT</a>(ans, install(<span class="stringliteral">&quot;beta&quot;</span>), REALSXP, n)),
<a name="l00304"></a>00304                N-&gt;<a class="code" href="structcs__numeric.html#ad81bc354670c58c7e715293e98316152">B</a>, n);
<a name="l00305"></a>00305         <span class="keywordflow">break</span>;
<a name="l00306"></a>00306     <span class="keywordflow">default</span>:
<a name="l00307"></a>00307         error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Inappropriate class cl=&#39;%s&#39; in Matrix_csn_to_SEXP(S, cl, ..)&quot;</span>),
<a name="l00308"></a>00308               cl);
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310     <span class="keywordflow">if</span> (dofree &gt; 0) <a class="code" href="cs_8c.html#af2e6d75dfc24a842fdbce3aa510dc4bc">cs_nfree</a>(N);
<a name="l00311"></a>00311     <span class="keywordflow">if</span> (dofree &lt; 0) {
<a name="l00312"></a>00312         Free(N-&gt;<a class="code" href="structcs__numeric.html#a93a8cf26f01d3df51b41acc690f120d7">L</a>); Free(N-&gt;<a class="code" href="structcs__numeric.html#a1e07204edb10064ca1e471289fced1cb">U</a>); Free(N);
<a name="l00313"></a>00313     }
<a name="l00314"></a>00314     UNPROTECT(1);
<a name="l00315"></a>00315     <span class="keywordflow">return</span> ans;
<a name="l00316"></a>00316 }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 <span class="preprocessor">#endif  </span><span class="comment">/* unused */</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sat Dec 11 2010 20:08:33 for Matrix by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
