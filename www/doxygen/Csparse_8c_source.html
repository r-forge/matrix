<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Matrix: Csparse.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Matrix
   &#160;<span id="projectnumber">$Rev: 3071 $ at $LastChangedDate: 2015-03-26 15:35:47 +0100 (Thu, 26 Mar 2015) $</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('Csparse_8c_source.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Csparse.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="Csparse_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Csparse_8h.html">Csparse.h</a>&quot;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Tsparse_8h.html">Tsparse.h</a>&quot;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="chm__common_8h.html">chm_common.h</a>&quot;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno"><a class="line" href="Csparse_8h.html#ad988031b3c1f79de0d13da2bf40cc4c1">   11</a></span>&#160;Rboolean <a class="code" href="Csparse_8c.html#ad988031b3c1f79de0d13da2bf40cc4c1">isValid_Csparse</a>(SEXP x)</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;{</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    <span class="comment">/* NB: we do *NOT* check a potential &#39;x&#39; slot here, at all */</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    SEXP pslot = GET_SLOT(x, <a class="code" href="Syms_8h.html#af08cd6c75b2da4b71c2eb605e00e94ab">Matrix_pSym</a>),</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;        islot = GET_SLOT(x, <a class="code" href="Syms_8h.html#a900b6b19a8e80b529c1a26eb9fb6156d">Matrix_iSym</a>);</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <span class="keywordtype">int</span> *dims = INTEGER(GET_SLOT(x, <a class="code" href="Syms_8h.html#a2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>)), j,</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        nrow = dims[0],</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        ncol = dims[1],</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;        *xp = INTEGER(pslot),</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;        *xi = INTEGER(islot);</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="keywordflow">if</span> (length(pslot) != dims[1] + 1)</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <span class="keywordflow">if</span> (xp[0] != 0)</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keywordflow">if</span> (length(islot) &lt; xp[ncol]) <span class="comment">/* allow larger slots from over-allocation!*/</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; xp[ncol]; j++) {</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        <span class="keywordflow">if</span> (xi[j] &lt; 0 || xi[j] &gt;= nrow)</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;            <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    }</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; ncol; j++) {</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <span class="keywordflow">if</span> (xp[j] &gt; xp[j + 1])</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;            <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    }</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">return</span> TRUE;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;}</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="Csparse_8h.html#a77f654c86c318184ef29b46dc4929e12">   39</a></span>&#160;SEXP <a class="code" href="Csparse_8c.html#a77f654c86c318184ef29b46dc4929e12">Csparse_validate</a>(SEXP x) {</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="Csparse_8h.html#a10392132372fdfc01e1aff7622f5ee7f">Csparse_validate_</a>(x, FALSE);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="Csparse_8c.html#ae9a2ded3010f22ff982429c1aa6ae33d">   44</a></span>&#160;<span class="preprocessor">#define _t_Csparse_validate</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="t__Csparse__validate_8c.html">t_Csparse_validate.c</a>&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="Csparse_8c.html#a7b30d09a524f05befc480a8c1548c8ed">   47</a></span>&#160;<span class="preprocessor">#define _t_Csparse_sort</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="t__Csparse__validate_8c.html">t_Csparse_validate.c</a>&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">// R: .validateCsparse(x, sort.if.needed = FALSE) :</span></div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="Csparse_8h.html#a5b2f297662f7f5dd66097ed12b320468">   51</a></span>&#160;SEXP <a class="code" href="Csparse_8c.html#a5b2f297662f7f5dd66097ed12b320468">Csparse_validate2</a>(SEXP x, SEXP maybe_modify) {</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="Csparse_8h.html#a10392132372fdfc01e1aff7622f5ee7f">Csparse_validate_</a>(x, asLogical(maybe_modify));</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;}</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">// R: Matrix:::.sortCsparse(x) :</span></div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="Csparse_8h.html#a9e54e758f6585b91c2cbb20f47bfad2f">   56</a></span>&#160;SEXP <a class="code" href="Csparse_8c.html#a9e54e758f6585b91c2cbb20f47bfad2f">Csparse_sort</a> (SEXP x) {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;   <span class="keywordtype">int</span> ok = Csparse_sort_2(x, TRUE); <span class="comment">// modifying x directly</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;   <span class="keywordflow">if</span>(!ok) warning(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Csparse_sort(x): x is not a valid (apart from sorting) CsparseMatrix&quot;</span>));</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;   <span class="keywordflow">return</span> x;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;}</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="Csparse_8h.html#ac732feb976a4c849b0542e99f22d92de">   62</a></span>&#160;SEXP <a class="code" href="Csparse_8c.html#ac732feb976a4c849b0542e99f22d92de">Rsparse_validate</a>(SEXP x)</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;{</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">/* NB: we do *NOT* check a potential &#39;x&#39; slot here, at all */</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    SEXP pslot = GET_SLOT(x, <a class="code" href="Syms_8h.html#af08cd6c75b2da4b71c2eb605e00e94ab">Matrix_pSym</a>),</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        jslot = GET_SLOT(x, <a class="code" href="Syms_8h.html#a92da52e94414e4e2c04f11a6dce844d7">Matrix_jSym</a>);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    Rboolean sorted, strictly;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordtype">int</span> i, k,</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        *dims = INTEGER(GET_SLOT(x, <a class="code" href="Syms_8h.html#a2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>)),</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        nrow = dims[0],</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        ncol = dims[1],</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        *xp = INTEGER(pslot),</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        *xj = INTEGER(jslot);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">if</span> (length(pslot) != dims[0] + 1)</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="keywordflow">return</span> mkString(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;slot p must have length = nrow(.) + 1&quot;</span>));</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordflow">if</span> (xp[0] != 0)</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="keywordflow">return</span> mkString(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;first element of slot p must be zero&quot;</span>));</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">if</span> (length(jslot) &lt; xp[nrow]) <span class="comment">/* allow larger slots from over-allocation!*/</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            mkString(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;last element of slot p must match length of slots j and x&quot;</span>));</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; length(jslot); i++) {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keywordflow">if</span> (xj[i] &lt; 0 || xj[i] &gt;= ncol)</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            <span class="keywordflow">return</span> mkString(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;all column indices must be between 0 and ncol-1&quot;</span>));</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    }</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    sorted = TRUE; strictly = TRUE;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; nrow; i++) {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordflow">if</span> (xp[i] &gt; xp[i+1])</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <span class="keywordflow">return</span> mkString(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;slot p must be non-decreasing&quot;</span>));</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="keywordflow">if</span>(sorted)</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <span class="keywordflow">for</span> (k = xp[i] + 1; k &lt; xp[i + 1]; k++) {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                <span class="keywordflow">if</span> (xj[k] &lt; xj[k - 1])</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                    sorted = FALSE;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xj[k] == xj[k - 1])</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                    strictly = FALSE;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            }</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    }</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordflow">if</span> (!sorted)</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="comment">/* cannot easily use cholmod_sort(.) ... -&gt; &quot;error out&quot; :*/</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="keywordflow">return</span> mkString(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;slot j is not increasing inside a column&quot;</span>));</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strictly) <span class="comment">/* sorted, but not strictly */</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keywordflow">return</span> mkString(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;slot j is not *strictly* increasing inside a column&quot;</span>));</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">return</span> ScalarLogical(1);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;}</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="Csparse_8h.html#af4beac0a5fdb698d99feaf1fb8da7b03">  121</a></span>&#160;SEXP <a class="code" href="Csparse_8c.html#af4beac0a5fdb698d99feaf1fb8da7b03">Csparse_to_dense</a>(SEXP x, SEXP symm_or_tri)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;{</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    Rboolean <a class="code" href="cs__utils_8c.html#a0b2592041f5b822459b7052a451c07a5">is_sym</a>, is_tri;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordtype">int</span> is_sym_or_tri = asInteger(symm_or_tri),</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        ctype = 0; <span class="comment">// &lt;- default = &quot;dgC&quot;</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *valid[] = { <a class="code" href="Mutils_8h.html#a26137187495aa7abb0f0b0d38ee1e641">MATRIX_VALID_Csparse</a>, <span class="stringliteral">&quot;&quot;</span>};</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordflow">if</span>(is_sym_or_tri == NA_INTEGER) { <span class="comment">// find if  is(x, &quot;symmetricMatrix&quot;) :</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        ctype = R_check_class_etc(x, valid);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        is_sym = (ctype % 3 == 1);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        is_tri = (ctype % 3 == 2);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        is_sym = is_sym_or_tri &gt; 0;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        is_tri = is_sym_or_tri &lt; 0;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="comment">// =&gt; both are FALSE  iff  is_.. == 0</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="keywordflow">if</span>(is_sym || is_tri)</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            ctype = R_check_class_etc(x, valid);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    }</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> chxs = <a class="code" href="chm__common_8h.html#a3b03d0be10b7de793f1d61046041e73e">AS_CHM_SP__</a>(x);<span class="comment">// -&gt; chxs-&gt;stype = +- 1 &lt;==&gt; symmetric</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    R_CheckStack();</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">if</span>(is_tri &amp;&amp; *<a class="code" href="Mutils_8h.html#a1e1f224c5e72ee3eb2583024db2c59e6">diag_P</a>(x) == <span class="charliteral">&#39;U&#39;</span>) { <span class="comment">// ==&gt;  x := diagU2N(x), directly for chxs</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> eye = cholmod_speye(chxs-&gt;nrow, chxs-&gt;ncol, chxs-&gt;xtype, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="keywordtype">double</span> one[] = {1, 0};</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> ans = cholmod_add(chxs, eye, one, one,</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                                 <span class="comment">/* values: */</span> ((ctype / 3) != 2), <span class="comment">// TRUE iff not &quot;nMatrix&quot;</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                                 TRUE, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        cholmod_free_sparse(&amp;eye, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        chxs = cholmod_copy_sparse(ans, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        cholmod_free_sparse(&amp;ans, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">/* The following loses the symmetry property, since cholmod_dense has none,</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">     * BUT, much worse (FIXME!), it also transforms CHOLMOD_PATTERN (&quot;n&quot;) matrices</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">     * to numeric (CHOLMOD_REAL) ones {and we &quot;revert&quot; via chm_dense_to_SEXP()}: */</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="chm__common_8h.html#abaf1012d71b21d1b412add9042b5ac2b">CHM_DN</a> chxd = cholmod_sparse_to_dense(chxs, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">/* FIXME: The above FAILS for prod(dim(.)) &gt; INT_MAX</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">    /* TODO: use cholmod_l_* but also the &#39;cl&#39; global ==&gt; many changes in chm_common.[ch]</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">     * &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; TODO &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">     * CHM_DN chxd = cholmod_l_sparse_to_dense(chxs, &amp;cl); */</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">//                   ^^^ important when prod(dim(.)) &gt; INT_MAX</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordtype">int</span> Rkind = (chxs-&gt;xtype == CHOLMOD_PATTERN)? -1 : <a class="code" href="Mutils_8h.html#ad0ec8e93e7bf996d7d4f241f4820c15b">Real_kind</a>(x);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    SEXP ans = <a class="code" href="chm__common_8c.html#ad8cdbb3c526b503d3620b16e2cf522ad">chm_dense_to_SEXP</a>(chxd, 1, Rkind, GET_SLOT(x, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>),</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                                 <span class="comment">/* transp: */</span> FALSE);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="comment">// -&gt; a [dln]geMatrix</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">if</span>(is_sym) { <span class="comment">// ==&gt; want  [dln]syMatrix</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> cl1 = <a class="code" href="Mutils_8h.html#ae692d23e2a86a20fccc024b05fc23df9">class_P</a>(ans)[0];</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        PROTECT(ans);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        SEXP aa = PROTECT(NEW_OBJECT(MAKE_CLASS((cl1 == <span class="charliteral">&#39;d&#39;</span>) ? <span class="stringliteral">&quot;dsyMatrix&quot;</span> :</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                                                ((cl1 == <span class="charliteral">&#39;l&#39;</span>) ? <span class="stringliteral">&quot;lsyMatrix&quot;</span> : <span class="stringliteral">&quot;nsyMatrix&quot;</span>))));</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="comment">// No need to duplicate() as slots of ans are freshly allocated and ans will not be used</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        SET_SLOT(aa, <a class="code" href="Syms_8h.html#a8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>,       GET_SLOT(ans, <a class="code" href="Syms_8h.html#a8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>));</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        SET_SLOT(aa, <a class="code" href="Syms_8h.html#a2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>,     GET_SLOT(ans, <a class="code" href="Syms_8h.html#a2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>));</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        SET_SLOT(aa, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>,GET_SLOT(ans, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>));</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        SET_SLOT(aa, <a class="code" href="Syms_8h.html#ac4fa9962123be6abbeaf9c7219b62644">Matrix_uploSym</a>, mkString((chxs-&gt;stype &gt; 0) ? <span class="stringliteral">&quot;U&quot;</span> : <span class="stringliteral">&quot;L&quot;</span>));</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        UNPROTECT(2);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">return</span> aa;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(is_tri) { <span class="comment">// ==&gt; want  [dln]trMatrix</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> cl1 = <a class="code" href="Mutils_8h.html#ae692d23e2a86a20fccc024b05fc23df9">class_P</a>(ans)[0];</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        PROTECT(ans);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        SEXP aa = PROTECT(NEW_OBJECT(MAKE_CLASS((cl1 == <span class="charliteral">&#39;d&#39;</span>) ? <span class="stringliteral">&quot;dtrMatrix&quot;</span> :</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                                                ((cl1 == <span class="charliteral">&#39;l&#39;</span>) ? <span class="stringliteral">&quot;ltrMatrix&quot;</span> : <span class="stringliteral">&quot;ntrMatrix&quot;</span>))));</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="comment">// No need to duplicate() as slots of ans are freshly allocated and ans will not be used</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        SET_SLOT(aa, <a class="code" href="Syms_8h.html#a8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>,       GET_SLOT(ans, <a class="code" href="Syms_8h.html#a8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>));</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        SET_SLOT(aa, <a class="code" href="Syms_8h.html#a2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>,     GET_SLOT(ans, <a class="code" href="Syms_8h.html#a2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>));</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        SET_SLOT(aa, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>,GET_SLOT(ans, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>));</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <a class="code" href="Mutils_8h.html#a36a9a730e1a12cbe017064fe140aefd2">slot_dup</a>(aa, x, <a class="code" href="Syms_8h.html#ac4fa9962123be6abbeaf9c7219b62644">Matrix_uploSym</a>);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="comment">/* already by NEW_OBJECT(..) above:</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">           SET_SLOT(aa, Matrix_diagSym, mkString(&quot;N&quot;)); */</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        UNPROTECT(2);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keywordflow">return</span> aa;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    }</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;}</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">// FIXME: do not go via CHM (should not be too hard, to just *drop* the x-slot, right?</span></div>
<div class="line"><a name="l00198"></a><span class="lineno"><a class="line" href="Csparse_8h.html#ad902ff7d08b94c85a1ffb1b4c2c4e247">  198</a></span>&#160;SEXP <a class="code" href="Csparse_8c.html#ad902ff7d08b94c85a1ffb1b4c2c4e247">Csparse2nz</a>(SEXP x, Rboolean tri)</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;{</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> chxs = <a class="code" href="chm__common_8h.html#a3b03d0be10b7de793f1d61046041e73e">AS_CHM_SP__</a>(x);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> chxcp = cholmod_copy(chxs, chxs-&gt;stype, CHOLMOD_PATTERN, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    R_CheckStack();</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="chm__common_8c.html#a7aa1a6e564c24a55b031b5c03b3313f4">chm_sparse_to_SEXP</a>(chxcp, 1<span class="comment">/*do_free*/</span>,</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                              tri ? ((*<a class="code" href="Mutils_8h.html#a3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a>(x) == <span class="charliteral">&#39;U&#39;</span>) ? 1 : -1) : 0,</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                              <span class="comment">/* Rkind: pattern */</span> 0,</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                              <span class="comment">/* diag = */</span> tri ? <a class="code" href="Mutils_8h.html#a1e1f224c5e72ee3eb2583024db2c59e6">diag_P</a>(x) : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                              GET_SLOT(x, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>));</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;}</div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="Csparse_8h.html#a9e26da2b0832ca4dc2f4cb894705bcdd">  210</a></span>&#160;SEXP <a class="code" href="Csparse_8c.html#a9e26da2b0832ca4dc2f4cb894705bcdd">Csparse_to_nz_pattern</a>(SEXP x, SEXP tri)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;{</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordtype">int</span> tr_ = asLogical(tri);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">if</span>(tr_ == NA_LOGICAL) {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        warning(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Csparse_to_nz_pattern(x, tri = NA): &#39;tri&#39; is taken as TRUE&quot;</span>));</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        tr_ = TRUE;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="Csparse_8c.html#ad902ff7d08b94c85a1ffb1b4c2c4e247">Csparse2nz</a>(x, (Rboolean) tr_);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;}</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">// n.CMatrix --&gt; [dli].CMatrix  (not going through CHM!)</span></div>
<div class="line"><a name="l00221"></a><span class="lineno"><a class="line" href="Csparse_8h.html#a9a393d510bc108d7f4e5807d952fc089">  221</a></span>&#160;SEXP <a class="code" href="Csparse_8c.html#a9a393d510bc108d7f4e5807d952fc089">nz_pattern_to_Csparse</a>(SEXP x, SEXP res_kind)</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;{</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="Csparse_8c.html#a4445bf9e1d6a9ee608151123b9d3aa9f">nz2Csparse</a>(x, asInteger(res_kind));</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;}</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">// n.CMatrix --&gt; [dli].CMatrix  (not going through CHM!)</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">// NOTE: use chm_MOD_xtype(() to change type of  &#39;cholmod_sparse&#39; matrix</span></div>
<div class="line"><a name="l00228"></a><span class="lineno"><a class="line" href="Csparse_8h.html#a4445bf9e1d6a9ee608151123b9d3aa9f">  228</a></span>&#160;SEXP <a class="code" href="Csparse_8c.html#a4445bf9e1d6a9ee608151123b9d3aa9f">nz2Csparse</a>(SEXP x, <span class="keyword">enum</span> <a class="code" href="Mutils_8h.html#a0513d8a9f2e4f454f1fc3a59c4a6f181">x_slot_kind</a> r_kind)</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;{</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *cl_x = <a class="code" href="Mutils_8h.html#ae692d23e2a86a20fccc024b05fc23df9">class_P</a>(x);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">// quick check - if ok, fast</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">if</span>(cl_x[0] != <span class="charliteral">&#39;n&#39;</span> || cl_x[2] != <span class="charliteral">&#39;C&#39;</span>) {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="comment">// e.g. class = &quot;A&quot;, from  setClass(&quot;A&quot;, contains = &quot;ngCMatrix&quot;)</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *valid[] = { <a class="code" href="Mutils_8h.html#a116acdc205f6439ffbc8d160d1c64ff2">MATRIX_VALID_nCsparse</a>, <span class="stringliteral">&quot;&quot;</span>};</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keywordtype">int</span> ctype = R_check_class_etc(x, valid);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <span class="keywordflow">if</span>(ctype &lt; 0)</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;not a &#39;n.CMatrix&#39;&quot;</span>));</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="keywordflow">else</span> <span class="comment">// fine : get a valid  cl_x  class_P()-like string :</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            cl_x = valid[ctype];</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordtype">int</span> nnz = LENGTH(GET_SLOT(x, <a class="code" href="Syms_8h.html#a900b6b19a8e80b529c1a26eb9fb6156d">Matrix_iSym</a>));</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    SEXP ans;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordtype">char</span> *ncl = alloca(strlen(cl_x) + 1); <span class="comment">/* not much memory required */</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    strcpy(ncl, cl_x);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordtype">double</span> *dx_x; <span class="keywordtype">int</span> *ix_x;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    ncl[0] = (r_kind == <a class="code" href="Mutils_8h.html#a0513d8a9f2e4f454f1fc3a59c4a6f181a2a95e471311414715f5477d7a4f11564">x_double</a> ? <span class="charliteral">&#39;d&#39;</span> :</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;              (r_kind == <a class="code" href="Mutils_8h.html#a0513d8a9f2e4f454f1fc3a59c4a6f181ab3a3051968f4171a6f035164412f68a5">x_logical</a> ? <span class="charliteral">&#39;l&#39;</span> :</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;               <span class="comment">/* else (for now):  r_kind == x_integer : */</span> <span class="charliteral">&#39;i&#39;</span>));</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    PROTECT(ans = NEW_OBJECT(MAKE_CLASS(ncl)));</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="comment">// create a correct &#39;x&#39; slot:</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordflow">switch</span>(r_kind) {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="Mutils_8h.html#a0513d8a9f2e4f454f1fc3a59c4a6f181a2a95e471311414715f5477d7a4f11564">x_double</a>: <span class="comment">// &#39;d&#39;</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        dx_x = REAL(<a class="code" href="Mutils_8h.html#af7f59236ca18ab52131cf71f4a7b0786">ALLOC_SLOT</a>(ans, <a class="code" href="Syms_8h.html#a8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>, REALSXP, nnz));</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keywordflow">for</span> (i=0; i &lt; nnz; i++) dx_x[i] = 1.;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="Mutils_8h.html#a0513d8a9f2e4f454f1fc3a59c4a6f181ab3a3051968f4171a6f035164412f68a5">x_logical</a>: <span class="comment">// &#39;l&#39;</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        ix_x = LOGICAL(<a class="code" href="Mutils_8h.html#af7f59236ca18ab52131cf71f4a7b0786">ALLOC_SLOT</a>(ans, <a class="code" href="Syms_8h.html#a8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>, LGLSXP, nnz));</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keywordflow">for</span> (i=0; i &lt; nnz; i++) ix_x[i] = TRUE;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="Mutils_8h.html#a0513d8a9f2e4f454f1fc3a59c4a6f181aae6c99602d8ebd0046fe45aab166d0f0">x_integer</a>: <span class="comment">// &#39;i&#39;</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        ix_x = INTEGER(<a class="code" href="Mutils_8h.html#af7f59236ca18ab52131cf71f4a7b0786">ALLOC_SLOT</a>(ans, <a class="code" href="Syms_8h.html#a8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>, INTSXP, nnz));</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="keywordflow">for</span> (i=0; i &lt; nnz; i++) ix_x[i] = 1;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;nz2Csparse(): invalid/non-implemented r_kind = %d&quot;</span>),</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;              r_kind);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    }</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// now copy all other slots :</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <a class="code" href="Mutils_8h.html#a36a9a730e1a12cbe017064fe140aefd2">slot_dup</a>(ans, x, <a class="code" href="Syms_8h.html#a900b6b19a8e80b529c1a26eb9fb6156d">Matrix_iSym</a>);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <a class="code" href="Mutils_8h.html#a36a9a730e1a12cbe017064fe140aefd2">slot_dup</a>(ans, x, <a class="code" href="Syms_8h.html#af08cd6c75b2da4b71c2eb605e00e94ab">Matrix_pSym</a>);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <a class="code" href="Mutils_8h.html#a36a9a730e1a12cbe017064fe140aefd2">slot_dup</a>(ans, x, <a class="code" href="Syms_8h.html#a2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <a class="code" href="Mutils_8h.html#a36a9a730e1a12cbe017064fe140aefd2">slot_dup</a>(ans, x, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">if</span>(ncl[1] != <span class="charliteral">&#39;g&#39;</span>) { <span class="comment">// symmetric or triangular ...</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <a class="code" href="Mutils_8h.html#ab4ad1f68b41558c70a65c2255cfa49d8">slot_dup_if_has</a>(ans, x, <a class="code" href="Syms_8h.html#ac4fa9962123be6abbeaf9c7219b62644">Matrix_uploSym</a>);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <a class="code" href="Mutils_8h.html#ab4ad1f68b41558c70a65c2255cfa49d8">slot_dup_if_has</a>(ans, x, <a class="code" href="Syms_8h.html#aaaa2d2105381747118da72d6f1aba4e9">Matrix_diagSym</a>);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    UNPROTECT(1);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;}</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div>
<div class="line"><a name="l00284"></a><span class="lineno"><a class="line" href="Csparse_8h.html#a3ba5e051166f06c94c102d3e1e350a70">  284</a></span>&#160;SEXP <a class="code" href="Csparse_8c.html#a3ba5e051166f06c94c102d3e1e350a70">Csparse_to_matrix</a>(SEXP x, SEXP chk, SEXP symm)</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;{</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="cs__utils_8c.html#a0b2592041f5b822459b7052a451c07a5">is_sym</a> = asLogical(symm);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordflow">if</span>(is_sym == NA_LOGICAL) { <span class="comment">// find if  is(x, &quot;symmetricMatrix&quot;) :</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *valid[] = { <a class="code" href="Mutils_8h.html#a26137187495aa7abb0f0b0d38ee1e641">MATRIX_VALID_Csparse</a>, <span class="stringliteral">&quot;&quot;</span>};</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordtype">int</span> ctype = R_check_class_etc(x, valid);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        is_sym = (ctype % 3 == 1);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    }</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="chm__common_8c.html#aa63a154e775eded261bf72b8a219de11">chm_dense_to_matrix</a>(</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        cholmod_sparse_to_dense(<a class="code" href="chm__common_8h.html#aea5df11ddd9250493b0d937a2098657e">AS_CHM_SP2</a>(x, asLogical(chk)), &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>),</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        1 <span class="comment">/*do_free*/</span>,</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        (is_sym</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;         ? <a class="code" href="Mutils_8c.html#a316a7184387d598d6ab9d48c4a9a2da8">symmetric_DimNames</a>(GET_SLOT(x, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>))</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;         :                    GET_SLOT(x, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>)));</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;}</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno"><a class="line" href="Csparse_8h.html#a27fdeb89a1330c785f477e967c078eca">  300</a></span>&#160;SEXP <a class="code" href="Csparse_8c.html#a27fdeb89a1330c785f477e967c078eca">Csparse_to_vector</a>(SEXP x)</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;{</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="chm__common_8c.html#ad32e8dacf9f0444fedde957bb38e02ef">chm_dense_to_vector</a>(cholmod_sparse_to_dense(<a class="code" href="chm__common_8h.html#a3b03d0be10b7de793f1d61046041e73e">AS_CHM_SP__</a>(x), &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>), 1);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;}</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div>
<div class="line"><a name="l00305"></a><span class="lineno"><a class="line" href="Csparse_8h.html#a12b0c242957f1fad9137e767f882e6b8">  305</a></span>&#160;SEXP <a class="code" href="Csparse_8c.html#a12b0c242957f1fad9137e767f882e6b8">Csparse_to_Tsparse</a>(SEXP x, SEXP tri)</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;{</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> chxs = <a class="code" href="chm__common_8h.html#a3b03d0be10b7de793f1d61046041e73e">AS_CHM_SP__</a>(x);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="chm__common_8h.html#a206da8c29e7321f7aa00a1590b5362ad">CHM_TR</a> chxt = cholmod_sparse_to_triplet(chxs, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordtype">int</span> tr = asLogical(tri);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordtype">int</span> Rkind = (chxs-&gt;xtype != CHOLMOD_PATTERN) ? <a class="code" href="Mutils_8h.html#ad0ec8e93e7bf996d7d4f241f4820c15b">Real_kind</a>(x) : 0;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    R_CheckStack();</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="chm__common_8c.html#ab5d31c23691cc4a3c96a7f526dc84006">chm_triplet_to_SEXP</a>(chxt, 1,</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                               tr ? ((*<a class="code" href="Mutils_8h.html#a3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a>(x) == <span class="charliteral">&#39;U&#39;</span>) ? 1 : -1) : 0,</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                               Rkind, tr ? <a class="code" href="Mutils_8h.html#a1e1f224c5e72ee3eb2583024db2c59e6">diag_P</a>(x) : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                               GET_SLOT(x, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>));</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;}</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00319"></a><span class="lineno"><a class="line" href="Csparse_8h.html#a213393a1709973c1b2b733c7019d3086">  319</a></span>&#160;SEXP <a class="code" href="Csparse_8c.html#a213393a1709973c1b2b733c7019d3086">Csparse_to_tCsparse</a>(SEXP x, SEXP uplo, SEXP diag)</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;{</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> chxs = <a class="code" href="chm__common_8h.html#a3b03d0be10b7de793f1d61046041e73e">AS_CHM_SP__</a>(x);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordtype">int</span> Rkind = (chxs-&gt;xtype != CHOLMOD_PATTERN) ? <a class="code" href="Mutils_8h.html#ad0ec8e93e7bf996d7d4f241f4820c15b">Real_kind</a>(x) : 0;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    R_CheckStack();</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="chm__common_8c.html#a7aa1a6e564c24a55b031b5c03b3313f4">chm_sparse_to_SEXP</a>(chxs, <span class="comment">/* dofree = */</span> 0,</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                              <span class="comment">/* uploT = */</span> (*CHAR(asChar(uplo)) == <span class="charliteral">&#39;U&#39;</span>)? 1: -1,</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                               Rkind, <span class="comment">/* diag = */</span> CHAR(STRING_ELT(diag, 0)),</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                               GET_SLOT(x, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>));</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;}</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div>
<div class="line"><a name="l00330"></a><span class="lineno"><a class="line" href="Csparse_8h.html#a48d40e2cc334ad0df5e96008dea6eacf">  330</a></span>&#160;SEXP <a class="code" href="Csparse_8c.html#a48d40e2cc334ad0df5e96008dea6eacf">Csparse_to_tTsparse</a>(SEXP x, SEXP uplo, SEXP diag)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;{</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> chxs = <a class="code" href="chm__common_8h.html#a3b03d0be10b7de793f1d61046041e73e">AS_CHM_SP__</a>(x);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <a class="code" href="chm__common_8h.html#a206da8c29e7321f7aa00a1590b5362ad">CHM_TR</a> chxt = cholmod_sparse_to_triplet(chxs, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordtype">int</span> Rkind = (chxs-&gt;xtype != CHOLMOD_PATTERN) ? <a class="code" href="Mutils_8h.html#ad0ec8e93e7bf996d7d4f241f4820c15b">Real_kind</a>(x) : 0;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    R_CheckStack();</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="chm__common_8c.html#ab5d31c23691cc4a3c96a7f526dc84006">chm_triplet_to_SEXP</a>(chxt, 1,</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                              <span class="comment">/* uploT = */</span> (*CHAR(asChar(uplo)) == <span class="charliteral">&#39;U&#39;</span>)? 1: -1,</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                               Rkind, <span class="comment">/* diag = */</span> CHAR(STRING_ELT(diag, 0)),</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                               GET_SLOT(x, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>));</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;}</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno"><a class="line" href="Csparse_8h.html#a1fe70f89e424351c54c9bf4ba618ae65">  343</a></span>&#160;SEXP <a class="code" href="Csparse_8c.html#a1fe70f89e424351c54c9bf4ba618ae65">Csparse_symmetric_to_general</a>(SEXP x)</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;{</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> chx = <a class="code" href="chm__common_8h.html#a3b03d0be10b7de793f1d61046041e73e">AS_CHM_SP__</a>(x), chgx;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordtype">int</span> Rkind = (chx-&gt;xtype != CHOLMOD_PATTERN) ? <a class="code" href="Mutils_8h.html#ad0ec8e93e7bf996d7d4f241f4820c15b">Real_kind</a>(x) : 0;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    R_CheckStack();</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">if</span> (!(chx-&gt;stype))</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Nonsymmetric matrix in Csparse_symmetric_to_general&quot;</span>));</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    chgx = cholmod_copy(chx, <span class="comment">/* stype: */</span> 0, chx-&gt;xtype, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="comment">/* xtype: pattern, &quot;real&quot;, complex or .. */</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="chm__common_8c.html#a7aa1a6e564c24a55b031b5c03b3313f4">chm_sparse_to_SEXP</a>(chgx, 1, 0, Rkind, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                              <a class="code" href="Mutils_8c.html#a316a7184387d598d6ab9d48c4a9a2da8">symmetric_DimNames</a>(GET_SLOT(x, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>)));</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;}</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno"><a class="line" href="Csparse_8h.html#adf30d8deabe5bb928402465150189d79">  357</a></span>&#160;SEXP <a class="code" href="Csparse_8c.html#adf30d8deabe5bb928402465150189d79">Csparse_general_to_symmetric</a>(SEXP x, SEXP uplo, SEXP sym_dmns)</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;{</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordtype">int</span> *adims = INTEGER(GET_SLOT(x, <a class="code" href="Syms_8h.html#a2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>)), n = adims[0];</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordflow">if</span>(n != adims[1]) {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Csparse_general_to_symmetric(): matrix is not square!&quot;</span>));</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keywordflow">return</span> R_NilValue; <span class="comment">/* -Wall */</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    }</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> chx = <a class="code" href="chm__common_8h.html#a3b03d0be10b7de793f1d61046041e73e">AS_CHM_SP__</a>(x), chgx;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordtype">int</span> uploT = (*CHAR(asChar(uplo)) == <span class="charliteral">&#39;U&#39;</span>) ? 1 : -1;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordtype">int</span> Rkind = (chx-&gt;xtype != CHOLMOD_PATTERN) ? <a class="code" href="Mutils_8h.html#ad0ec8e93e7bf996d7d4f241f4820c15b">Real_kind</a>(x) : 0;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    R_CheckStack();</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    chgx = cholmod_copy(chx, <span class="comment">/* stype: */</span> uploT, chx-&gt;xtype, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    SEXP dns = GET_SLOT(x, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordflow">if</span>(asLogical(sym_dmns))</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        dns = <a class="code" href="Mutils_8c.html#a316a7184387d598d6ab9d48c4a9a2da8">symmetric_DimNames</a>(dns);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((!isNull(VECTOR_ELT(dns, 0)) &amp;&amp;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;             !isNull(VECTOR_ELT(dns, 1))) ||</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            !isNull(getAttrib(dns, R_NamesSymbol))) {</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="comment">/* symmetrize them if both are not NULL</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">         * or names(dimnames(.)) is asymmetric : */</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        dns = PROTECT(duplicate(dns));</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="Mutils_8c.html#ae0e07b5d446943159295e745388285e2">equal_string_vectors</a>(VECTOR_ELT(dns, 0),</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                                 VECTOR_ELT(dns, 1))) {</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            <span class="keywordflow">if</span>(uploT == 1)</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                SET_VECTOR_ELT(dns, 0, VECTOR_ELT(dns,1));</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                SET_VECTOR_ELT(dns, 1, VECTOR_ELT(dns,0));</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        }</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        SEXP nms_dns = getAttrib(dns, R_NamesSymbol);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <span class="keywordflow">if</span>(!isNull(nms_dns) &amp;&amp;  <span class="comment">// names(dimnames(.)) :</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;           !R_compute_identical(STRING_ELT(nms_dns, 0),</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                                STRING_ELT(nms_dns, 1), 16)) {</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            <span class="keywordflow">if</span>(uploT == 1)</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                SET_STRING_ELT(nms_dns, 0, STRING_ELT(nms_dns,1));</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                SET_STRING_ELT(nms_dns, 1, STRING_ELT(nms_dns,0));</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            setAttrib(dns, R_NamesSymbol, nms_dns);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        UNPROTECT(1);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    }</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="comment">/* xtype: pattern, &quot;real&quot;, complex or .. */</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="chm__common_8c.html#a7aa1a6e564c24a55b031b5c03b3313f4">chm_sparse_to_SEXP</a>(chgx, 1, 0, Rkind, <span class="stringliteral">&quot;&quot;</span>, dns);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;}</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div>
<div class="line"><a name="l00402"></a><span class="lineno"><a class="line" href="Csparse_8h.html#aab695b6af65c32eac1776cf04c661518">  402</a></span>&#160;SEXP <a class="code" href="Csparse_8c.html#aab695b6af65c32eac1776cf04c661518">Csparse_transpose</a>(SEXP x, SEXP tri)</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;{</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="comment">/* TODO: lgCMatrix &amp; igC* currently go via double prec. cholmod -</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">     *       since cholmod (&amp; cs) lacks sparse &#39;int&#39; matrices */</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> chx = <a class="code" href="chm__common_8h.html#a3b03d0be10b7de793f1d61046041e73e">AS_CHM_SP__</a>(x);</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="keywordtype">int</span> Rkind = (chx-&gt;xtype != CHOLMOD_PATTERN) ? <a class="code" href="Mutils_8h.html#ad0ec8e93e7bf996d7d4f241f4820c15b">Real_kind</a>(x) : 0;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> chxt = cholmod_transpose(chx, chx-&gt;xtype, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    SEXP dn = PROTECT(duplicate(GET_SLOT(x, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>))), tmp;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordtype">int</span> tr = asLogical(tri);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    R_CheckStack();</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    tmp = VECTOR_ELT(dn, 0);    <span class="comment">/* swap the dimnames */</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    SET_VECTOR_ELT(dn, 0, VECTOR_ELT(dn, 1));</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    SET_VECTOR_ELT(dn, 1, tmp);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">if</span>(!isNull(tmp = getAttrib(dn, R_NamesSymbol))) { <span class="comment">// swap names(dimnames(.)):</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        SEXP nms_dns = PROTECT(allocVector(VECSXP, 2));</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        SET_VECTOR_ELT(nms_dns, 1, STRING_ELT(tmp, 0));</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        SET_VECTOR_ELT(nms_dns, 0, STRING_ELT(tmp, 1));</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        setAttrib(dn, R_NamesSymbol, nms_dns);</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        UNPROTECT(1);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    }</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    UNPROTECT(1);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="chm__common_8c.html#a7aa1a6e564c24a55b031b5c03b3313f4">chm_sparse_to_SEXP</a>(chxt, 1, <span class="comment">/* SWAP &#39;uplo&#39; for triangular */</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                              tr ? ((*<a class="code" href="Mutils_8h.html#a3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a>(x) == <span class="charliteral">&#39;U&#39;</span>) ? -1 : 1) : 0,</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                              Rkind, tr ? <a class="code" href="Mutils_8h.html#a1e1f224c5e72ee3eb2583024db2c59e6">diag_P</a>(x) : <span class="stringliteral">&quot;&quot;</span>, dn);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;}</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div>
<div class="line"><a name="l00446"></a><span class="lineno"><a class="line" href="Csparse_8h.html#a78b6af142e571556b5b698785211d1d9">  446</a></span>&#160;SEXP <a class="code" href="Csparse_8c.html#a78b6af142e571556b5b698785211d1d9">Csparse_Csparse_prod</a>(SEXP a, SEXP b, SEXP bool_arith)</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;{</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        cha = <a class="code" href="chm__common_8h.html#a181c1e5f964ecab945a22c5309500afd">AS_CHM_SP</a>(a),</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        chb = <a class="code" href="chm__common_8h.html#a181c1e5f964ecab945a22c5309500afd">AS_CHM_SP</a>(b), chc;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    R_CheckStack();</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *valid_tri[] = { <a class="code" href="Mutils_8h.html#a3898542d8edc8f61f187ac11267d42b2">MATRIX_VALID_tri_Csparse</a>, <span class="stringliteral">&quot;&quot;</span> };</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordtype">char</span> diag[] = {<span class="charliteral">&#39;\0&#39;</span>, <span class="charliteral">&#39;\0&#39;</span>};</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keywordtype">int</span> uploT = 0, nprot = 1,</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        do_bool = asLogical(bool_arith); <span class="comment">// TRUE / NA / FALSE</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    Rboolean</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        a_is_n = (cha-&gt;xtype == CHOLMOD_PATTERN),</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        b_is_n = (chb-&gt;xtype == CHOLMOD_PATTERN),</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        force_num = (do_bool == FALSE),</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        maybe_bool= (do_bool == NA_LOGICAL);</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="preprocessor">#ifdef DEBUG_Matrix_verbose</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    Rprintf(<span class="stringliteral">&quot;DBG Csparse_C*_prod(%s, %s)\n&quot;</span>, <a class="code" href="Mutils_8h.html#ae692d23e2a86a20fccc024b05fc23df9">class_P</a>(a), <a class="code" href="Mutils_8h.html#ae692d23e2a86a20fccc024b05fc23df9">class_P</a>(b));</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordflow">if</span>(a_is_n &amp;&amp; (force_num || (maybe_bool &amp;&amp; !b_is_n))) {</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="comment">/* coerce &#39;a&#39; to  double;</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">         * have no CHOLMOD function (pattern -&gt; logical) --&gt; use &quot;our&quot; code */</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        SEXP da = PROTECT(<a class="code" href="Csparse_8c.html#a4445bf9e1d6a9ee608151123b9d3aa9f">nz2Csparse</a>(a, <a class="code" href="Mutils_8h.html#a0513d8a9f2e4f454f1fc3a59c4a6f181a2a95e471311414715f5477d7a4f11564">x_double</a>)); nprot++;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        cha = <a class="code" href="chm__common_8h.html#a181c1e5f964ecab945a22c5309500afd">AS_CHM_SP</a>(da);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        R_CheckStack();</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        a_is_n = FALSE;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(b_is_n &amp;&amp; (force_num || (maybe_bool &amp;&amp; !a_is_n))) {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="comment">// coerce &#39;b&#39; to  double</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        SEXP db = PROTECT(<a class="code" href="Csparse_8c.html#a4445bf9e1d6a9ee608151123b9d3aa9f">nz2Csparse</a>(b, <a class="code" href="Mutils_8h.html#a0513d8a9f2e4f454f1fc3a59c4a6f181a2a95e471311414715f5477d7a4f11564">x_double</a>)); nprot++;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        chb = <a class="code" href="chm__common_8h.html#a181c1e5f964ecab945a22c5309500afd">AS_CHM_SP</a>(db);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        R_CheckStack();</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        b_is_n = FALSE;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    }</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    chc = cholmod_ssmult(cha, chb, <span class="comment">/*out_stype:*/</span> 0,</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                         <span class="comment">/* values : */</span> do_bool != TRUE,</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                         <span class="comment">/* sorted = TRUE: */</span> 1, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="comment">/* Preserve triangularity and even unit-triangularity if appropriate.</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">     * Note that in that case, the multiplication itself should happen</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">     * faster.  But there&#39;s no support for that in CHOLMOD */</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">if</span>(R_check_class_etc(a, valid_tri) &gt;= 0 &amp;&amp;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;       R_check_class_etc(b, valid_tri) &gt;= 0)</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <span class="keywordflow">if</span>(*<a class="code" href="Mutils_8h.html#a3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a>(a) == *<a class="code" href="Mutils_8h.html#a3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a>(b)) { <span class="comment">/* both upper, or both lower tri. */</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            uploT = (*<a class="code" href="Mutils_8h.html#a3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a>(a) == <span class="charliteral">&#39;U&#39;</span>) ? 1 : -1;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            <span class="keywordflow">if</span>(*<a class="code" href="Mutils_8h.html#a1e1f224c5e72ee3eb2583024db2c59e6">diag_P</a>(a) == <span class="charliteral">&#39;U&#39;</span> &amp;&amp; *<a class="code" href="Mutils_8h.html#a1e1f224c5e72ee3eb2583024db2c59e6">diag_P</a>(b) == <span class="charliteral">&#39;U&#39;</span>) { <span class="comment">/* return UNIT-triag. */</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                <span class="comment">/* &quot;remove the diagonal entries&quot;: */</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                <a class="code" href="chm__common_8c.html#a713dd9a3d6095f9b55e453d18ca87d5a">chm_diagN2U</a>(chc, uploT, <span class="comment">/* do_realloc */</span> FALSE);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                diag[0]= <span class="charliteral">&#39;U&#39;</span>;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            }</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            <span class="keywordflow">else</span> diag[0]= <span class="charliteral">&#39;N&#39;</span>;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    SEXP dn = PROTECT(allocVector(VECSXP, 2));</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    SET_VECTOR_ELT(dn, 0,       <span class="comment">/* establish dimnames */</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                   duplicate(VECTOR_ELT(GET_SLOT(a, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>), 0)));</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    SET_VECTOR_ELT(dn, 1,</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                   duplicate(VECTOR_ELT(GET_SLOT(b, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>), 1)));</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    UNPROTECT(nprot);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="chm__common_8c.html#a7aa1a6e564c24a55b031b5c03b3313f4">chm_sparse_to_SEXP</a>(chc, 1, uploT, <span class="comment">/*Rkind*/</span>0, diag, dn);</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;}</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div>
<div class="line"><a name="l00520"></a><span class="lineno"><a class="line" href="Csparse_8h.html#a86239e094c5ee16dfc9892f09e8077d9">  520</a></span>&#160;SEXP <a class="code" href="Csparse_8c.html#a86239e094c5ee16dfc9892f09e8077d9">Csparse_Csparse_crossprod</a>(SEXP a, SEXP b, SEXP trans, SEXP bool_arith)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;{</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordtype">int</span> tr = asLogical(trans), nprot = 1,</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        do_bool = asLogical(bool_arith); <span class="comment">// TRUE / NA / FALSE</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        cha = <a class="code" href="chm__common_8h.html#a181c1e5f964ecab945a22c5309500afd">AS_CHM_SP</a>(a),</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        chb = <a class="code" href="chm__common_8h.html#a181c1e5f964ecab945a22c5309500afd">AS_CHM_SP</a>(b),</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        chTr, chc;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    R_CheckStack();</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *valid_tri[] = { <a class="code" href="Mutils_8h.html#a3898542d8edc8f61f187ac11267d42b2">MATRIX_VALID_tri_Csparse</a>, <span class="stringliteral">&quot;&quot;</span> };</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordtype">char</span> diag[] = {<span class="charliteral">&#39;\0&#39;</span>, <span class="charliteral">&#39;\0&#39;</span>};</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordtype">int</span> uploT = 0;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    Rboolean</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        a_is_n = (cha-&gt;xtype == CHOLMOD_PATTERN),</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        b_is_n = (chb-&gt;xtype == CHOLMOD_PATTERN),</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        force_num = (do_bool == FALSE),</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        maybe_bool= (do_bool == NA_LOGICAL);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keywordflow">if</span>(a_is_n &amp;&amp; (force_num || (maybe_bool &amp;&amp; !b_is_n))) {</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="comment">// coerce &#39;a&#39; to  double</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        SEXP da = PROTECT(<a class="code" href="Csparse_8c.html#a4445bf9e1d6a9ee608151123b9d3aa9f">nz2Csparse</a>(a, <a class="code" href="Mutils_8h.html#a0513d8a9f2e4f454f1fc3a59c4a6f181a2a95e471311414715f5477d7a4f11564">x_double</a>)); nprot++;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        cha = <a class="code" href="chm__common_8h.html#a181c1e5f964ecab945a22c5309500afd">AS_CHM_SP</a>(da);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        R_CheckStack();</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <span class="comment">// a_is_n = FALSE;</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    }</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(b_is_n &amp;&amp; (force_num || (maybe_bool &amp;&amp; !a_is_n))) {</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="comment">// coerce &#39;b&#39; to  double</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        SEXP db = PROTECT(<a class="code" href="Csparse_8c.html#a4445bf9e1d6a9ee608151123b9d3aa9f">nz2Csparse</a>(b, <a class="code" href="Mutils_8h.html#a0513d8a9f2e4f454f1fc3a59c4a6f181a2a95e471311414715f5477d7a4f11564">x_double</a>)); nprot++;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        chb = <a class="code" href="chm__common_8h.html#a181c1e5f964ecab945a22c5309500afd">AS_CHM_SP</a>(db);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        R_CheckStack();</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <span class="comment">// b_is_n = FALSE;</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    }</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(do_bool == TRUE) { <span class="comment">// Want boolean arithmetic: sufficient if *one* is pattern:</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <span class="keywordflow">if</span>(!a_is_n &amp;&amp; !b_is_n) {</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            <span class="comment">// coerce &#39;a&#39; to pattern</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            SEXP da = PROTECT(<a class="code" href="Csparse_8c.html#ad902ff7d08b94c85a1ffb1b4c2c4e247">Csparse2nz</a>(a, <span class="comment">/* tri = */</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                                         R_check_class_etc(a, valid_tri) &gt;= 0)); nprot++;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            cha = <a class="code" href="chm__common_8h.html#a181c1e5f964ecab945a22c5309500afd">AS_CHM_SP</a>(da);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            R_CheckStack();</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            <span class="comment">// a_is_n = TRUE;</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    chTr = cholmod_transpose((tr) ? chb : cha, chb-&gt;xtype, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    chc = cholmod_ssmult((tr) ? cha : chTr, (tr) ? chTr : chb,</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                         <span class="comment">/*out_stype:*/</span> 0, <span class="comment">/* values : */</span> do_bool != TRUE,</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                         <span class="comment">/* sorted = TRUE: */</span> 1, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    cholmod_free_sparse(&amp;chTr, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="comment">/* Preserve triangularity and unit-triangularity if appropriate;</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">     * see Csparse_Csparse_prod() for comments */</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordflow">if</span>(R_check_class_etc(a, valid_tri) &gt;= 0 &amp;&amp;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;       R_check_class_etc(b, valid_tri) &gt;= 0)</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="keywordflow">if</span>(*<a class="code" href="Mutils_8h.html#a3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a>(a) != *<a class="code" href="Mutils_8h.html#a3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a>(b)) { <span class="comment">/* one &#39;U&#39;, the other &#39;L&#39; */</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            uploT = (*<a class="code" href="Mutils_8h.html#a3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a>(b) == <span class="charliteral">&#39;U&#39;</span>) ? 1 : -1;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            <span class="keywordflow">if</span>(*<a class="code" href="Mutils_8h.html#a1e1f224c5e72ee3eb2583024db2c59e6">diag_P</a>(a) == <span class="charliteral">&#39;U&#39;</span> &amp;&amp; *<a class="code" href="Mutils_8h.html#a1e1f224c5e72ee3eb2583024db2c59e6">diag_P</a>(b) == <span class="charliteral">&#39;U&#39;</span>) { <span class="comment">/* return UNIT-triag. */</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                <a class="code" href="chm__common_8c.html#a713dd9a3d6095f9b55e453d18ca87d5a">chm_diagN2U</a>(chc, uploT, <span class="comment">/* do_realloc */</span> FALSE);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                diag[0]= <span class="charliteral">&#39;U&#39;</span>;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            }</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            <span class="keywordflow">else</span> diag[0]= <span class="charliteral">&#39;N&#39;</span>;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        }</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    SEXP dn = PROTECT(allocVector(VECSXP, 2));</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    SET_VECTOR_ELT(dn, 0,       <span class="comment">/* establish dimnames */</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                   duplicate(VECTOR_ELT(GET_SLOT(a, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>),</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                                        (tr) ? 0 : 1)));</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    SET_VECTOR_ELT(dn, 1,</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                   duplicate(VECTOR_ELT(GET_SLOT(b, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>),</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                                        (tr) ? 0 : 1)));</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    UNPROTECT(nprot);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="chm__common_8c.html#a7aa1a6e564c24a55b031b5c03b3313f4">chm_sparse_to_SEXP</a>(chc, 1, uploT, <span class="comment">/*Rkind*/</span>0, diag, dn);</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;}</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;SEXP <a class="code" href="Csparse_8h.html#ac666003ee4dca32e779db1e7b12dc83b">Csp_dense_products</a>(SEXP a, SEXP b,</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                        Rboolean transp_a, Rboolean transp_b, Rboolean transp_ans)</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;{</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> cha = <a class="code" href="chm__common_8h.html#a181c1e5f964ecab945a22c5309500afd">AS_CHM_SP</a>(a);</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="keywordtype">int</span> a_nc = transp_a ? cha-&gt;nrow : cha-&gt;ncol,</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        a_nr = transp_a ? cha-&gt;ncol : cha-&gt;nrow;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    Rboolean</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        maybe_transp_b = (a_nc == 1),</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        b_is_vector = FALSE;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="comment">/* NOTE: trans_b {&lt;--&gt; &quot;use t(b) instead of b&quot; }</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment">       ----  &quot;interferes&quot; with the  case automatic treatment of *vector* b.</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment">       In that case,  t(b) or b is used &quot;whatever make more sense&quot;,</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment">       according to the general R philosophy of treating vectors in matrix products.</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="comment">/* repeating a &quot;cheap part&quot; of  mMatrix_as_dgeMatrix2(b, .)  to see if</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">     * we have a vector that we might &#39;transpose_if_vector&#39; : */</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *valid[] = {<span class="stringliteral">&quot;_NOT_A_CLASS_&quot;</span>, <a class="code" href="Mutils_8h.html#ad0ba53374133b404c7ff06812f438991">MATRIX_VALID_ddense</a>, <span class="stringliteral">&quot;&quot;</span>};</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="comment">/* int ctype = R_check_class_etc(b, valid);</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment">     * if (ctype &gt; 0)   /.* a ddenseMatrix object */</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordflow">if</span> (R_check_class_etc(b, valid) &lt; 0) {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        <span class="comment">// not a ddenseM*:  is.matrix() or vector:</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        b_is_vector = !isMatrix(b);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    }</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keywordflow">if</span>(b_is_vector) {</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <span class="comment">/* determine *if* we want/need to transpose at all:</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">         * if (length(b) == ncol(A)) have match: use dim = c(n, 1) (&lt;=&gt; do *not* transp);</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment">         *  otherwise, try to transpose: ok  if (ncol(A) == 1) [see also above]:  */</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        maybe_transp_b = (LENGTH(b) != a_nc);</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <span class="comment">// Here, we transpose already in mMatrix_as_dge*()  ==&gt; don&#39;t do it later:</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        transp_b = FALSE;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    }</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    SEXP b_M = PROTECT(<a class="code" href="Mutils_8h.html#a3afc658317ae5a0e0589862a48b217b5">mMatrix_as_dgeMatrix2</a>(b, maybe_transp_b));</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <a class="code" href="chm__common_8h.html#abaf1012d71b21d1b412add9042b5ac2b">CHM_DN</a> chb = <a class="code" href="chm__common_8h.html#aaa0424486b25ff64e947e1946f1c1b2c">AS_CHM_DN</a>(b_M), b_t;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    R_CheckStack();</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordtype">int</span> ncol_b;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="keywordflow">if</span>(transp_b) { <span class="comment">// transpose b:</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        b_t = cholmod_allocate_dense(chb-&gt;ncol, chb-&gt;nrow, chb-&gt;ncol, chb-&gt;xtype, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <a class="code" href="chm__common_8c.html#aadc2aa8d2f836520f068863dbe700a19">chm_transpose_dense</a>(b_t, chb);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        ncol_b = b_t-&gt;ncol;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    } <span class="keywordflow">else</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        ncol_b = chb-&gt;ncol;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="comment">// Result C {with dim() before it may be transposed}:</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <a class="code" href="chm__common_8h.html#abaf1012d71b21d1b412add9042b5ac2b">CHM_DN</a> chc = cholmod_allocate_dense(a_nr, ncol_b, a_nr, chb-&gt;xtype, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordtype">double</span> one[] = {1,0}, zero[] = {0,0};</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordtype">int</span> nprot = 2;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="comment">/* Tim Davis, please FIXME:  currently (2010-11) *fails* when  a  is a pattern matrix:*/</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">if</span>(cha-&gt;xtype == CHOLMOD_PATTERN) {</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <span class="comment">/* warning(_(&quot;Csparse_dense_prod(): cholmod_sdmult() not yet implemented for pattern./ ngCMatrix&quot; */</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="comment">/*        &quot; --&gt; slightly inefficient coercion&quot;)); */</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        <span class="comment">// This *fails* to produce a CHOLMOD_REAL ..</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <span class="comment">// CHM_SP chd = cholmod_l_copy(cha, cha-&gt;stype, CHOLMOD_REAL, &amp;c);</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        <span class="comment">// --&gt; use our Matrix-classes</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        SEXP da = PROTECT(<a class="code" href="Csparse_8c.html#a4445bf9e1d6a9ee608151123b9d3aa9f">nz2Csparse</a>(a, <a class="code" href="Mutils_8h.html#a0513d8a9f2e4f454f1fc3a59c4a6f181a2a95e471311414715f5477d7a4f11564">x_double</a>)); nprot++;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        cha = <a class="code" href="chm__common_8h.html#a181c1e5f964ecab945a22c5309500afd">AS_CHM_SP</a>(da);</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    }</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="comment">/* cholmod_sdmult(A, transp, alpha, beta, X,  Y,  &amp;c): depending on transp == 0 / != 0:</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment">     *  Y := alpha*(A*X) + beta*Y or alpha*(A&#39;*X) + beta*Y;  here, alpha = 1, beta = 0:</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">     *  Y := A*X  or  A&#39;*X</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment">     *                       NB: always  &lt;sparse&gt; %*% &lt;dense&gt; !</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    cholmod_sdmult(cha, transp_a, one, zero, (transp_b ? b_t : chb), <span class="comment">/* -&gt; */</span> chc, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    SEXP dn = PROTECT(allocVector(VECSXP, 2));  <span class="comment">/* establish dimnames */</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    SET_VECTOR_ELT(dn, transp_ans ? 1 : 0,</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                   duplicate(VECTOR_ELT(GET_SLOT(a, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>), transp_a ? 1 : 0)));</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    SET_VECTOR_ELT(dn, transp_ans ? 0 : 1,</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                   duplicate(VECTOR_ELT(GET_SLOT(b_M, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>),</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                                        transp_b ? 0 : 1)));</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">if</span>(transp_b) cholmod_free_dense(&amp;b_t, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    UNPROTECT(nprot);</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="chm__common_8c.html#ad8cdbb3c526b503d3620b16e2cf522ad">chm_dense_to_SEXP</a>(chc, 1, 0, dn, transp_ans);</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;}</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;SEXP <a class="code" href="Csparse_8h.html#aeb0fcf19e652c4dca8e4b75f6e0942a6">Csparse_dense_prod</a>(SEXP a, SEXP b, SEXP transp)</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;{</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        <a class="code" href="Csparse_8h.html#ac666003ee4dca32e779db1e7b12dc83b">Csp_dense_products</a>(a, b,</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                <span class="comment">/* transp_a = */</span> FALSE,</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                <span class="comment">/* transp_b   = */</span> (*CHAR(asChar(transp)) == <span class="charliteral">&#39;2&#39;</span> || *CHAR(asChar(transp)) == <span class="charliteral">&#39;B&#39;</span>),</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                <span class="comment">/* transp_ans = */</span> (*CHAR(asChar(transp)) == <span class="charliteral">&#39;c&#39;</span> || *CHAR(asChar(transp)) == <span class="charliteral">&#39;B&#39;</span>));</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;}</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;SEXP <a class="code" href="Csparse_8h.html#a7c1f024791eaa91a0325914d130892b7">Csparse_dense_crossprod</a>(SEXP a, SEXP b, SEXP transp)</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;{</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <a class="code" href="Csparse_8h.html#ac666003ee4dca32e779db1e7b12dc83b">Csp_dense_products</a>(a, b,</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                <span class="comment">/* transp_a = */</span> TRUE,</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                <span class="comment">/* transp_b   = */</span> (*CHAR(asChar(transp)) == <span class="charliteral">&#39;2&#39;</span> || *CHAR(asChar(transp)) == <span class="charliteral">&#39;B&#39;</span>),</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                <span class="comment">/* transp_ans = */</span> (*CHAR(asChar(transp)) == <span class="charliteral">&#39;c&#39;</span> || *CHAR(asChar(transp)) == <span class="charliteral">&#39;B&#39;</span>));</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;}</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;SEXP <a class="code" href="Csparse_8h.html#aa2237e82e0b9e68dda7fed39523de6cd">Csparse_crossprod</a>(SEXP x, SEXP trans, SEXP triplet, SEXP bool_arith)</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;{</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="keywordtype">int</span> tripl = asLogical(triplet),</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        tr   = asLogical(trans), <span class="comment">/* gets reversed because _aat is tcrossprod */</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        do_bool = asLogical(bool_arith); <span class="comment">// TRUE / NA / FALSE</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="preprocessor">#ifdef AS_CHM_DIAGU2N_FIXED_FINALLY</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <a class="code" href="chm__common_8h.html#a206da8c29e7321f7aa00a1590b5362ad">CHM_TR</a> cht = tripl ? <a class="code" href="chm__common_8h.html#a0de4ac732ba359948e3b377352f99b97">AS_CHM_TR</a>(x) : (<a class="code" href="chm__common_8h.html#a206da8c29e7321f7aa00a1590b5362ad">CHM_TR</a>) NULL;  <span class="keywordtype">int</span> nprot = 1;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="preprocessor">#else </span><span class="comment">/* workaround needed:*/</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    SEXP xx = PROTECT(<a class="code" href="Tsparse_8c.html#a1b1ca7081cfcbef11f1cafc4270412ed">Tsparse_diagU2N</a>(x));</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <a class="code" href="chm__common_8h.html#a206da8c29e7321f7aa00a1590b5362ad">CHM_TR</a> cht = tripl ? <a class="code" href="chm__common_8h.html#a609d3f02935d257aa6d23b49ea811dd4">AS_CHM_TR__</a>(xx) : (<a class="code" href="chm__common_8h.html#a206da8c29e7321f7aa00a1590b5362ad">CHM_TR</a>) NULL; <span class="keywordtype">int</span> nprot = 2;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> chcp, chxt, chxc,</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        chx = (tripl ?</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;               cholmod_triplet_to_sparse(cht, cht-&gt;nnz, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>) :</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;               <a class="code" href="chm__common_8h.html#a181c1e5f964ecab945a22c5309500afd">AS_CHM_SP</a>(x));</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    SEXP dn = PROTECT(allocVector(VECSXP, 2));</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    R_CheckStack();</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    Rboolean</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        x_is_n = (chx-&gt;xtype == CHOLMOD_PATTERN),</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        x_is_sym = chx-&gt;stype != 0,</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        force_num = (do_bool == FALSE);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keywordflow">if</span>(x_is_n &amp;&amp; force_num) {</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        <span class="comment">// coerce &#39;x&#39; to  double</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        SEXP dx = PROTECT(<a class="code" href="Csparse_8c.html#a4445bf9e1d6a9ee608151123b9d3aa9f">nz2Csparse</a>(x, <a class="code" href="Mutils_8h.html#a0513d8a9f2e4f454f1fc3a59c4a6f181a2a95e471311414715f5477d7a4f11564">x_double</a>)); nprot++;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        chx = <a class="code" href="chm__common_8h.html#a181c1e5f964ecab945a22c5309500afd">AS_CHM_SP</a>(dx);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        R_CheckStack();</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    }</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(do_bool == TRUE &amp;&amp; !x_is_n) { <span class="comment">// Want boolean arithmetic; need patter[n]</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="comment">// coerce &#39;x&#39; to pattern</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *valid_tri[] = { <a class="code" href="Mutils_8h.html#a3898542d8edc8f61f187ac11267d42b2">MATRIX_VALID_tri_Csparse</a>, <span class="stringliteral">&quot;&quot;</span> };</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        SEXP dx = PROTECT(<a class="code" href="Csparse_8c.html#ad902ff7d08b94c85a1ffb1b4c2c4e247">Csparse2nz</a>(x, <span class="comment">/* tri = */</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                                     R_check_class_etc(x, valid_tri) &gt;= 0)); nprot++;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        chx = <a class="code" href="chm__common_8h.html#a181c1e5f964ecab945a22c5309500afd">AS_CHM_SP</a>(dx);</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        R_CheckStack();</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    }</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="keywordflow">if</span> (!tr) chxt = cholmod_transpose(chx, chx-&gt;xtype, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordflow">if</span> (x_is_sym) <span class="comment">// cholmod_aat() does not like symmetric</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        chxc = cholmod_copy(tr ? chx : chxt, <span class="comment">/* stype: */</span> 0,</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                            chx-&gt;xtype, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="comment">// CHOLMOD/Core/cholmod_aat.c :</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    chcp = cholmod_aat(x_is_sym ? chxc : (tr ? chx : chxt),</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                       (<span class="keywordtype">int</span> *) NULL, 0, <span class="comment">/* mode: */</span> chx-&gt;xtype, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="keywordflow">if</span>(!chcp) {</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        UNPROTECT(1);</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Csparse_crossprod(): error return from cholmod_aat()&quot;</span>));</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    }</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    cholmod_band_inplace(0, chcp-&gt;ncol, chcp-&gt;xtype, chcp, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    chcp-&gt;stype = 1; <span class="comment">// symmetric</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="keywordflow">if</span> (tripl) cholmod_free_sparse(&amp;chx, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="keywordflow">if</span> (!tr) cholmod_free_sparse(&amp;chxt, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    SET_VECTOR_ELT(dn, 0,       <span class="comment">/* establish dimnames */</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                   duplicate(VECTOR_ELT(GET_SLOT(x, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>),</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                                        (tr) ? 0 : 1)));</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    SET_VECTOR_ELT(dn, 1, duplicate(VECTOR_ELT(dn, 0)));</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    UNPROTECT(nprot);</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="comment">// FIXME: uploT for symmetric ?</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="chm__common_8c.html#a7aa1a6e564c24a55b031b5c03b3313f4">chm_sparse_to_SEXP</a>(chcp, 1, 0, 0, <span class="stringliteral">&quot;&quot;</span>, dn);</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;}</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;SEXP <a class="code" href="Csparse_8h.html#a1d165b31075f32ee0ca273f51c13f9df">Csparse_drop</a>(SEXP x, SEXP tol)</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;{</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="chm__common_8c.html#ac49bea018a4b4cb10cd713589039cdda">cl</a> = <a class="code" href="Mutils_8h.html#ae692d23e2a86a20fccc024b05fc23df9">class_P</a>(x);</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="comment">/* dtCMatrix, etc; [1] = the second character =?= &#39;t&#39; for triangular */</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordtype">int</span> tr = (cl[1] == <span class="charliteral">&#39;t&#39;</span>); <span class="comment">// FIXME - rather  R_check_class_etc(..)</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> chx = <a class="code" href="chm__common_8h.html#a3b03d0be10b7de793f1d61046041e73e">AS_CHM_SP__</a>(x);</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> ans = cholmod_copy(chx, chx-&gt;stype, chx-&gt;xtype, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordtype">double</span> dtol = asReal(tol);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keywordtype">int</span> Rkind = (chx-&gt;xtype != CHOLMOD_PATTERN) ? <a class="code" href="Mutils_8h.html#ad0ec8e93e7bf996d7d4f241f4820c15b">Real_kind</a>(x) : 0;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    R_CheckStack();</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="keywordflow">if</span>(!cholmod_drop(dtol, ans, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>))</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;cholmod_drop() failed&quot;</span>));</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="chm__common_8c.html#a7aa1a6e564c24a55b031b5c03b3313f4">chm_sparse_to_SEXP</a>(ans, 1,</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                              tr ? ((*<a class="code" href="Mutils_8h.html#a3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a>(x) == <span class="charliteral">&#39;U&#39;</span>) ? 1 : -1) : 0,</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                              Rkind, tr ? <a class="code" href="Mutils_8h.html#a1e1f224c5e72ee3eb2583024db2c59e6">diag_P</a>(x) : <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                              GET_SLOT(x, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>));</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;}</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;SEXP <a class="code" href="Csparse_8h.html#a8973a306b51dbd6b2b66b21185bf048a">Csparse_horzcat</a>(SEXP x, SEXP y)</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;{</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="preprocessor">#define CSPARSE_CAT(_KIND_)                                             \</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="preprocessor">    CHM_SP chx = AS_CHM_SP__(x), chy = AS_CHM_SP__(y);                  \</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="preprocessor">    R_CheckStack();                                                     \</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="preprocessor">    int Rk_x = (chx-&gt;xtype != CHOLMOD_PATTERN) ? Real_kind(x) : -3,     \</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="preprocessor">        Rk_y = (chy-&gt;xtype != CHOLMOD_PATTERN) ? Real_kind(y) : -3, Rkind; \</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="preprocessor">    if(Rk_x == -3 || Rk_y == -3) { </span><span class="comment">/* at least one of them is patter&quot;n&quot; */</span><span class="preprocessor"> \</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="preprocessor">        if(Rk_x == -3 &amp;&amp; Rk_y == -3) { </span><span class="comment">/* fine */</span><span class="preprocessor">                       \</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="preprocessor">        } else { </span><span class="comment">/* only one is a patter&quot;n&quot;                             \</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="comment">                  * &quot;Bug&quot; in cholmod_horzcat()/vertcat(): returns patter&quot;n&quot; matrix if one of them is */</span><span class="preprocessor"> \</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="preprocessor">            Rboolean ok;                                                \</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="preprocessor">            if(Rk_x == -3) {                                            \</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="preprocessor">                ok = chm_MOD_xtype(CHOLMOD_REAL, chx, &amp;c); Rk_x = 0;    \</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="preprocessor">            } else if(Rk_y == -3) {                                     \</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="preprocessor">                ok = chm_MOD_xtype(CHOLMOD_REAL, chy, &amp;c); Rk_y = 0;    \</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="preprocessor">            } else                                                      \</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="preprocessor">                error(_(&quot;Impossible Rk_x/Rk_y in Csparse_%s(), please report&quot;), _KIND_); \</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="preprocessor">            if(!ok)                                                     \</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="preprocessor">                error(_(&quot;chm_MOD_xtype() was not successful in Csparse_%s(), please report&quot;), \</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="preprocessor">                      _KIND_);                                          \</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="preprocessor">        }                                                               \</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="preprocessor">    }                                                                   \</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="preprocessor">    Rkind = </span><span class="comment">/* logical if both x and y are */</span><span class="preprocessor"> (Rk_x == 1 &amp;&amp; Rk_y == 1) ? 1 : 0</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    CSPARSE_CAT(<span class="stringliteral">&quot;horzcat&quot;</span>);</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="comment">// TODO: currently drops dimnames - and we fix at R level;</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="chm__common_8c.html#a7aa1a6e564c24a55b031b5c03b3313f4">chm_sparse_to_SEXP</a>(cholmod_horzcat(chx, chy, 1, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>),</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;                              1, 0, Rkind, <span class="stringliteral">&quot;&quot;</span>, R_NilValue);</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;}</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;SEXP <a class="code" href="Csparse_8h.html#a913d061ccf8536244aae6b7157c105f1">Csparse_vertcat</a>(SEXP x, SEXP y)</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;{</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    CSPARSE_CAT(<span class="stringliteral">&quot;vertcat&quot;</span>);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="comment">// TODO: currently drops dimnames - and we fix at R level;</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="chm__common_8c.html#a7aa1a6e564c24a55b031b5c03b3313f4">chm_sparse_to_SEXP</a>(cholmod_vertcat(chx, chy, 1, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>),</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                              1, 0, Rkind, <span class="stringliteral">&quot;&quot;</span>, R_NilValue);</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;}</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;SEXP <a class="code" href="Csparse_8h.html#a546eddc63011f2f2af462894dbec7dc9">Csparse_band</a>(SEXP x, SEXP k1, SEXP k2)</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;{</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> chx = <a class="code" href="chm__common_8h.html#a3b03d0be10b7de793f1d61046041e73e">AS_CHM_SP__</a>(x);</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="keywordtype">int</span> Rkind = (chx-&gt;xtype != CHOLMOD_PATTERN) ? <a class="code" href="Mutils_8h.html#ad0ec8e93e7bf996d7d4f241f4820c15b">Real_kind</a>(x) : 0;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> ans = cholmod_band(chx, asInteger(k1), asInteger(k2), chx-&gt;xtype, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    R_CheckStack();</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="chm__common_8c.html#a7aa1a6e564c24a55b031b5c03b3313f4">chm_sparse_to_SEXP</a>(ans, 1, 0, Rkind, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                              GET_SLOT(x, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>));</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;}</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;SEXP <a class="code" href="Csparse_8h.html#a0cc8d2f7047736ee111b11cb2faeaf11">Csparse_diagU2N</a>(SEXP x)</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;{</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *cl = <a class="code" href="Mutils_8h.html#ae692d23e2a86a20fccc024b05fc23df9">class_P</a>(x);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="comment">/* dtCMatrix, etc; [1] = the second character =?= &#39;t&#39; for triangular */</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <span class="keywordflow">if</span> (cl[1] != <span class="charliteral">&#39;t&#39;</span> || *<a class="code" href="Mutils_8h.html#a1e1f224c5e72ee3eb2583024db2c59e6">diag_P</a>(x) != <span class="charliteral">&#39;U&#39;</span>) {</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        <span class="comment">/* &quot;trivially fast&quot; when not triangular (&lt;==&gt; no &#39;diag&#39; slot),</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="comment">           or not *unit* triangular */</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <span class="keywordflow">return</span> (x);</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    }</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keywordflow">else</span> { <span class="comment">/* unit triangular (diag=&#39;U&#39;): &quot;fill the diagonal&quot; &amp; diag:= &quot;N&quot; */</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> chx = <a class="code" href="chm__common_8h.html#a3b03d0be10b7de793f1d61046041e73e">AS_CHM_SP__</a>(x);</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> eye = cholmod_speye(chx-&gt;nrow, chx-&gt;ncol, chx-&gt;xtype, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        <span class="keywordtype">double</span> one[] = {1, 0};</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> ans = cholmod_add(chx, eye, one, one, TRUE, TRUE, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        <span class="keywordtype">int</span> uploT = (*<a class="code" href="Mutils_8h.html#a3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a>(x) == <span class="charliteral">&#39;U&#39;</span>) ? 1 : -1;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        <span class="keywordtype">int</span> Rkind = (chx-&gt;xtype != CHOLMOD_PATTERN) ? <a class="code" href="Mutils_8h.html#ad0ec8e93e7bf996d7d4f241f4820c15b">Real_kind</a>(x) : 0;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        R_CheckStack();</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        cholmod_free_sparse(&amp;eye, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="chm__common_8c.html#a7aa1a6e564c24a55b031b5c03b3313f4">chm_sparse_to_SEXP</a>(ans, 1, uploT, Rkind, <span class="stringliteral">&quot;N&quot;</span>,</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                                  GET_SLOT(x, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>));</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    }</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;}</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;SEXP <a class="code" href="Csparse_8h.html#a316d9d78254bf71714b3e44ac4ec6b01">Csparse_diagN2U</a>(SEXP x)</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;{</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *cl = <a class="code" href="Mutils_8h.html#ae692d23e2a86a20fccc024b05fc23df9">class_P</a>(x);</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <span class="comment">/* dtCMatrix, etc; [1] = the second character =?= &#39;t&#39; for triangular */</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="keywordflow">if</span> (cl[1] != <span class="charliteral">&#39;t&#39;</span> || *<a class="code" href="Mutils_8h.html#a1e1f224c5e72ee3eb2583024db2c59e6">diag_P</a>(x) != <span class="charliteral">&#39;N&#39;</span>) {</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="comment">/* &quot;trivially fast&quot; when not triangular (&lt;==&gt; no &#39;diag&#39; slot),</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="comment">           or already *unit* triangular */</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <span class="keywordflow">return</span> (x);</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    }</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keywordflow">else</span> { <span class="comment">/* triangular with diag=&#39;N&#39;): now drop the diagonal */</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <span class="comment">/* duplicate, since chx will be modified: */</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        SEXP xx = PROTECT(duplicate(x));</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> chx = <a class="code" href="chm__common_8h.html#a3b03d0be10b7de793f1d61046041e73e">AS_CHM_SP__</a>(xx);</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        <span class="keywordtype">int</span> uploT = (*<a class="code" href="Mutils_8h.html#a3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a>(x) == <span class="charliteral">&#39;U&#39;</span>) ? 1 : -1,</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            Rkind = (chx-&gt;xtype != CHOLMOD_PATTERN) ? <a class="code" href="Mutils_8h.html#ad0ec8e93e7bf996d7d4f241f4820c15b">Real_kind</a>(x) : 0;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        R_CheckStack();</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        <a class="code" href="chm__common_8c.html#a713dd9a3d6095f9b55e453d18ca87d5a">chm_diagN2U</a>(chx, uploT, <span class="comment">/* do_realloc */</span> FALSE);</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        SEXP ans = <a class="code" href="chm__common_8c.html#a7aa1a6e564c24a55b031b5c03b3313f4">chm_sparse_to_SEXP</a>(chx, <span class="comment">/*dofree*/</span> 0<span class="comment">/* or 1 ?? */</span>,</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                                      uploT, Rkind, <span class="stringliteral">&quot;U&quot;</span>,</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                                      GET_SLOT(x, <a class="code" href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>));</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        UNPROTECT(1);<span class="comment">// only now !</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    }</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;}</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;SEXP <a class="code" href="Csparse_8h.html#abfee8cfe834c57a1bb2144ee157b83dc">Csparse_submatrix</a>(SEXP x, SEXP i, SEXP j)</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;{</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> chx = <a class="code" href="chm__common_8h.html#a181c1e5f964ecab945a22c5309500afd">AS_CHM_SP</a>(x); <span class="comment">/* &lt;&lt; does diagU2N() when needed */</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <span class="keywordtype">int</span> rsize = (isNull(i)) ? -1 : LENGTH(i),</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        csize = (isNull(j)) ? -1 : LENGTH(j);</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="keywordtype">int</span> Rkind = (chx-&gt;xtype != CHOLMOD_PATTERN) ? <a class="code" href="Mutils_8h.html#ad0ec8e93e7bf996d7d4f241f4820c15b">Real_kind</a>(x) : 0;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    R_CheckStack();</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <span class="keywordflow">if</span> (rsize &gt;= 0 &amp;&amp; !isInteger(i))</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Index i must be NULL or integer&quot;</span>));</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="keywordflow">if</span> (csize &gt;= 0 &amp;&amp; !isInteger(j))</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Index j must be NULL or integer&quot;</span>));</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="preprocessor">#define CHM_SUB(_M_, _i_, _j_)                                  \</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="preprocessor">    cholmod_submatrix(_M_,                                      \</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="preprocessor">                      (rsize &lt; 0) ? NULL : INTEGER(_i_), rsize, \</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="preprocessor">                      (csize &lt; 0) ? NULL : INTEGER(_j_), csize, \</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="preprocessor">                      TRUE, TRUE, &amp;c)</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> ans;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="keywordflow">if</span> (!chx-&gt;stype) {<span class="comment">/* non-symmetric Matrix */</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        ans = CHM_SUB(chx, i, j);</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    }</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        <span class="comment">/* for now, cholmod_submatrix() only accepts &quot;generalMatrix&quot; */</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> tmp = cholmod_copy(chx, <span class="comment">/* stype: */</span> 0, chx-&gt;xtype, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        ans = CHM_SUB(tmp, i, j);</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        cholmod_free_sparse(&amp;tmp, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    }</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <span class="comment">// &quot;FIXME&quot;: currently dropping dimnames, and adding them afterwards in R :</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="comment">/* // dimnames: */</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="comment">/* SEXP x_dns = GET_SLOT(x, Matrix_DimNamesSym), */</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="comment">/*  dn = PROTECT(allocVector(VECSXP, 2)); */</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="chm__common_8c.html#a7aa1a6e564c24a55b031b5c03b3313f4">chm_sparse_to_SEXP</a>(ans, 1, 0, Rkind, <span class="stringliteral">&quot;&quot;</span>, <span class="comment">/* dimnames: */</span> R_NilValue);</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;}</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="preprocessor">#define _d_Csp_</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="t__Csparse__subassign_8c.html">t_Csparse_subassign.c</a>&quot;</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="preprocessor">#define _l_Csp_</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="t__Csparse__subassign_8c.html">t_Csparse_subassign.c</a>&quot;</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="preprocessor">#define _i_Csp_</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="t__Csparse__subassign_8c.html">t_Csparse_subassign.c</a>&quot;</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="preprocessor">#define _n_Csp_</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="t__Csparse__subassign_8c.html">t_Csparse_subassign.c</a>&quot;</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="preprocessor">#define _z_Csp_</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="t__Csparse__subassign_8c.html">t_Csparse_subassign.c</a>&quot;</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;SEXP <a class="code" href="Csparse_8h.html#a0ff90b74963cd2db63b8cc7542d5aa96">Csparse_MatrixMarket</a>(SEXP x, SEXP fname)</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;{</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    FILE *f = fopen(CHAR(asChar(fname)), <span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keywordflow">if</span> (!f)</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;failure to open file \&quot;%s\&quot; for writing&quot;</span>),</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;              CHAR(asChar(fname)));</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="keywordflow">if</span> (!cholmod_write_sparse(f, <a class="code" href="chm__common_8h.html#a181c1e5f964ecab945a22c5309500afd">AS_CHM_SP</a>(x),</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                              (<a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a>)NULL, (<span class="keywordtype">char</span>*) NULL, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>))</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;cholmod_write_sparse returned error code&quot;</span>));</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    fclose(f);</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="keywordflow">return</span> R_NilValue;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;}</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;SEXP <a class="code" href="Csparse_8h.html#a70db694dbe8d7c65d6aa8b6ebc124c0f">diag_tC_ptr</a>(<span class="keywordtype">int</span> n, <span class="keywordtype">int</span> *x_p, <span class="keywordtype">double</span> *x_x, Rboolean is_U, <span class="keywordtype">int</span> *perm,</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="comment">/*                                ^^^^^^ FIXME[Generalize] to int / ... */</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                 SEXP resultKind)</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;{</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* res_ch = CHAR(STRING_ELT(resultKind,0));</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <span class="keyword">enum</span> diag_kind { diag, diag_backpermuted, trace, prod, sum_log, min, max, range</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    } res_kind = ((!strcmp(res_ch, <span class="stringliteral">&quot;trace&quot;</span>)) ? trace :</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                  ((!strcmp(res_ch, <span class="stringliteral">&quot;sumLog&quot;</span>)) ? sum_log :</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;                   ((!strcmp(res_ch, <span class="stringliteral">&quot;prod&quot;</span>)) ? prod :</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;                    ((!strcmp(res_ch, <span class="stringliteral">&quot;min&quot;</span>)) ? min :</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                     ((!strcmp(res_ch, <span class="stringliteral">&quot;max&quot;</span>)) ? max :</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;                      ((!strcmp(res_ch, <span class="stringliteral">&quot;range&quot;</span>)) ? range :</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                       ((!strcmp(res_ch, <span class="stringliteral">&quot;diag&quot;</span>)) ? diag :</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                        ((!strcmp(res_ch, <span class="stringliteral">&quot;diagBack&quot;</span>)) ? diag_backpermuted :</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                         -1))))))));</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="keywordtype">int</span> i, n_x, i_from;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    SEXP ans = PROTECT(allocVector(REALSXP,</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment">/*                                 ^^^^  FIXME[Generalize] */</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                                   (res_kind == diag ||</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                                    res_kind == diag_backpermuted) ? n :</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                                   (res_kind == range ? 2 : 1)));</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <span class="keywordtype">double</span> *v = REAL(ans);</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment">/*  ^^^^^^      ^^^^  FIXME[Generalize] */</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    i_from = (is_U ? -1 : 0);</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="preprocessor">#define for_DIAG(v_ASSIGN)                                      \</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="preprocessor">    for(i = 0; i &lt; n; i++) {                                    \</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="preprocessor">        </span><span class="comment">/* looking at i-th column */</span><span class="preprocessor">                            \</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="preprocessor">        n_x = x_p[i+1] - x_p[i];</span><span class="comment">/* #{entries} in this column */</span><span class="preprocessor"> \</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="preprocessor">        if( is_U) i_from += n_x;                                \</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="preprocessor">        v_ASSIGN;                                               \</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="preprocessor">        if(!is_U) i_from += n_x;                                \</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="preprocessor">    }</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    <span class="comment">/* NOTA BENE: we assume  -- uplo = &quot;L&quot; i.e. lower triangular matrix</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment">     *            for uplo = &quot;U&quot; (makes sense with a &quot;dtCMatrix&quot; !),</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="comment">     *            should use  x_x[i_from + (n_x - 1)] instead of x_x[i_from],</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="comment">     *            where n_x = (x_p[i+1] - x_p[i])</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="keywordflow">switch</span>(res_kind) {</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <span class="keywordflow">case</span> trace: <span class="comment">// = sum</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        v[0] = 0.;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        for_DIAG(v[0] += x_x[i_from]);</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    <span class="keywordflow">case</span> sum_log:</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        v[0] = 0.;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        for_DIAG(v[0] += log(x_x[i_from]));</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <span class="keywordflow">case</span> prod:</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        v[0] = 1.;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        for_DIAG(v[0] *= x_x[i_from]);</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    <span class="keywordflow">case</span> min:</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        v[0] = R_PosInf;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        for_DIAG(<span class="keywordflow">if</span>(v[0] &gt; x_x[i_from]) v[0] = x_x[i_from]);</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="keywordflow">case</span> max:</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        v[0] = R_NegInf;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        for_DIAG(<span class="keywordflow">if</span>(v[0] &lt; x_x[i_from]) v[0] = x_x[i_from]);</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keywordflow">case</span> range:</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        v[0] = R_PosInf;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        v[1] = R_NegInf;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        for_DIAG(<span class="keywordflow">if</span>(v[0] &gt; x_x[i_from]) v[0] = x_x[i_from];</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;                 <span class="keywordflow">if</span>(v[1] &lt; x_x[i_from]) v[1] = x_x[i_from]);</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="keywordflow">case</span> diag:</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        for_DIAG(v[i] = x_x[i_from]);</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="keywordflow">case</span> diag_backpermuted:</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        for_DIAG(v[i] = x_x[i_from]);</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;        warning(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;%s = &#39;%s&#39; (back-permuted) is experimental&quot;</span>),</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;                <span class="stringliteral">&quot;resultKind&quot;</span>, <span class="stringliteral">&quot;diagBack&quot;</span>);</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;        <span class="comment">/* now back_permute : */</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;        <span class="keywordflow">for</span>(i = 0; i &lt; n; i++) {</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;            <span class="keywordtype">double</span> tmp = v[i]; v[i] = v[perm[i]]; v[perm[i]] = tmp;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            <span class="comment">/*^^^^ FIXME[Generalize] */</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        }</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="keywordflow">default</span>: <span class="comment">/* -1 from above */</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;diag_tC(): invalid &#39;resultKind&#39;&quot;</span>));</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        <span class="comment">/* Wall: */</span> ans = R_NilValue; v = REAL(ans);</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    }</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    UNPROTECT(1);</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;}</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;SEXP <a class="code" href="Csparse_8h.html#a14b617572ab48a35576b517b83e4657a">diag_tC</a>(SEXP obj, SEXP resultKind)</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;{</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    SEXP</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        pslot = GET_SLOT(obj, <a class="code" href="Syms_8h.html#af08cd6c75b2da4b71c2eb605e00e94ab">Matrix_pSym</a>),</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        xslot = GET_SLOT(obj, <a class="code" href="Syms_8h.html#a8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>);</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    Rboolean is_U = (R_has_slot(obj, <a class="code" href="Syms_8h.html#ac4fa9962123be6abbeaf9c7219b62644">Matrix_uploSym</a>) &amp;&amp;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                     *CHAR(asChar(GET_SLOT(obj, <a class="code" href="Syms_8h.html#ac4fa9962123be6abbeaf9c7219b62644">Matrix_uploSym</a>))) == <span class="charliteral">&#39;U&#39;</span>);</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <span class="keywordtype">int</span> n = length(pslot) - 1, <span class="comment">/* n = ncol(.) = nrow(.) */</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        *x_p  = INTEGER(pslot), pp = -1, *perm;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <span class="keywordtype">double</span> *x_x = REAL(xslot);</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment">/*  ^^^^^^        ^^^^ FIXME[Generalize] to INTEGER(.) / LOGICAL(.) / ... xslot !*/</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="keywordflow">if</span>(R_has_slot(obj, <a class="code" href="Syms_8h.html#a1e4c56ea9d2e084e0cb7154bcc13e196">Matrix_permSym</a>))</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        perm = INTEGER(GET_SLOT(obj, <a class="code" href="Syms_8h.html#a1e4c56ea9d2e084e0cb7154bcc13e196">Matrix_permSym</a>));</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <span class="keywordflow">else</span> perm = &amp;pp;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="Csparse_8h.html#a70db694dbe8d7c65d6aa8b6ebc124c0f">diag_tC_ptr</a>(n, x_p, x_x, is_U, perm, resultKind);</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;}</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;SEXP <a class="code" href="Csparse_8h.html#a49bea3bf31864cc0553a4af67f7cdc39">create_Csparse</a>(<span class="keywordtype">char</span>* cls, <span class="keywordtype">int</span>* i, <span class="keywordtype">int</span>* j, <span class="keywordtype">int</span>* p, <span class="keywordtype">int</span> np,</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                    <span class="keywordtype">void</span>* x, <span class="keywordtype">int</span> nnz, <span class="keywordtype">int</span>* dims, SEXP dimnames,</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                    <span class="keywordtype">int</span> index1)</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;{</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    SEXP ans;</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="keywordtype">int</span> *ij = (<span class="keywordtype">int</span>*)NULL, *tri, *trj,</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        mi, mj, mp, nrow = -1, ncol = -1;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="chm__common_8c.html#af9e93950e044e8dd6480f0b32dfe3f03">xtype</a> = -1;             <span class="comment">/* -Wall */</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <a class="code" href="chm__common_8h.html#a206da8c29e7321f7aa00a1590b5362ad">CHM_TR</a> T;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    <a class="code" href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a> A;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <span class="keywordflow">if</span> (np &lt; 0 || nnz &lt; 0)</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;negative vector lengths not allowed: np = %d, nnz = %d&quot;</span>),</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;              np, nnz);</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keywordflow">if</span> (1 != ((mi = (i == (<span class="keywordtype">int</span>*)NULL)) +</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;              (mj = (j == (<span class="keywordtype">int</span>*)NULL)) +</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;              (mp = (p == (<span class="keywordtype">int</span>*)NULL))))</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;exactly 1 of &#39;i&#39;, &#39;j&#39; or &#39;p&#39; must be NULL&quot;</span>));</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="keywordflow">if</span> (mp) {</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;        <span class="keywordflow">if</span> (np) error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;np = %d, must be zero when p is NULL&quot;</span>), np);</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;        <span class="keywordflow">if</span> (np) {               <span class="comment">/* Expand p to form i or j */</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;            <span class="keywordflow">if</span> (!(p[0])) error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;p[0] = %d, should be zero&quot;</span>), p[0]);</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0; ii &lt; np; ii++)</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                <span class="keywordflow">if</span> (p[ii] &gt; p[ii + 1])</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                    error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;p must be non-decreasing&quot;</span>));</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;            <span class="keywordflow">if</span> (p[np] != nnz)</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;                error(<span class="stringliteral">&quot;p[np] = %d != nnz = %d&quot;</span>, p[np], nnz);</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;            ij = Calloc(nnz, <span class="keywordtype">int</span>);</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;            <span class="keywordflow">if</span> (mi) {</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;                i = ij;</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                nrow = np;</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                j = ij;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;                ncol = np;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;            }</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;            <span class="comment">/* Expand p to 0-based indices */</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0; ii &lt; np; ii++)</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jj = p[ii]; jj &lt; p[ii + 1]; jj++) ij[jj] = ii;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;            <span class="keywordflow">if</span> (nnz)</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Inconsistent dimensions: np = 0 and nnz = %d&quot;</span>),</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                      nnz);</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        }</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    }</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="comment">/* calculate nrow and ncol */</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keywordflow">if</span> (nrow &lt; 0) {</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0; ii &lt; nnz; ii++) {</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;            <span class="keywordtype">int</span> i1 = i[ii] + (index1 ? 0 : 1); <span class="comment">/* 1-based index */</span></div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;            <span class="keywordflow">if</span> (i1 &lt; 1) error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;invalid row index at position %d&quot;</span>), ii);</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;            <span class="keywordflow">if</span> (i1 &gt; nrow) nrow = i1;</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        }</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    }</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    <span class="keywordflow">if</span> (ncol &lt; 0) {</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jj = 0; jj &lt; nnz; jj++) {</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;            <span class="keywordtype">int</span> j1 = j[jj] + (index1 ? 0 : 1);</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;            <span class="keywordflow">if</span> (j1 &lt; 1) error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;invalid column index at position %d&quot;</span>), jj);</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;            <span class="keywordflow">if</span> (j1 &gt; ncol) ncol = j1;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;        }</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    }</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="keywordflow">if</span> (dims != (<span class="keywordtype">int</span>*)NULL) {</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;        <span class="keywordflow">if</span> (dims[0] &gt; nrow) nrow = dims[0];</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;        <span class="keywordflow">if</span> (dims[1] &gt; ncol) ncol = dims[1];</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    }</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <span class="comment">/* check the class name */</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="keywordflow">if</span> (strlen(cls) != 8)</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;        error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;strlen of cls argument = %d, should be 8&quot;</span>), strlen(cls));</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="keywordflow">if</span> (!strcmp(cls + 2, <span class="stringliteral">&quot;CMatrix&quot;</span>))</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;cls = \&quot;%s\&quot; does not end in \&quot;CMatrix\&quot;&quot;</span>), cls);</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <span class="keywordflow">switch</span>(cls[0]) {</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>:</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;        xtype = CHOLMOD_REAL;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;        xtype = CHOLMOD_PATTERN;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;cls = \&quot;%s\&quot; must begin with &#39;d&#39;, &#39;l&#39; or &#39;n&#39;&quot;</span>), cls);</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    }</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    <span class="keywordflow">if</span> (cls[1] != <span class="charliteral">&#39;g&#39;</span>)</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Only &#39;g&#39;eneral sparse matrix types allowed&quot;</span>));</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    <span class="comment">/* allocate and populate the triplet */</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    T = cholmod_allocate_triplet((<span class="keywordtype">size_t</span>)nrow, (<span class="keywordtype">size_t</span>)ncol, (<span class="keywordtype">size_t</span>)nnz, 0,</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;                                 xtype, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    T-&gt;x = x;</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    tri = (<span class="keywordtype">int</span>*)T-&gt;i;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    trj = (<span class="keywordtype">int</span>*)T-&gt;j;</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0; ii &lt; nnz; ii++) {</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;        tri[ii] = i[ii] - ((!mi &amp;&amp; index1) ? 1 : 0);</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        trj[ii] = j[ii] - ((!mj &amp;&amp; index1) ? 1 : 0);</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    }</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <span class="comment">/* create the cholmod_sparse structure */</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    A = cholmod_triplet_to_sparse(T, nnz, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    cholmod_free_triplet(&amp;T, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    <span class="comment">/* copy the information to the SEXP */</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    ans = PROTECT(NEW_OBJECT(MAKE_CLASS(cls)));</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="comment">// FIXME: This has been copied from chm_sparse_to_SEXP in  chm_common.c</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    <span class="comment">/* allocate and copy common slots */</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    nnz = cholmod_nnz(A, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    dims = INTEGER(<a class="code" href="Mutils_8h.html#af7f59236ca18ab52131cf71f4a7b0786">ALLOC_SLOT</a>(ans, <a class="code" href="Syms_8h.html#a2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>, INTSXP, 2));</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    dims[0] = A-&gt;nrow; dims[1] = A-&gt;ncol;</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    Memcpy(INTEGER(<a class="code" href="Mutils_8h.html#af7f59236ca18ab52131cf71f4a7b0786">ALLOC_SLOT</a>(ans, <a class="code" href="Syms_8h.html#af08cd6c75b2da4b71c2eb605e00e94ab">Matrix_pSym</a>, INTSXP, A-&gt;ncol + 1)), (<span class="keywordtype">int</span>*)A-&gt;p, A-&gt;ncol + 1);</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    Memcpy(INTEGER(<a class="code" href="Mutils_8h.html#af7f59236ca18ab52131cf71f4a7b0786">ALLOC_SLOT</a>(ans, <a class="code" href="Syms_8h.html#a900b6b19a8e80b529c1a26eb9fb6156d">Matrix_iSym</a>, INTSXP, nnz)), (<span class="keywordtype">int</span>*)A-&gt;i, nnz);</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <span class="keywordflow">switch</span>(cls[1]) {</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;        Memcpy(REAL(<a class="code" href="Mutils_8h.html#af7f59236ca18ab52131cf71f4a7b0786">ALLOC_SLOT</a>(ans, <a class="code" href="Syms_8h.html#a8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>, REALSXP, nnz)), (<span class="keywordtype">double</span>*)A-&gt;x, nnz);</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>:</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;        error(<a class="code" href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;code not yet written for cls = \&quot;lgCMatrix\&quot;&quot;</span>));</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    }</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="comment">/* FIXME: dimnames are *NOT* put there yet (if non-NULL) */</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    cholmod_free_sparse(&amp;A, &amp;<a class="code" href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a>);</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    UNPROTECT(1);</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;}</div>
<div class="ttc" id="Syms_8h_html_a2b91d011a529c5665e032a6565275374"><div class="ttname"><a href="Syms_8h.html#a2b91d011a529c5665e032a6565275374">Matrix_DimSym</a></div><div class="ttdeci">SEXP Matrix_DimSym</div><div class="ttdef"><b>Definition:</b> <a href="Syms_8h_source.html#l00002">Syms.h:2</a></div></div>
<div class="ttc" id="Mutils_8h_html_ae692d23e2a86a20fccc024b05fc23df9"><div class="ttname"><a href="Mutils_8h.html#ae692d23e2a86a20fccc024b05fc23df9">class_P</a></div><div class="ttdeci">#define class_P(_x_)</div><div class="ttdef"><b>Definition:</b> <a href="Mutils_8h_source.html#l00178">Mutils.h:178</a></div></div>
<div class="ttc" id="chm__common_8c_html_ad8cdbb3c526b503d3620b16e2cf522ad"><div class="ttname"><a href="chm__common_8c.html#ad8cdbb3c526b503d3620b16e2cf522ad">chm_dense_to_SEXP</a></div><div class="ttdeci">SEXP chm_dense_to_SEXP(CHM_DN a, int dofree, int Rkind, SEXP dn, Rboolean transp)</div><div class="ttdoc">Copy the contents of a to an appropriate denseMatrix object and, optionally, free a or free both a an...</div><div class="ttdef"><b>Definition:</b> <a href="chm__common_8c_source.html#l00835">chm_common.c:835</a></div></div>
<div class="ttc" id="chm__common_8h_html_a3b03d0be10b7de793f1d61046041e73e"><div class="ttname"><a href="chm__common_8h.html#a3b03d0be10b7de793f1d61046041e73e">AS_CHM_SP__</a></div><div class="ttdeci">#define AS_CHM_SP__(x)</div><div class="ttdef"><b>Definition:</b> <a href="chm__common_8h_source.html#l00049">chm_common.h:49</a></div></div>
<div class="ttc" id="Mutils_8h_html_a0513d8a9f2e4f454f1fc3a59c4a6f181"><div class="ttname"><a href="Mutils_8h.html#a0513d8a9f2e4f454f1fc3a59c4a6f181">x_slot_kind</a></div><div class="ttdeci">x_slot_kind</div><div class="ttdef"><b>Definition:</b> <a href="Mutils_8h_source.html#l00184">Mutils.h:184</a></div></div>
<div class="ttc" id="Csparse_8h_html_a1d165b31075f32ee0ca273f51c13f9df"><div class="ttname"><a href="Csparse_8h.html#a1d165b31075f32ee0ca273f51c13f9df">Csparse_drop</a></div><div class="ttdeci">SEXP Csparse_drop(SEXP x, SEXP tol)</div></div>
<div class="ttc" id="chm__common_8h_html_a61450639e8918249f507f3658fadd0d9"><div class="ttname"><a href="chm__common_8h.html#a61450639e8918249f507f3658fadd0d9">CHM_SP</a></div><div class="ttdeci">cholmod_sparse * CHM_SP</div><div class="ttdef"><b>Definition:</b> <a href="chm__common_8h_source.html#l00025">chm_common.h:25</a></div></div>
<div class="ttc" id="Csparse_8h_html_a70db694dbe8d7c65d6aa8b6ebc124c0f"><div class="ttname"><a href="Csparse_8h.html#a70db694dbe8d7c65d6aa8b6ebc124c0f">diag_tC_ptr</a></div><div class="ttdeci">SEXP diag_tC_ptr(int n, int *x_p, double *x_x, Rboolean is_U, int *perm, SEXP resultKind)</div></div>
<div class="ttc" id="Csparse_8c_html_a9e26da2b0832ca4dc2f4cb894705bcdd"><div class="ttname"><a href="Csparse_8c.html#a9e26da2b0832ca4dc2f4cb894705bcdd">Csparse_to_nz_pattern</a></div><div class="ttdeci">SEXP Csparse_to_nz_pattern(SEXP x, SEXP tri)</div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00210">Csparse.c:210</a></div></div>
<div class="ttc" id="Mutils_8h_html_a3afc658317ae5a0e0589862a48b217b5"><div class="ttname"><a href="Mutils_8h.html#a3afc658317ae5a0e0589862a48b217b5">mMatrix_as_dgeMatrix2</a></div><div class="ttdeci">static R_INLINE SEXP mMatrix_as_dgeMatrix2(SEXP A, Rboolean tr_if_vec)</div><div class="ttdef"><b>Definition:</b> <a href="Mutils_8h_source.html#l00338">Mutils.h:338</a></div></div>
<div class="ttc" id="Mutils_8h_html_a3898542d8edc8f61f187ac11267d42b2"><div class="ttname"><a href="Mutils_8h.html#a3898542d8edc8f61f187ac11267d42b2">MATRIX_VALID_tri_Csparse</a></div><div class="ttdeci">#define MATRIX_VALID_tri_Csparse</div><div class="ttdef"><b>Definition:</b> <a href="Mutils_8h_source.html#l00402">Mutils.h:402</a></div></div>
<div class="ttc" id="Syms_8h_html_a8e6ccf1b89de0c7d61722fd1579eb085"><div class="ttname"><a href="Syms_8h.html#a8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a></div><div class="ttdeci">SEXP Matrix_xSym</div><div class="ttdef"><b>Definition:</b> <a href="Syms_8h_source.html#l00002">Syms.h:2</a></div></div>
<div class="ttc" id="Mutils_8h_html_a36a9a730e1a12cbe017064fe140aefd2"><div class="ttname"><a href="Mutils_8h.html#a36a9a730e1a12cbe017064fe140aefd2">slot_dup</a></div><div class="ttdeci">#define slot_dup(dest, src, sym)</div><div class="ttdef"><b>Definition:</b> <a href="Mutils_8h_source.html#l00149">Mutils.h:149</a></div></div>
<div class="ttc" id="Tsparse_8h_html"><div class="ttname"><a href="Tsparse_8h.html">Tsparse.h</a></div></div>
<div class="ttc" id="Syms_8h_html_a93d8b8a3cd9c897599b3e2d996821a0b"><div class="ttname"><a href="Syms_8h.html#a93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a></div><div class="ttdeci">SEXP Matrix_DimNamesSym</div><div class="ttdef"><b>Definition:</b> <a href="Syms_8h_source.html#l00002">Syms.h:2</a></div></div>
<div class="ttc" id="chm__common_8h_html_a206da8c29e7321f7aa00a1590b5362ad"><div class="ttname"><a href="chm__common_8h.html#a206da8c29e7321f7aa00a1590b5362ad">CHM_TR</a></div><div class="ttdeci">cholmod_triplet * CHM_TR</div><div class="ttdef"><b>Definition:</b> <a href="chm__common_8h_source.html#l00027">chm_common.h:27</a></div></div>
<div class="ttc" id="Csparse_8c_html_ad902ff7d08b94c85a1ffb1b4c2c4e247"><div class="ttname"><a href="Csparse_8c.html#ad902ff7d08b94c85a1ffb1b4c2c4e247">Csparse2nz</a></div><div class="ttdeci">SEXP Csparse2nz(SEXP x, Rboolean tri)</div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00198">Csparse.c:198</a></div></div>
<div class="ttc" id="chm__common_8c_html_a7aa1a6e564c24a55b031b5c03b3313f4"><div class="ttname"><a href="chm__common_8c.html#a7aa1a6e564c24a55b031b5c03b3313f4">chm_sparse_to_SEXP</a></div><div class="ttdeci">SEXP chm_sparse_to_SEXP(CHM_SP a, int dofree, int uploT, int Rkind, const char *diag, SEXP dn)</div><div class="ttdoc">Copy the contents of a to an appropriate CsparseMatrix object and, optionally, free a or free both a ...</div><div class="ttdef"><b>Definition:</b> <a href="chm__common_8c_source.html#l00335">chm_common.c:335</a></div></div>
<div class="ttc" id="Csparse_8c_html_a77f654c86c318184ef29b46dc4929e12"><div class="ttname"><a href="Csparse_8c.html#a77f654c86c318184ef29b46dc4929e12">Csparse_validate</a></div><div class="ttdeci">SEXP Csparse_validate(SEXP x)</div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00039">Csparse.c:39</a></div></div>
<div class="ttc" id="chm__common_8c_html_ac49bea018a4b4cb10cd713589039cdda"><div class="ttname"><a href="chm__common_8c.html#ac49bea018a4b4cb10cd713589039cdda">cl</a></div><div class="ttdeci">cholmod_common cl</div><div class="ttdef"><b>Definition:</b> <a href="chm__common_8c_source.html#l00016">chm_common.c:16</a></div></div>
<div class="ttc" id="Csparse_8c_html_a86239e094c5ee16dfc9892f09e8077d9"><div class="ttname"><a href="Csparse_8c.html#a86239e094c5ee16dfc9892f09e8077d9">Csparse_Csparse_crossprod</a></div><div class="ttdeci">SEXP Csparse_Csparse_crossprod(SEXP a, SEXP b, SEXP trans, SEXP bool_arith)</div><div class="ttdoc">[t]crossprod (<Csparse>, <Csparse>) </div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00520">Csparse.c:520</a></div></div>
<div class="ttc" id="Syms_8h_html_ac4fa9962123be6abbeaf9c7219b62644"><div class="ttname"><a href="Syms_8h.html#ac4fa9962123be6abbeaf9c7219b62644">Matrix_uploSym</a></div><div class="ttdeci">SEXP Matrix_uploSym</div><div class="ttdef"><b>Definition:</b> <a href="Syms_8h_source.html#l00002">Syms.h:2</a></div></div>
<div class="ttc" id="Csparse_8c_html_a12b0c242957f1fad9137e767f882e6b8"><div class="ttname"><a href="Csparse_8c.html#a12b0c242957f1fad9137e767f882e6b8">Csparse_to_Tsparse</a></div><div class="ttdeci">SEXP Csparse_to_Tsparse(SEXP x, SEXP tri)</div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00305">Csparse.c:305</a></div></div>
<div class="ttc" id="Csparse_8h_html_ac666003ee4dca32e779db1e7b12dc83b"><div class="ttname"><a href="Csparse_8h.html#ac666003ee4dca32e779db1e7b12dc83b">Csp_dense_products</a></div><div class="ttdeci">SEXP Csp_dense_products(SEXP a, SEXP b, Rboolean transp_a, Rboolean transp_b, Rboolean transp_ans)</div></div>
<div class="ttc" id="Csparse_8h_html_abfee8cfe834c57a1bb2144ee157b83dc"><div class="ttname"><a href="Csparse_8h.html#abfee8cfe834c57a1bb2144ee157b83dc">Csparse_submatrix</a></div><div class="ttdeci">SEXP Csparse_submatrix(SEXP x, SEXP i, SEXP j)</div></div>
<div class="ttc" id="Csparse_8h_html_aa2237e82e0b9e68dda7fed39523de6cd"><div class="ttname"><a href="Csparse_8h.html#aa2237e82e0b9e68dda7fed39523de6cd">Csparse_crossprod</a></div><div class="ttdeci">SEXP Csparse_crossprod(SEXP x, SEXP trans, SEXP triplet, SEXP bool_arith)</div></div>
<div class="ttc" id="Mutils_8h_html_a0513d8a9f2e4f454f1fc3a59c4a6f181ab3a3051968f4171a6f035164412f68a5"><div class="ttname"><a href="Mutils_8h.html#a0513d8a9f2e4f454f1fc3a59c4a6f181ab3a3051968f4171a6f035164412f68a5">x_logical</a></div><div class="ttdef"><b>Definition:</b> <a href="Mutils_8h_source.html#l00184">Mutils.h:184</a></div></div>
<div class="ttc" id="Csparse_8c_html_a3ba5e051166f06c94c102d3e1e350a70"><div class="ttname"><a href="Csparse_8c.html#a3ba5e051166f06c94c102d3e1e350a70">Csparse_to_matrix</a></div><div class="ttdeci">SEXP Csparse_to_matrix(SEXP x, SEXP chk, SEXP symm)</div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00284">Csparse.c:284</a></div></div>
<div class="ttc" id="Csparse_8h_html_a0ff90b74963cd2db63b8cc7542d5aa96"><div class="ttname"><a href="Csparse_8h.html#a0ff90b74963cd2db63b8cc7542d5aa96">Csparse_MatrixMarket</a></div><div class="ttdeci">SEXP Csparse_MatrixMarket(SEXP x, SEXP fname)</div></div>
<div class="ttc" id="chm__common_8h_html_a609d3f02935d257aa6d23b49ea811dd4"><div class="ttname"><a href="chm__common_8h.html#a609d3f02935d257aa6d23b49ea811dd4">AS_CHM_TR__</a></div><div class="ttdeci">#define AS_CHM_TR__(x)</div><div class="ttdef"><b>Definition:</b> <a href="chm__common_8h_source.html#l00050">chm_common.h:50</a></div></div>
<div class="ttc" id="Csparse_8c_html_a4445bf9e1d6a9ee608151123b9d3aa9f"><div class="ttname"><a href="Csparse_8c.html#a4445bf9e1d6a9ee608151123b9d3aa9f">nz2Csparse</a></div><div class="ttdeci">SEXP nz2Csparse(SEXP x, enum x_slot_kind r_kind)</div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00228">Csparse.c:228</a></div></div>
<div class="ttc" id="Mutils_8c_html_ae0e07b5d446943159295e745388285e2"><div class="ttname"><a href="Mutils_8c.html#ae0e07b5d446943159295e745388285e2">equal_string_vectors</a></div><div class="ttdeci">Rboolean equal_string_vectors(SEXP s1, SEXP s2)</div><div class="ttdef"><b>Definition:</b> <a href="Mutils_8c_source.html#l00286">Mutils.c:286</a></div></div>
<div class="ttc" id="Csparse_8c_html_a27fdeb89a1330c785f477e967c078eca"><div class="ttname"><a href="Csparse_8c.html#a27fdeb89a1330c785f477e967c078eca">Csparse_to_vector</a></div><div class="ttdeci">SEXP Csparse_to_vector(SEXP x)</div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00300">Csparse.c:300</a></div></div>
<div class="ttc" id="t__Csparse__validate_8c_html"><div class="ttname"><a href="t__Csparse__validate_8c.html">t_Csparse_validate.c</a></div></div>
<div class="ttc" id="Csparse_8h_html_a10392132372fdfc01e1aff7622f5ee7f"><div class="ttname"><a href="Csparse_8h.html#a10392132372fdfc01e1aff7622f5ee7f">Csparse_validate_</a></div><div class="ttdeci">SEXP Csparse_validate_(SEXP x, Rboolean maybe_modify)</div></div>
<div class="ttc" id="Syms_8h_html_a92da52e94414e4e2c04f11a6dce844d7"><div class="ttname"><a href="Syms_8h.html#a92da52e94414e4e2c04f11a6dce844d7">Matrix_jSym</a></div><div class="ttdeci">SEXP Matrix_jSym</div><div class="ttdef"><b>Definition:</b> <a href="Syms_8h_source.html#l00002">Syms.h:2</a></div></div>
<div class="ttc" id="Csparse_8c_html_a9e54e758f6585b91c2cbb20f47bfad2f"><div class="ttname"><a href="Csparse_8c.html#a9e54e758f6585b91c2cbb20f47bfad2f">Csparse_sort</a></div><div class="ttdeci">SEXP Csparse_sort(SEXP x)</div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00056">Csparse.c:56</a></div></div>
<div class="ttc" id="chm__common_8c_html_af9e93950e044e8dd6480f0b32dfe3f03"><div class="ttname"><a href="chm__common_8c.html#af9e93950e044e8dd6480f0b32dfe3f03">xtype</a></div><div class="ttdeci">static int xtype(int ctype)</div><div class="ttdoc">xtype: the kind of numeric (think "x slot") of Cholmod sparse matrices. </div><div class="ttdef"><b>Definition:</b> <a href="chm__common_8c_source.html#l00126">chm_common.c:126</a></div></div>
<div class="ttc" id="Csparse_8h_html_a8973a306b51dbd6b2b66b21185bf048a"><div class="ttname"><a href="Csparse_8h.html#a8973a306b51dbd6b2b66b21185bf048a">Csparse_horzcat</a></div><div class="ttdeci">SEXP Csparse_horzcat(SEXP x, SEXP y)</div></div>
<div class="ttc" id="Csparse_8c_html_a1fe70f89e424351c54c9bf4ba618ae65"><div class="ttname"><a href="Csparse_8c.html#a1fe70f89e424351c54c9bf4ba618ae65">Csparse_symmetric_to_general</a></div><div class="ttdeci">SEXP Csparse_symmetric_to_general(SEXP x)</div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00343">Csparse.c:343</a></div></div>
<div class="ttc" id="chm__common_8c_html_ad32e8dacf9f0444fedde957bb38e02ef"><div class="ttname"><a href="chm__common_8c.html#ad32e8dacf9f0444fedde957bb38e02ef">chm_dense_to_vector</a></div><div class="ttdeci">SEXP chm_dense_to_vector(CHM_DN a, int dofree)</div><div class="ttdoc">Copy the contents of a to a numeric R object and, optionally, free a or free both a and its pointer t...</div><div class="ttdef"><b>Definition:</b> <a href="chm__common_8c_source.html#l00996">chm_common.c:996</a></div></div>
<div class="ttc" id="Csparse_8c_html_adf30d8deabe5bb928402465150189d79"><div class="ttname"><a href="Csparse_8c.html#adf30d8deabe5bb928402465150189d79">Csparse_general_to_symmetric</a></div><div class="ttdeci">SEXP Csparse_general_to_symmetric(SEXP x, SEXP uplo, SEXP sym_dmns)</div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00357">Csparse.c:357</a></div></div>
<div class="ttc" id="Csparse_8h_html_a546eddc63011f2f2af462894dbec7dc9"><div class="ttname"><a href="Csparse_8h.html#a546eddc63011f2f2af462894dbec7dc9">Csparse_band</a></div><div class="ttdeci">SEXP Csparse_band(SEXP x, SEXP k1, SEXP k2)</div></div>
<div class="ttc" id="t__Csparse__subassign_8c_html"><div class="ttname"><a href="t__Csparse__subassign_8c.html">t_Csparse_subassign.c</a></div></div>
<div class="ttc" id="Mutils_8h_html_ad0ba53374133b404c7ff06812f438991"><div class="ttname"><a href="Mutils_8h.html#ad0ba53374133b404c7ff06812f438991">MATRIX_VALID_ddense</a></div><div class="ttdeci">#define MATRIX_VALID_ddense</div><div class="ttdef"><b>Definition:</b> <a href="Mutils_8h_source.html#l00360">Mutils.h:360</a></div></div>
<div class="ttc" id="Syms_8h_html_a1e4c56ea9d2e084e0cb7154bcc13e196"><div class="ttname"><a href="Syms_8h.html#a1e4c56ea9d2e084e0cb7154bcc13e196">Matrix_permSym</a></div><div class="ttdeci">SEXP Matrix_permSym</div><div class="ttdef"><b>Definition:</b> <a href="Syms_8h_source.html#l00002">Syms.h:2</a></div></div>
<div class="ttc" id="Mutils_8h_html_a3a43f83d21f80a9d484da9f2731f76d2"><div class="ttname"><a href="Mutils_8h.html#a3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a></div><div class="ttdeci">#define uplo_P(_x_)</div><div class="ttdef"><b>Definition:</b> <a href="Mutils_8h_source.html#l00174">Mutils.h:174</a></div></div>
<div class="ttc" id="Csparse_8c_html_a78b6af142e571556b5b698785211d1d9"><div class="ttname"><a href="Csparse_8c.html#a78b6af142e571556b5b698785211d1d9">Csparse_Csparse_prod</a></div><div class="ttdeci">SEXP Csparse_Csparse_prod(SEXP a, SEXP b, SEXP bool_arith)</div><div class="ttdoc">A %*% B - for matrices of class CsparseMatrix (R package "Matrix") </div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00446">Csparse.c:446</a></div></div>
<div class="ttc" id="Mutils_8h_html_a32a3cf3d9dd914f5aeeca5423c157934"><div class="ttname"><a href="Mutils_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a></div><div class="ttdeci">#define _(String)</div><div class="ttdef"><b>Definition:</b> <a href="Mutils_8h_source.html#l00032">Mutils.h:32</a></div></div>
<div class="ttc" id="chm__common_8h_html_abaf1012d71b21d1b412add9042b5ac2b"><div class="ttname"><a href="chm__common_8h.html#abaf1012d71b21d1b412add9042b5ac2b">CHM_DN</a></div><div class="ttdeci">cholmod_dense * CHM_DN</div><div class="ttdef"><b>Definition:</b> <a href="chm__common_8h_source.html#l00021">chm_common.h:21</a></div></div>
<div class="ttc" id="Syms_8h_html_a900b6b19a8e80b529c1a26eb9fb6156d"><div class="ttname"><a href="Syms_8h.html#a900b6b19a8e80b529c1a26eb9fb6156d">Matrix_iSym</a></div><div class="ttdeci">SEXP Matrix_iSym</div><div class="ttdef"><b>Definition:</b> <a href="Syms_8h_source.html#l00002">Syms.h:2</a></div></div>
<div class="ttc" id="Mutils_8h_html_a0513d8a9f2e4f454f1fc3a59c4a6f181aae6c99602d8ebd0046fe45aab166d0f0"><div class="ttname"><a href="Mutils_8h.html#a0513d8a9f2e4f454f1fc3a59c4a6f181aae6c99602d8ebd0046fe45aab166d0f0">x_integer</a></div><div class="ttdef"><b>Definition:</b> <a href="Mutils_8h_source.html#l00184">Mutils.h:184</a></div></div>
<div class="ttc" id="chm__common_8c_html_aa63a154e775eded261bf72b8a219de11"><div class="ttname"><a href="chm__common_8c.html#aa63a154e775eded261bf72b8a219de11">chm_dense_to_matrix</a></div><div class="ttdeci">SEXP chm_dense_to_matrix(CHM_DN a, int dofree, SEXP dn)</div><div class="ttdoc">Copy the contents of a to a matrix object and, optionally, free a or free both a and its pointer to i...</div><div class="ttdef"><b>Definition:</b> <a href="chm__common_8c_source.html#l00942">chm_common.c:942</a></div></div>
<div class="ttc" id="Csparse_8c_html_a48d40e2cc334ad0df5e96008dea6eacf"><div class="ttname"><a href="Csparse_8c.html#a48d40e2cc334ad0df5e96008dea6eacf">Csparse_to_tTsparse</a></div><div class="ttdeci">SEXP Csparse_to_tTsparse(SEXP x, SEXP uplo, SEXP diag)</div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00330">Csparse.c:330</a></div></div>
<div class="ttc" id="Csparse_8h_html_a49bea3bf31864cc0553a4af67f7cdc39"><div class="ttname"><a href="Csparse_8h.html#a49bea3bf31864cc0553a4af67f7cdc39">create_Csparse</a></div><div class="ttdeci">SEXP create_Csparse(char *cls, int *i, int *j, int *p, int np, void *x, int nnz, int *dims, SEXP dimnames, int index1)</div></div>
<div class="ttc" id="chm__common_8h_html_aaa0424486b25ff64e947e1946f1c1b2c"><div class="ttname"><a href="chm__common_8h.html#aaa0424486b25ff64e947e1946f1c1b2c">AS_CHM_DN</a></div><div class="ttdeci">#define AS_CHM_DN(x)</div><div class="ttdef"><b>Definition:</b> <a href="chm__common_8h_source.html#l00043">chm_common.h:43</a></div></div>
<div class="ttc" id="chm__common_8h_html"><div class="ttname"><a href="chm__common_8h.html">chm_common.h</a></div></div>
<div class="ttc" id="Mutils_8h_html_ab4ad1f68b41558c70a65c2255cfa49d8"><div class="ttname"><a href="Mutils_8h.html#ab4ad1f68b41558c70a65c2255cfa49d8">slot_dup_if_has</a></div><div class="ttdeci">#define slot_dup_if_has(dest, src, sym)</div><div class="ttdef"><b>Definition:</b> <a href="Mutils_8h_source.html#l00156">Mutils.h:156</a></div></div>
<div class="ttc" id="Mutils_8h_html_a1e1f224c5e72ee3eb2583024db2c59e6"><div class="ttname"><a href="Mutils_8h.html#a1e1f224c5e72ee3eb2583024db2c59e6">diag_P</a></div><div class="ttdeci">#define diag_P(_x_)</div><div class="ttdef"><b>Definition:</b> <a href="Mutils_8h_source.html#l00175">Mutils.h:175</a></div></div>
<div class="ttc" id="Csparse_8h_html_a14b617572ab48a35576b517b83e4657a"><div class="ttname"><a href="Csparse_8h.html#a14b617572ab48a35576b517b83e4657a">diag_tC</a></div><div class="ttdeci">SEXP diag_tC(SEXP obj, SEXP resultKind)</div></div>
<div class="ttc" id="Mutils_8h_html_ad0ec8e93e7bf996d7d4f241f4820c15b"><div class="ttname"><a href="Mutils_8h.html#ad0ec8e93e7bf996d7d4f241f4820c15b">Real_kind</a></div><div class="ttdeci">#define Real_kind(_x_)</div><div class="ttdef"><b>Definition:</b> <a href="Mutils_8h_source.html#l00195">Mutils.h:195</a></div></div>
<div class="ttc" id="Syms_8h_html_af08cd6c75b2da4b71c2eb605e00e94ab"><div class="ttname"><a href="Syms_8h.html#af08cd6c75b2da4b71c2eb605e00e94ab">Matrix_pSym</a></div><div class="ttdeci">SEXP Matrix_pSym</div><div class="ttdef"><b>Definition:</b> <a href="Syms_8h_source.html#l00002">Syms.h:2</a></div></div>
<div class="ttc" id="Csparse_8c_html_a5b2f297662f7f5dd66097ed12b320468"><div class="ttname"><a href="Csparse_8c.html#a5b2f297662f7f5dd66097ed12b320468">Csparse_validate2</a></div><div class="ttdeci">SEXP Csparse_validate2(SEXP x, SEXP maybe_modify)</div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00051">Csparse.c:51</a></div></div>
<div class="ttc" id="chm__common_8h_html_aea5df11ddd9250493b0d937a2098657e"><div class="ttname"><a href="chm__common_8h.html#aea5df11ddd9250493b0d937a2098657e">AS_CHM_SP2</a></div><div class="ttdeci">#define AS_CHM_SP2(x, chk)</div><div class="ttdef"><b>Definition:</b> <a href="chm__common_8h_source.html#l00052">chm_common.h:52</a></div></div>
<div class="ttc" id="Csparse_8h_html_a316d9d78254bf71714b3e44ac4ec6b01"><div class="ttname"><a href="Csparse_8h.html#a316d9d78254bf71714b3e44ac4ec6b01">Csparse_diagN2U</a></div><div class="ttdeci">SEXP Csparse_diagN2U(SEXP x)</div></div>
<div class="ttc" id="Mutils_8c_html_a316a7184387d598d6ab9d48c4a9a2da8"><div class="ttname"><a href="Mutils_8c.html#a316a7184387d598d6ab9d48c4a9a2da8">symmetric_DimNames</a></div><div class="ttdeci">SEXP symmetric_DimNames(SEXP dn)</div><div class="ttdoc">Produce symmetric &#39;Dimnames&#39; from possibly asymmetric ones. </div><div class="ttdef"><b>Definition:</b> <a href="Mutils_8c_source.html#l01269">Mutils.c:1269</a></div></div>
<div class="ttc" id="Tsparse_8c_html_a1b1ca7081cfcbef11f1cafc4270412ed"><div class="ttname"><a href="Tsparse_8c.html#a1b1ca7081cfcbef11f1cafc4270412ed">Tsparse_diagU2N</a></div><div class="ttdeci">SEXP Tsparse_diagU2N(SEXP x)</div><div class="ttdef"><b>Definition:</b> <a href="Tsparse_8c_source.html#l00063">Tsparse.c:63</a></div></div>
<div class="ttc" id="Csparse_8c_html_aab695b6af65c32eac1776cf04c661518"><div class="ttname"><a href="Csparse_8c.html#aab695b6af65c32eac1776cf04c661518">Csparse_transpose</a></div><div class="ttdeci">SEXP Csparse_transpose(SEXP x, SEXP tri)</div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00402">Csparse.c:402</a></div></div>
<div class="ttc" id="Syms_8h_html_aaaa2d2105381747118da72d6f1aba4e9"><div class="ttname"><a href="Syms_8h.html#aaaa2d2105381747118da72d6f1aba4e9">Matrix_diagSym</a></div><div class="ttdeci">SEXP Matrix_diagSym</div><div class="ttdef"><b>Definition:</b> <a href="Syms_8h_source.html#l00002">Syms.h:2</a></div></div>
<div class="ttc" id="chm__common_8c_html_a713dd9a3d6095f9b55e453d18ca87d5a"><div class="ttname"><a href="chm__common_8c.html#a713dd9a3d6095f9b55e453d18ca87d5a">chm_diagN2U</a></div><div class="ttdeci">void chm_diagN2U(CHM_SP chx, int uploT, Rboolean do_realloc)</div><div class="ttdoc">Drop the (unit) diagonal entries from a cholmod_sparse matrix. </div><div class="ttdef"><b>Definition:</b> <a href="chm__common_8c_source.html#l01191">chm_common.c:1191</a></div></div>
<div class="ttc" id="Mutils_8h_html_a116acdc205f6439ffbc8d160d1c64ff2"><div class="ttname"><a href="Mutils_8h.html#a116acdc205f6439ffbc8d160d1c64ff2">MATRIX_VALID_nCsparse</a></div><div class="ttdeci">#define MATRIX_VALID_nCsparse</div><div class="ttdef"><b>Definition:</b> <a href="Mutils_8h_source.html#l00381">Mutils.h:381</a></div></div>
<div class="ttc" id="Csparse_8c_html_a9a393d510bc108d7f4e5807d952fc089"><div class="ttname"><a href="Csparse_8c.html#a9a393d510bc108d7f4e5807d952fc089">nz_pattern_to_Csparse</a></div><div class="ttdeci">SEXP nz_pattern_to_Csparse(SEXP x, SEXP res_kind)</div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00221">Csparse.c:221</a></div></div>
<div class="ttc" id="Csparse_8h_html_a0cc8d2f7047736ee111b11cb2faeaf11"><div class="ttname"><a href="Csparse_8h.html#a0cc8d2f7047736ee111b11cb2faeaf11">Csparse_diagU2N</a></div><div class="ttdeci">SEXP Csparse_diagU2N(SEXP x)</div></div>
<div class="ttc" id="Csparse_8c_html_af4beac0a5fdb698d99feaf1fb8da7b03"><div class="ttname"><a href="Csparse_8c.html#af4beac0a5fdb698d99feaf1fb8da7b03">Csparse_to_dense</a></div><div class="ttdeci">SEXP Csparse_to_dense(SEXP x, SEXP symm_or_tri)</div><div class="ttdoc">From a CsparseMatrix, produce a dense one. </div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00121">Csparse.c:121</a></div></div>
<div class="ttc" id="Csparse_8c_html_a213393a1709973c1b2b733c7019d3086"><div class="ttname"><a href="Csparse_8c.html#a213393a1709973c1b2b733c7019d3086">Csparse_to_tCsparse</a></div><div class="ttdeci">SEXP Csparse_to_tCsparse(SEXP x, SEXP uplo, SEXP diag)</div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00319">Csparse.c:319</a></div></div>
<div class="ttc" id="chm__common_8c_html_ac2b5dcf1f18e620b15b2e284dd9f6bd4"><div class="ttname"><a href="chm__common_8c.html#ac2b5dcf1f18e620b15b2e284dd9f6bd4">c</a></div><div class="ttdeci">cholmod_common c</div><div class="ttdef"><b>Definition:</b> <a href="chm__common_8c_source.html#l00015">chm_common.c:15</a></div></div>
<div class="ttc" id="Csparse_8h_html"><div class="ttname"><a href="Csparse_8h.html">Csparse.h</a></div></div>
<div class="ttc" id="Mutils_8h_html_a0513d8a9f2e4f454f1fc3a59c4a6f181a2a95e471311414715f5477d7a4f11564"><div class="ttname"><a href="Mutils_8h.html#a0513d8a9f2e4f454f1fc3a59c4a6f181a2a95e471311414715f5477d7a4f11564">x_double</a></div><div class="ttdef"><b>Definition:</b> <a href="Mutils_8h_source.html#l00184">Mutils.h:184</a></div></div>
<div class="ttc" id="Csparse_8c_html_ad988031b3c1f79de0d13da2bf40cc4c1"><div class="ttname"><a href="Csparse_8c.html#ad988031b3c1f79de0d13da2bf40cc4c1">isValid_Csparse</a></div><div class="ttdeci">Rboolean isValid_Csparse(SEXP x)</div><div class="ttdoc">"Cheap" C version of Csparse_validate() - not sorting : </div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00011">Csparse.c:11</a></div></div>
<div class="ttc" id="Mutils_8h_html_a26137187495aa7abb0f0b0d38ee1e641"><div class="ttname"><a href="Mutils_8h.html#a26137187495aa7abb0f0b0d38ee1e641">MATRIX_VALID_Csparse</a></div><div class="ttdeci">#define MATRIX_VALID_Csparse</div><div class="ttdef"><b>Definition:</b> <a href="Mutils_8h_source.html#l00384">Mutils.h:384</a></div></div>
<div class="ttc" id="Csparse_8c_html_ac732feb976a4c849b0542e99f22d92de"><div class="ttname"><a href="Csparse_8c.html#ac732feb976a4c849b0542e99f22d92de">Rsparse_validate</a></div><div class="ttdeci">SEXP Rsparse_validate(SEXP x)</div><div class="ttdef"><b>Definition:</b> <a href="Csparse_8c_source.html#l00062">Csparse.c:62</a></div></div>
<div class="ttc" id="Csparse_8h_html_a913d061ccf8536244aae6b7157c105f1"><div class="ttname"><a href="Csparse_8h.html#a913d061ccf8536244aae6b7157c105f1">Csparse_vertcat</a></div><div class="ttdeci">SEXP Csparse_vertcat(SEXP x, SEXP y)</div></div>
<div class="ttc" id="Csparse_8h_html_aeb0fcf19e652c4dca8e4b75f6e0942a6"><div class="ttname"><a href="Csparse_8h.html#aeb0fcf19e652c4dca8e4b75f6e0942a6">Csparse_dense_prod</a></div><div class="ttdeci">SEXP Csparse_dense_prod(SEXP a, SEXP b, SEXP transp)</div></div>
<div class="ttc" id="cs__utils_8c_html_a0b2592041f5b822459b7052a451c07a5"><div class="ttname"><a href="cs__utils_8c.html#a0b2592041f5b822459b7052a451c07a5">is_sym</a></div><div class="ttdeci">static int is_sym(cs *A)</div><div class="ttdef"><b>Definition:</b> <a href="cs__utils_8c_source.html#l00005">cs_utils.c:5</a></div></div>
<div class="ttc" id="chm__common_8c_html_ab5d31c23691cc4a3c96a7f526dc84006"><div class="ttname"><a href="chm__common_8c.html#ab5d31c23691cc4a3c96a7f526dc84006">chm_triplet_to_SEXP</a></div><div class="ttdeci">SEXP chm_triplet_to_SEXP(CHM_TR a, int dofree, int uploT, int Rkind, const char *diag, SEXP dn)</div><div class="ttdoc">Copy the contents of a to an appropriate TsparseMatrix object and, optionally, free a or free both a ...</div><div class="ttdef"><b>Definition:</b> <a href="chm__common_8c_source.html#l00573">chm_common.c:573</a></div></div>
<div class="ttc" id="Csparse_8h_html_a7c1f024791eaa91a0325914d130892b7"><div class="ttname"><a href="Csparse_8h.html#a7c1f024791eaa91a0325914d130892b7">Csparse_dense_crossprod</a></div><div class="ttdeci">SEXP Csparse_dense_crossprod(SEXP a, SEXP b, SEXP transp)</div></div>
<div class="ttc" id="Mutils_8h_html_af7f59236ca18ab52131cf71f4a7b0786"><div class="ttname"><a href="Mutils_8h.html#af7f59236ca18ab52131cf71f4a7b0786">ALLOC_SLOT</a></div><div class="ttdeci">static R_INLINE SEXP ALLOC_SLOT(SEXP obj, SEXP nm, SEXPTYPE type, int length)</div><div class="ttdoc">Allocate an SEXP of given type and length, assign it as slot nm in the object, and return the SEXP...</div><div class="ttdef"><b>Definition:</b> <a href="Mutils_8h_source.html#l00240">Mutils.h:240</a></div></div>
<div class="ttc" id="chm__common_8h_html_a181c1e5f964ecab945a22c5309500afd"><div class="ttname"><a href="chm__common_8h.html#a181c1e5f964ecab945a22c5309500afd">AS_CHM_SP</a></div><div class="ttdeci">#define AS_CHM_SP(x)</div><div class="ttdef"><b>Definition:</b> <a href="chm__common_8h_source.html#l00046">chm_common.h:46</a></div></div>
<div class="ttc" id="chm__common_8h_html_a0de4ac732ba359948e3b377352f99b97"><div class="ttname"><a href="chm__common_8h.html#a0de4ac732ba359948e3b377352f99b97">AS_CHM_TR</a></div><div class="ttdeci">#define AS_CHM_TR(x)</div><div class="ttdef"><b>Definition:</b> <a href="chm__common_8h_source.html#l00047">chm_common.h:47</a></div></div>
<div class="ttc" id="chm__common_8c_html_aadc2aa8d2f836520f068863dbe700a19"><div class="ttname"><a href="chm__common_8c.html#aadc2aa8d2f836520f068863dbe700a19">chm_transpose_dense</a></div><div class="ttdeci">void chm_transpose_dense(CHM_DN ans, CHM_DN x)</div><div class="ttdoc">Transpose a cholmod_dense matrix ("too trivial to be in CHOLMOD?") </div><div class="ttdef"><b>Definition:</b> <a href="chm__common_8c_source.html#l00754">chm_common.c:754</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="Csparse_8c.html">Csparse.c</a></li>
    <li class="footer">Generated on Thu Apr 14 2016 17:24:04 for Matrix by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
