<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Matrix: cs_utils.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>cs_utils.c</h1><a href="cs__utils_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include "<a class="code" href="cs__utils_8h.html">cs_utils.h</a>"</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">/* Borrowed from one of Tim Davis' examples in the CSparse Demo directory */</span>
<a name="l00004"></a>00004 <span class="comment">/* 1 if A is square &amp; upper tri., -1 if square &amp; lower tri., 0 otherwise */</span>
<a name="l00005"></a><a class="code" href="cs__utils_8c.html#0b2592041f5b822459b7052a451c07a5">00005</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="cs__utils_8c.html#0b2592041f5b822459b7052a451c07a5">is_sym</a> (<a class="code" href="structcs__sparse.html">cs</a> *A)
<a name="l00006"></a>00006 {
<a name="l00007"></a>00007     <span class="keywordtype">int</span> is_upper, is_lower, j, p, n = A-&gt;<a class="code" href="structcs__sparse.html#86c18870dc1551c71f8ea551efe68625">n</a>, m = A-&gt;<a class="code" href="structcs__sparse.html#8aeba3ffed4d599a4906e78329d3448b">m</a>, *Ap = A-&gt;<a class="code" href="structcs__sparse.html#263a2347e8dcf1a7a20ee66730297b85">p</a>, *Ai = A-&gt;<a class="code" href="structcs__sparse.html#eb6831b93f8a901b4a5d520c46990f44">i</a> ;
<a name="l00008"></a>00008     <span class="keywordflow">if</span> (m != n) <span class="keywordflow">return</span> (0) ;
<a name="l00009"></a>00009     is_upper = 1 ;
<a name="l00010"></a>00010     is_lower = 1 ;
<a name="l00011"></a>00011     <span class="keywordflow">for</span> (j = 0 ; j &lt; n ; j++)
<a name="l00012"></a>00012     {
<a name="l00013"></a>00013         <span class="keywordflow">for</span> (p = Ap [j] ; p &lt; Ap [j+1] ; p++)
<a name="l00014"></a>00014         {
<a name="l00015"></a>00015             <span class="keywordflow">if</span> (Ai [p] &gt; j) is_upper = 0 ;
<a name="l00016"></a>00016             <span class="keywordflow">if</span> (Ai [p] &lt; j) is_lower = 0 ;
<a name="l00017"></a>00017         }
<a name="l00018"></a>00018     }
<a name="l00019"></a>00019     <span class="keywordflow">return</span> (is_upper ? 1 : (is_lower ? -1 : 0)) ;
<a name="l00020"></a>00020 }
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 
<a name="l00031"></a><a class="code" href="cs__utils_8c.html#3f4422610da1a3e9e7268e1843ca6de5">00031</a> <span class="keyword">static</span> <a class="code" href="structcs__sparse.html">CSP</a> <a class="code" href="cs__utils_8c.html#3f4422610da1a3e9e7268e1843ca6de5" title="Create an identity matrix of size n as a cs struct.">csp_eye</a>(<span class="keywordtype">int</span> n)
<a name="l00032"></a>00032 {
<a name="l00033"></a>00033     <a class="code" href="structcs__sparse.html">CSP</a> eye = <a class="code" href="cs_8c.html#ad3a584d9185a4fe4497a36f892b9c72">cs_spalloc</a>(n, n, n, 1, 0);
<a name="l00034"></a>00034     <span class="keywordtype">int</span> *ep = eye-&gt;<a class="code" href="structcs__sparse.html#263a2347e8dcf1a7a20ee66730297b85">p</a>, *ei = eye-&gt;<a class="code" href="structcs__sparse.html#eb6831b93f8a901b4a5d520c46990f44">i</a>;
<a name="l00035"></a>00035     <span class="keywordtype">double</span> *ex = eye-&gt;<a class="code" href="structcs__sparse.html#0d6d06e4893a7d4d86e94ce49358d9c1">x</a>;
<a name="l00036"></a>00036 
<a name="l00037"></a>00037     <span class="keywordflow">if</span> (n &lt;= 0) error(<span class="stringliteral">"csp_eye argument n must be positive"</span>);
<a name="l00038"></a>00038     eye-&gt;<a class="code" href="structcs__sparse.html#707363d7869d3fc4126027c1c9c7cf7c">nz</a> = -1;               <span class="comment">/* compressed column storage */</span>
<a name="l00039"></a>00039     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; n; j++) {
<a name="l00040"></a>00040         ep[j] = ei[j] = j;
<a name="l00041"></a>00041         ex[j] = 1;
<a name="l00042"></a>00042     }
<a name="l00043"></a>00043     eye-&gt;<a class="code" href="structcs__sparse.html#ab49fc365ddf6273376a96d3a6aa751f">nzmax</a> = ep[n] = n;
<a name="l00044"></a>00044     <span class="keywordflow">return</span> eye;
<a name="l00045"></a>00045 }
<a name="l00046"></a>00046 
<a name="l00061"></a><a class="code" href="cs__utils_8c.html#e015ca3e4a6c1b3a7265208ab035a1c7">00061</a> <a class="code" href="structcs__sparse.html">cs</a> *<a class="code" href="cs__utils_8c.html#e015ca3e4a6c1b3a7265208ab035a1c7" title="Create a cs object with the contents of x.">Matrix_as_cs</a>(<a class="code" href="structcs__sparse.html">cs</a> *ans, SEXP x, Rboolean check_Udiag)
<a name="l00062"></a>00062 {
<a name="l00063"></a>00063     <span class="keywordtype">char</span> *valid[] = {<span class="stringliteral">"dgCMatrix"</span>, <span class="stringliteral">"dtCMatrix"</span>, <span class="stringliteral">""</span>};
<a name="l00064"></a>00064     <span class="comment">/* had also "dsCMatrix", but that only stores one triangle */</span>
<a name="l00065"></a>00065     <span class="keywordtype">int</span> *dims, ctype = <a class="code" href="Mutils_8h.html#2206f293e563a99c83fa8480b7e26912" title="Return the 0-based index of a string match in a vector of strings terminated by an...">Matrix_check_class</a>(<a class="code" href="Mutils_8h.html#e692d23e2a86a20fccc024b05fc23df9">class_P</a>(x), valid);
<a name="l00066"></a>00066     SEXP islot;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068     <span class="keywordflow">if</span> (ctype &lt; 0) error(<span class="stringliteral">"invalid class of 'x' in Matrix_as_cs(a, x)"</span>);
<a name="l00069"></a>00069                                 <span class="comment">/* dimensions and nzmax */</span>
<a name="l00070"></a>00070     dims = INTEGER(GET_SLOT(x, <a class="code" href="Syms_8h.html#2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>));
<a name="l00071"></a>00071     ans-&gt;<a class="code" href="structcs__sparse.html#8aeba3ffed4d599a4906e78329d3448b">m</a> = dims[0]; ans-&gt;<a class="code" href="structcs__sparse.html#86c18870dc1551c71f8ea551efe68625">n</a> = dims[1];
<a name="l00072"></a>00072     islot = GET_SLOT(x, <a class="code" href="Syms_8h.html#900b6b19a8e80b529c1a26eb9fb6156d">Matrix_iSym</a>);
<a name="l00073"></a>00073     ans-&gt;<a class="code" href="structcs__sparse.html#707363d7869d3fc4126027c1c9c7cf7c">nz</a> = -1;               <span class="comment">/* indicates compressed column storage */</span>
<a name="l00074"></a>00074     ans-&gt;<a class="code" href="structcs__sparse.html#ab49fc365ddf6273376a96d3a6aa751f">nzmax</a> = LENGTH(islot);
<a name="l00075"></a>00075     ans-&gt;<a class="code" href="structcs__sparse.html#eb6831b93f8a901b4a5d520c46990f44">i</a> = INTEGER(islot);
<a name="l00076"></a>00076     ans-&gt;<a class="code" href="structcs__sparse.html#263a2347e8dcf1a7a20ee66730297b85">p</a> = INTEGER(GET_SLOT(x, <a class="code" href="Syms_8h.html#f08cd6c75b2da4b71c2eb605e00e94ab">Matrix_pSym</a>));
<a name="l00077"></a>00077     ans-&gt;<a class="code" href="structcs__sparse.html#0d6d06e4893a7d4d86e94ce49358d9c1">x</a> = REAL(GET_SLOT(x, <a class="code" href="Syms_8h.html#8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>));
<a name="l00078"></a>00078 
<a name="l00079"></a>00079     <span class="keywordflow">if</span>(check_Udiag &amp;&amp; ctype == 1 &amp;&amp; (*<a class="code" href="Mutils_8h.html#1e1f224c5e72ee3eb2583024db2c59e6">diag_P</a>(x) == <span class="charliteral">'U'</span>)) { <span class="comment">/* diagU2N(.) : */</span>
<a name="l00080"></a>00080         <span class="keywordtype">int</span> n = dims[0];
<a name="l00081"></a>00081         <a class="code" href="structcs__sparse.html">CSP</a> I_n = <a class="code" href="cs__utils_8c.html#3f4422610da1a3e9e7268e1843ca6de5" title="Create an identity matrix of size n as a cs struct.">csp_eye</a>(n);
<a name="l00082"></a>00082         <span class="comment">/* tmp := 1*ans + 1*eye -- result is newly allocated in cs_add(): */</span>
<a name="l00083"></a>00083         <a class="code" href="structcs__sparse.html">CSP</a> tmp = <a class="code" href="cs_8c.html#12000fbd0b9198d3852978cca8386afe">cs_add</a>(ans, I_n, 1., 1.);
<a name="l00084"></a>00084         <span class="keywordtype">int</span> nz = (tmp-&gt;<a class="code" href="structcs__sparse.html#263a2347e8dcf1a7a20ee66730297b85">p</a>)[n];
<a name="l00085"></a>00085 
<a name="l00086"></a>00086         <span class="comment">/* content(ans) := content(tmp) : */</span>
<a name="l00087"></a>00087         ans-&gt;<a class="code" href="structcs__sparse.html#ab49fc365ddf6273376a96d3a6aa751f">nzmax</a> = nz;
<a name="l00088"></a>00088         <span class="comment">/* The ans "slots" were pointers to x@ &lt;slots&gt;; all need new content now: */</span>
<a name="l00089"></a>00089         ans-&gt;<a class="code" href="structcs__sparse.html#263a2347e8dcf1a7a20ee66730297b85">p</a> = Memcpy((   <span class="keywordtype">int</span>*) R_alloc(<span class="keyword">sizeof</span>(   <span class="keywordtype">int</span>), n+1),
<a name="l00090"></a>00090                         (   <span class="keywordtype">int</span>*) tmp-&gt;<a class="code" href="structcs__sparse.html#263a2347e8dcf1a7a20ee66730297b85">p</a>, n+1);
<a name="l00091"></a>00091         ans-&gt;<a class="code" href="structcs__sparse.html#eb6831b93f8a901b4a5d520c46990f44">i</a> = Memcpy((   <span class="keywordtype">int</span>*) R_alloc(<span class="keyword">sizeof</span>(   <span class="keywordtype">int</span>), nz),
<a name="l00092"></a>00092                         (   <span class="keywordtype">int</span>*) tmp-&gt;<a class="code" href="structcs__sparse.html#eb6831b93f8a901b4a5d520c46990f44">i</a>, nz);
<a name="l00093"></a>00093         ans-&gt;<a class="code" href="structcs__sparse.html#0d6d06e4893a7d4d86e94ce49358d9c1">x</a> = Memcpy((<span class="keywordtype">double</span>*) R_alloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>), nz),
<a name="l00094"></a>00094                         (<span class="keywordtype">double</span>*) tmp-&gt;<a class="code" href="structcs__sparse.html#0d6d06e4893a7d4d86e94ce49358d9c1">x</a>, nz);
<a name="l00095"></a>00095 
<a name="l00096"></a>00096         <a class="code" href="cs_8c.html#6d705e404a7831ccf01bc0ea064215b9">cs_spfree</a>(I_n);
<a name="l00097"></a>00097         <a class="code" href="cs_8c.html#6d705e404a7831ccf01bc0ea064215b9">cs_spfree</a>(tmp);
<a name="l00098"></a>00098     }
<a name="l00099"></a>00099     <span class="keywordflow">return</span> ans;
<a name="l00100"></a>00100 }
<a name="l00101"></a>00101 
<a name="l00112"></a><a class="code" href="cs__utils_8c.html#e53880c709c9977b041217226c202deb">00112</a> SEXP <a class="code" href="cs__utils_8c.html#e53880c709c9977b041217226c202deb" title="Copy the contents of a to an appropriate CsparseMatrix object and, optionally, free...">Matrix_cs_to_SEXP</a>(<a class="code" href="structcs__sparse.html">cs</a> *a, <span class="keywordtype">char</span> *cl, <span class="keywordtype">int</span> dofree)
<a name="l00113"></a>00113 {
<a name="l00114"></a>00114     SEXP ans;
<a name="l00115"></a>00115     <span class="keywordtype">char</span> *valid[] = {<span class="stringliteral">"dgCMatrix"</span>, <span class="stringliteral">"dsCMatrix"</span>, <span class="stringliteral">"dtCMatrix"</span>, <span class="stringliteral">""</span>};
<a name="l00116"></a>00116     <span class="keywordtype">int</span> *dims, ctype = <a class="code" href="Mutils_8h.html#2206f293e563a99c83fa8480b7e26912" title="Return the 0-based index of a string match in a vector of strings terminated by an...">Matrix_check_class</a>(cl, valid), nz;
<a name="l00117"></a>00117 
<a name="l00118"></a>00118     <span class="keywordflow">if</span> (ctype &lt; 0)
<a name="l00119"></a>00119         error(<a class="code" href="Mutils_8h.html#32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">"invalid class of object to Matrix_cs_to_SEXP"</span>));
<a name="l00120"></a>00120     ans = PROTECT(NEW_OBJECT(MAKE_CLASS(cl)));
<a name="l00121"></a>00121                                 <span class="comment">/* allocate and copy common slots */</span>
<a name="l00122"></a>00122     dims = INTEGER(<a class="code" href="Mutils_8h.html#f7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and...">ALLOC_SLOT</a>(ans, <a class="code" href="Syms_8h.html#2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>, INTSXP, 2));
<a name="l00123"></a>00123     dims[0] = a-&gt;<a class="code" href="structcs__sparse.html#8aeba3ffed4d599a4906e78329d3448b">m</a>; dims[1] = a-&gt;<a class="code" href="structcs__sparse.html#86c18870dc1551c71f8ea551efe68625">n</a>;
<a name="l00124"></a>00124     Memcpy(INTEGER(<a class="code" href="Mutils_8h.html#f7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and...">ALLOC_SLOT</a>(ans, <a class="code" href="Syms_8h.html#f08cd6c75b2da4b71c2eb605e00e94ab">Matrix_pSym</a>, INTSXP, a-&gt;<a class="code" href="structcs__sparse.html#86c18870dc1551c71f8ea551efe68625">n</a> + 1)),
<a name="l00125"></a>00125            a-&gt;<a class="code" href="structcs__sparse.html#263a2347e8dcf1a7a20ee66730297b85">p</a>, a-&gt;<a class="code" href="structcs__sparse.html#86c18870dc1551c71f8ea551efe68625">n</a> + 1);
<a name="l00126"></a>00126     nz = a-&gt;<a class="code" href="structcs__sparse.html#263a2347e8dcf1a7a20ee66730297b85">p</a>[a-&gt;<a class="code" href="structcs__sparse.html#86c18870dc1551c71f8ea551efe68625">n</a>];
<a name="l00127"></a>00127     Memcpy(INTEGER(<a class="code" href="Mutils_8h.html#f7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and...">ALLOC_SLOT</a>(ans, <a class="code" href="Syms_8h.html#900b6b19a8e80b529c1a26eb9fb6156d">Matrix_iSym</a>, INTSXP, nz)), a-&gt;<a class="code" href="structcs__sparse.html#eb6831b93f8a901b4a5d520c46990f44">i</a>, nz);
<a name="l00128"></a>00128     Memcpy(REAL(<a class="code" href="Mutils_8h.html#f7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and...">ALLOC_SLOT</a>(ans, <a class="code" href="Syms_8h.html#8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>, REALSXP, nz)), a-&gt;<a class="code" href="structcs__sparse.html#0d6d06e4893a7d4d86e94ce49358d9c1">x</a>, nz);
<a name="l00129"></a>00129     <span class="keywordflow">if</span> (ctype &gt; 0) { <span class="comment">/* dsC or dtC */</span>
<a name="l00130"></a>00130         <span class="keywordtype">int</span> uplo = <a class="code" href="cs__utils_8c.html#0b2592041f5b822459b7052a451c07a5">is_sym</a>(a);
<a name="l00131"></a>00131         <span class="keywordflow">if</span> (!uplo)
<a name="l00132"></a>00132             error(<a class="code" href="Mutils_8h.html#32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">"cs matrix not compatible with class '%s'"</span>), valid[ctype]);
<a name="l00133"></a>00133         <span class="keywordflow">if</span> (ctype == 2) <span class="comment">/* dtC* */</span>
<a name="l00134"></a>00134             SET_SLOT(ans, <a class="code" href="Syms_8h.html#aaa2d2105381747118da72d6f1aba4e9">Matrix_diagSym</a>, mkString(<span class="stringliteral">"N"</span>));
<a name="l00135"></a>00135         SET_SLOT(ans, <a class="code" href="Syms_8h.html#c4fa9962123be6abbeaf9c7219b62644">Matrix_uploSym</a>, mkString(uplo &lt; 0 ? <span class="stringliteral">"L"</span> : <span class="stringliteral">"U"</span>));
<a name="l00136"></a>00136     }
<a name="l00137"></a>00137     <span class="keywordflow">if</span> (dofree &gt; 0) <a class="code" href="cs_8c.html#6d705e404a7831ccf01bc0ea064215b9">cs_spfree</a>(a);
<a name="l00138"></a>00138     <span class="keywordflow">if</span> (dofree &lt; 0) Free(a);
<a name="l00139"></a>00139     UNPROTECT(1);
<a name="l00140"></a>00140     <span class="keywordflow">return</span> ans;
<a name="l00141"></a>00141 }
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="preprocessor">#if 0                           </span><span class="comment">/* unused ------------------------------------*/</span>
<a name="l00144"></a>00144 <span class="comment">/*  -------------------------------------*/</span>
<a name="l00145"></a>00145 
<a name="l00155"></a>00155 <a class="code" href="structcs__symbolic.html">css</a> *Matrix_as_css(<a class="code" href="structcs__symbolic.html">css</a> *ans, SEXP x)
<a name="l00156"></a>00156 {
<a name="l00157"></a>00157     <span class="keywordtype">char</span> *cl = <a class="code" href="Mutils_8h.html#e692d23e2a86a20fccc024b05fc23df9">class_P</a>(x);
<a name="l00158"></a>00158         *valid[] = {<span class="stringliteral">"css_LU"</span>, <span class="stringliteral">"css_QR"</span>, <span class="stringliteral">""</span>};
<a name="l00159"></a>00159     <span class="keywordtype">int</span> *nz = INTEGER(GET_SLOT(x, install(<span class="stringliteral">"nz"</span>))),
<a name="l00160"></a>00160         ctype = <a class="code" href="Mutils_8h.html#2206f293e563a99c83fa8480b7e26912" title="Return the 0-based index of a string match in a vector of strings terminated by an...">Matrix_check_class</a>(cl, valid);
<a name="l00161"></a>00161 
<a name="l00162"></a>00162     <span class="keywordflow">if</span> (ctype &lt; 0) error(<span class="stringliteral">"invalid class of object to Matrix_as_css"</span>);
<a name="l00163"></a>00163     ans-&gt;<a class="code" href="structcs__symbolic.html#ecc57aadbdfe0598bf00fb3648fcf098">q</a> = INTEGER(GET_SLOT(x, install(<span class="stringliteral">"Q"</span>)));
<a name="l00164"></a>00164     ans-&gt;<a class="code" href="structcs__symbolic.html#6e76dde6232a98e3b5d96d942c08b12e">m2</a> = nz[0]; ans-&gt;<a class="code" href="structcs__symbolic.html#4f723af5f9ae0047f678a82a146d17b0">lnz</a> = nz[1]; ans-&gt;<a class="code" href="structcs__symbolic.html#75ba99f8c206d85c4936e11053e7f5e3">unz</a> = nz[2];
<a name="l00165"></a>00165     <span class="keywordflow">switch</span>(ctype) {
<a name="l00166"></a>00166     <span class="keywordflow">case</span> 0:                     <span class="comment">/* css_LU */</span>
<a name="l00167"></a>00167         ans-&gt;<a class="code" href="structcs__symbolic.html#4724390fc87ae2fb8f82a93ce1ddf55d">pinv</a> = (<span class="keywordtype">int</span> *) NULL;
<a name="l00168"></a>00168         ans-&gt;<a class="code" href="structcs__symbolic.html#efc6fc6ae59f5c51b225c93a549b6838">parent</a> = (<span class="keywordtype">int</span> *) NULL;
<a name="l00169"></a>00169         ans-&gt;<a class="code" href="structcs__symbolic.html#85eed6fd134282ada142ebaae0fe2403">cp</a> = (<span class="keywordtype">int</span> *) NULL;
<a name="l00170"></a>00170         <span class="keywordflow">break</span>;
<a name="l00171"></a>00171     <span class="keywordflow">case</span> 1:                     <span class="comment">/* css_QR */</span>
<a name="l00172"></a>00172         ans-&gt;<a class="code" href="structcs__symbolic.html#4724390fc87ae2fb8f82a93ce1ddf55d">pinv</a> = INTEGER(GET_SLOT(x, install(<span class="stringliteral">"Pinv"</span>)));
<a name="l00173"></a>00173         ans-&gt;<a class="code" href="structcs__symbolic.html#efc6fc6ae59f5c51b225c93a549b6838">parent</a> = INTEGER(GET_SLOT(x, install(<span class="stringliteral">"parent"</span>)));
<a name="l00174"></a>00174         ans-&gt;<a class="code" href="structcs__symbolic.html#85eed6fd134282ada142ebaae0fe2403">cp</a> = INTEGER(GET_SLOT(x, install(<span class="stringliteral">"cp"</span>)));
<a name="l00175"></a>00175         <span class="keywordflow">break</span>;
<a name="l00176"></a>00176     <span class="keywordflow">default</span>:
<a name="l00177"></a>00177         error(<span class="stringliteral">"invalid class of object to Matrix_as_css"</span>);
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179     <span class="keywordflow">return</span> ans;
<a name="l00180"></a>00180 }
<a name="l00181"></a>00181 
<a name="l00191"></a>00191 <a class="code" href="structcs__numeric.html">csn</a> *Matrix_as_csn(<a class="code" href="structcs__numeric.html">csn</a> *ans, SEXP x)
<a name="l00192"></a>00192 {
<a name="l00193"></a>00193     <span class="keywordtype">char</span> *valid[] = {<span class="stringliteral">"csn_LU"</span>, <span class="stringliteral">"csn_QR"</span>, <span class="stringliteral">""</span>};
<a name="l00194"></a>00194     <span class="keywordtype">int</span> ctype = <a class="code" href="Mutils_8h.html#2206f293e563a99c83fa8480b7e26912" title="Return the 0-based index of a string match in a vector of strings terminated by an...">Matrix_check_class</a>(<a class="code" href="Mutils_8h.html#e692d23e2a86a20fccc024b05fc23df9">class_P</a>(x), valid);
<a name="l00195"></a>00195 
<a name="l00196"></a>00196     <span class="keywordflow">if</span> (ctype &lt; 0) error(<span class="stringliteral">"invalid class of object to Matrix_as_csn"</span>);
<a name="l00197"></a>00197     ans-&gt;<a class="code" href="structcs__numeric.html#1e07204edb10064ca1e471289fced1cb">U</a> = <a class="code" href="cs__utils_8c.html#e015ca3e4a6c1b3a7265208ab035a1c7" title="Create a cs object with the contents of x.">Matrix_as_cs</a>(GET_SLOT(x, install(<span class="stringliteral">"U"</span>)));
<a name="l00198"></a>00198     ans-&gt;<a class="code" href="structcs__numeric.html#93a8cf26f01d3df51b41acc690f120d7">L</a> = <a class="code" href="cs__utils_8c.html#e015ca3e4a6c1b3a7265208ab035a1c7" title="Create a cs object with the contents of x.">Matrix_as_cs</a>(GET_SLOT(x, install(<span class="stringliteral">"L"</span>)));
<a name="l00199"></a>00199     <span class="keywordflow">switch</span>(ctype) {
<a name="l00200"></a>00200     <span class="keywordflow">case</span> 0:
<a name="l00201"></a>00201         ans-&gt;<a class="code" href="structcs__numeric.html#d81bc354670c58c7e715293e98316152">B</a> = (<span class="keywordtype">double</span>*) NULL;
<a name="l00202"></a>00202         ans-&gt;<a class="code" href="structcs__numeric.html#43298b46a89a885b6cb2a2414ace6308">pinv</a> = INTEGER(GET_SLOT(x, install(<span class="stringliteral">"Pinv"</span>)));
<a name="l00203"></a>00203         <span class="keywordflow">break</span>;
<a name="l00204"></a>00204     <span class="keywordflow">case</span> 1:
<a name="l00205"></a>00205         ans-&gt;<a class="code" href="structcs__numeric.html#d81bc354670c58c7e715293e98316152">B</a> = REAL(GET_SLOT(x, install(<span class="stringliteral">"beta"</span>)));
<a name="l00206"></a>00206         ans-&gt;<a class="code" href="structcs__numeric.html#43298b46a89a885b6cb2a2414ace6308">pinv</a> = (<span class="keywordtype">int</span>*) NULL;
<a name="l00207"></a>00207         <span class="keywordflow">break</span>;
<a name="l00208"></a>00208     <span class="keywordflow">default</span>:
<a name="l00209"></a>00209         error(<span class="stringliteral">"invalid class of object to Matrix_as_csn"</span>);
<a name="l00210"></a>00210     }
<a name="l00211"></a>00211     <span class="keywordflow">return</span> ans;
<a name="l00212"></a>00212 }
<a name="l00213"></a>00213 
<a name="l00226"></a>00226 SEXP Matrix_css_to_SEXP(<a class="code" href="structcs__symbolic.html">css</a> *S, <span class="keywordtype">char</span> *cl, <span class="keywordtype">int</span> dofree, <span class="keywordtype">int</span> m, <span class="keywordtype">int</span> n)
<a name="l00227"></a>00227 {
<a name="l00228"></a>00228     SEXP ans;
<a name="l00229"></a>00229     <span class="keywordtype">char</span> *valid[] = {<span class="stringliteral">"css_LU"</span>, <span class="stringliteral">"css_QR"</span>, <span class="stringliteral">""</span>};
<a name="l00230"></a>00230     <span class="keywordtype">int</span> *nz, ctype = <a class="code" href="Mutils_8h.html#2206f293e563a99c83fa8480b7e26912" title="Return the 0-based index of a string match in a vector of strings terminated by an...">Matrix_check_class</a>(cl, valid);
<a name="l00231"></a>00231 
<a name="l00232"></a>00232     <span class="keywordflow">if</span> (ctype &lt; 0)
<a name="l00233"></a>00233         error(<span class="stringliteral">"Inappropriate class '%s' for Matrix_css_to_SEXP"</span>, cl);
<a name="l00234"></a>00234     ans = PROTECT(NEW_OBJECT(MAKE_CLASS(cl)));
<a name="l00235"></a>00235                                 <span class="comment">/* allocate and copy common slots */</span>
<a name="l00236"></a>00236     Memcpy(INTEGER(<a class="code" href="Mutils_8h.html#f7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and...">ALLOC_SLOT</a>(ans, install(<span class="stringliteral">"Q"</span>), INTSXP, n)), S-&gt;<a class="code" href="structcs__symbolic.html#ecc57aadbdfe0598bf00fb3648fcf098">q</a>, n);
<a name="l00237"></a>00237     nz = INTEGER(<a class="code" href="Mutils_8h.html#f7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and...">ALLOC_SLOT</a>(ans, install(<span class="stringliteral">"nz"</span>), INTSXP, 3));
<a name="l00238"></a>00238     nz[0] = S-&gt;<a class="code" href="structcs__symbolic.html#6e76dde6232a98e3b5d96d942c08b12e">m2</a>; nz[1] = S-&gt;<a class="code" href="structcs__symbolic.html#4f723af5f9ae0047f678a82a146d17b0">lnz</a>; nz[2] = S-&gt;<a class="code" href="structcs__symbolic.html#75ba99f8c206d85c4936e11053e7f5e3">unz</a>;
<a name="l00239"></a>00239     <span class="keywordflow">switch</span>(ctype) {
<a name="l00240"></a>00240     <span class="keywordflow">case</span> 0:
<a name="l00241"></a>00241         <span class="keywordflow">break</span>;
<a name="l00242"></a>00242     <span class="keywordflow">case</span> 1:
<a name="l00243"></a>00243         Memcpy(INTEGER(<a class="code" href="Mutils_8h.html#f7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and...">ALLOC_SLOT</a>(ans, install(<span class="stringliteral">"Pinv"</span>), INTSXP, m)),
<a name="l00244"></a>00244                S-&gt;<a class="code" href="structcs__symbolic.html#4724390fc87ae2fb8f82a93ce1ddf55d">pinv</a>, m);
<a name="l00245"></a>00245         Memcpy(INTEGER(<a class="code" href="Mutils_8h.html#f7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and...">ALLOC_SLOT</a>(ans, install(<span class="stringliteral">"parent"</span>), INTSXP, n)),
<a name="l00246"></a>00246                S-&gt;<a class="code" href="structcs__symbolic.html#efc6fc6ae59f5c51b225c93a549b6838">parent</a>, n);
<a name="l00247"></a>00247         Memcpy(INTEGER(<a class="code" href="Mutils_8h.html#f7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and...">ALLOC_SLOT</a>(ans, install(<span class="stringliteral">"cp"</span>), INTSXP, n)),
<a name="l00248"></a>00248                S-&gt;<a class="code" href="structcs__symbolic.html#85eed6fd134282ada142ebaae0fe2403">cp</a>, n);
<a name="l00249"></a>00249         <span class="keywordflow">break</span>;
<a name="l00250"></a>00250     <span class="keywordflow">default</span>:
<a name="l00251"></a>00251         error(<span class="stringliteral">"Inappropriate class '%s' for Matrix_css_to_SEXP"</span>, cl);
<a name="l00252"></a>00252     }
<a name="l00253"></a>00253     <span class="keywordflow">if</span> (dofree &gt; 0) <a class="code" href="cs_8c.html#ce766075ef439ad6e4347f6b076eb4b7">cs_sfree</a>(S);
<a name="l00254"></a>00254     <span class="keywordflow">if</span> (dofree &lt; 0) Free(S);
<a name="l00255"></a>00255     UNPROTECT(1);
<a name="l00256"></a>00256     <span class="keywordflow">return</span> ans;
<a name="l00257"></a>00257 }
<a name="l00258"></a>00258 
<a name="l00269"></a>00269 SEXP Matrix_csn_to_SEXP(<a class="code" href="structcs__numeric.html">csn</a> *N, <span class="keywordtype">char</span> *cl, <span class="keywordtype">int</span> dofree)
<a name="l00270"></a>00270 {
<a name="l00271"></a>00271     SEXP ans;
<a name="l00272"></a>00272     <span class="keywordtype">char</span> *valid[] = {<span class="stringliteral">"csn_LU"</span>, <span class="stringliteral">"csn_QR"</span>, <span class="stringliteral">""</span>};
<a name="l00273"></a>00273     <span class="keywordtype">int</span> ctype = <a class="code" href="Mutils_8h.html#2206f293e563a99c83fa8480b7e26912" title="Return the 0-based index of a string match in a vector of strings terminated by an...">Matrix_check_class</a>(cl, valid), n = (N-&gt;<a class="code" href="structcs__numeric.html#1e07204edb10064ca1e471289fced1cb">U</a>)-&gt;n;
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     <span class="keywordflow">if</span> (ctype &lt; 0)
<a name="l00276"></a>00276         error(<span class="stringliteral">"Inappropriate class '%s' for Matrix_csn_to_SEXP"</span>, cl);
<a name="l00277"></a>00277     ans = PROTECT(NEW_OBJECT(MAKE_CLASS(cl)));
<a name="l00278"></a>00278                                 <span class="comment">/* allocate and copy common slots */</span>
<a name="l00279"></a>00279     <span class="comment">/* FIXME: Use the triangular matrix classes for csn_LU */</span>
<a name="l00280"></a>00280     SET_SLOT(ans, install(<span class="stringliteral">"L"</span>), <span class="comment">/* these are free'd later if requested */</span>
<a name="l00281"></a>00281              <a class="code" href="cs__utils_8c.html#e53880c709c9977b041217226c202deb" title="Copy the contents of a to an appropriate CsparseMatrix object and, optionally, free...">Matrix_cs_to_SEXP</a>(N-&gt;<a class="code" href="structcs__numeric.html#93a8cf26f01d3df51b41acc690f120d7">L</a>, <span class="stringliteral">"dgCMatrix"</span>, 0));
<a name="l00282"></a>00282     SET_SLOT(ans, install(<span class="stringliteral">"U"</span>),
<a name="l00283"></a>00283              <a class="code" href="cs__utils_8c.html#e53880c709c9977b041217226c202deb" title="Copy the contents of a to an appropriate CsparseMatrix object and, optionally, free...">Matrix_cs_to_SEXP</a>(N-&gt;<a class="code" href="structcs__numeric.html#1e07204edb10064ca1e471289fced1cb">U</a>, <span class="stringliteral">"dgCMatrix"</span>, 0));
<a name="l00284"></a>00284     <span class="keywordflow">switch</span>(ctype) {
<a name="l00285"></a>00285     <span class="keywordflow">case</span> 0:
<a name="l00286"></a>00286         Memcpy(INTEGER(<a class="code" href="Mutils_8h.html#f7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and...">ALLOC_SLOT</a>(ans, install(<span class="stringliteral">"Pinv"</span>), INTSXP, n)),
<a name="l00287"></a>00287                N-&gt;<a class="code" href="structcs__numeric.html#43298b46a89a885b6cb2a2414ace6308">pinv</a>, n);
<a name="l00288"></a>00288         <span class="keywordflow">break</span>;
<a name="l00289"></a>00289     <span class="keywordflow">case</span> 1:
<a name="l00290"></a>00290         Memcpy(REAL(<a class="code" href="Mutils_8h.html#f7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and...">ALLOC_SLOT</a>(ans, install(<span class="stringliteral">"beta"</span>), REALSXP, n)),
<a name="l00291"></a>00291                N-&gt;<a class="code" href="structcs__numeric.html#d81bc354670c58c7e715293e98316152">B</a>, n);
<a name="l00292"></a>00292         <span class="keywordflow">break</span>;
<a name="l00293"></a>00293     <span class="keywordflow">default</span>:
<a name="l00294"></a>00294         error(<span class="stringliteral">"Inappropriate class '%s' for Matrix_csn_to_SEXP"</span>, cl);
<a name="l00295"></a>00295     }
<a name="l00296"></a>00296     <span class="keywordflow">if</span> (dofree &gt; 0) <a class="code" href="cs_8c.html#f2e6d75dfc24a842fdbce3aa510dc4bc">cs_nfree</a>(N);
<a name="l00297"></a>00297     <span class="keywordflow">if</span> (dofree &lt; 0) {
<a name="l00298"></a>00298         Free(N-&gt;<a class="code" href="structcs__numeric.html#93a8cf26f01d3df51b41acc690f120d7">L</a>); Free(N-&gt;<a class="code" href="structcs__numeric.html#1e07204edb10064ca1e471289fced1cb">U</a>); Free(N);
<a name="l00299"></a>00299     }
<a name="l00300"></a>00300     UNPROTECT(1);
<a name="l00301"></a>00301     <span class="keywordflow">return</span> ans;
<a name="l00302"></a>00302 }
<a name="l00303"></a>00303 
<a name="l00304"></a>00304 <span class="preprocessor">#endif  </span><span class="comment">/* unused */</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Sep 12 17:21:57 2008 for Matrix by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
