<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Matrix: dppMatrix.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<h1>dppMatrix.c</h1><a href="dppMatrix_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include "<a class="code" href="dppMatrix_8h.html">dppMatrix.h</a>"</span>
<a name="l00002"></a>00002 
<a name="l00003"></a><a class="code" href="dppMatrix_8h.html#dceeac591946010377701a9225191e47">00003</a> SEXP <a class="code" href="dppMatrix_8c.html#dceeac591946010377701a9225191e47">dppMatrix_validate</a>(SEXP obj)
<a name="l00004"></a>00004 {
<a name="l00005"></a>00005 <span class="comment">/*     int i, n = INTEGER(GET_SLOT(obj, Matrix_DimSym))[0]; */</span>
<a name="l00006"></a>00006 <span class="comment">/*     double *x = REAL(GET_SLOT(obj, Matrix_xSym)); */</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008     <span class="comment">/* quick but nondefinitive check on positive definiteness */</span>
<a name="l00009"></a>00009 <span class="comment">/*     for (i = 0; i &lt; n; i++) */</span>
<a name="l00010"></a>00010 <span class="comment">/*      if (x[i * np1] &lt; 0) */</span>
<a name="l00011"></a>00011 <span class="comment">/*          return mkString(_("dppMatrix is not positive definite")); */</span>
<a name="l00012"></a>00012     <span class="keywordflow">return</span> <a class="code" href="dspMatrix_8c.html#d80747112d9a6358e2dcb86b319bbaec">dspMatrix_validate</a>(obj);
<a name="l00013"></a>00013 }
<a name="l00014"></a>00014 
<a name="l00015"></a><a class="code" href="dppMatrix_8h.html#6111600bf96735d9b39d5bc193203b31">00015</a> SEXP <a class="code" href="dppMatrix_8c.html#6111600bf96735d9b39d5bc193203b31">dppMatrix_chol</a>(SEXP x)
<a name="l00016"></a>00016 {
<a name="l00017"></a>00017     SEXP val = <a class="code" href="Mutils_8c.html#c8a9910ab35d85d32c6801477c2e6622">get_factors</a>(x, <span class="stringliteral">"pCholesky"</span>),
<a name="l00018"></a>00018         dimP = GET_SLOT(x, <a class="code" href="Syms_8h.html#2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>),
<a name="l00019"></a>00019         uploP = GET_SLOT(x, <a class="code" href="Syms_8h.html#c4fa9962123be6abbeaf9c7219b62644">Matrix_uploSym</a>);
<a name="l00020"></a>00020     <span class="keyword">const</span> <span class="keywordtype">char</span> *uplo = CHAR(STRING_ELT(uploP, 0));
<a name="l00021"></a>00021     <span class="keywordtype">int</span> *dims = INTEGER(dimP), info;
<a name="l00022"></a>00022 
<a name="l00023"></a>00023     <span class="keywordflow">if</span> (val != R_NilValue) <span class="keywordflow">return</span> val;
<a name="l00024"></a>00024     dims = INTEGER(dimP);
<a name="l00025"></a>00025     val = PROTECT(NEW_OBJECT(MAKE_CLASS(<span class="stringliteral">"pCholesky"</span>)));
<a name="l00026"></a>00026     SET_SLOT(val, <a class="code" href="Syms_8h.html#c4fa9962123be6abbeaf9c7219b62644">Matrix_uploSym</a>, duplicate(uploP));
<a name="l00027"></a>00027     SET_SLOT(val, <a class="code" href="Syms_8h.html#aaa2d2105381747118da72d6f1aba4e9">Matrix_diagSym</a>, mkString(<span class="stringliteral">"N"</span>));
<a name="l00028"></a>00028     SET_SLOT(val, <a class="code" href="Syms_8h.html#2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>, duplicate(dimP));
<a name="l00029"></a>00029     <a class="code" href="Mutils_8h.html#36a9a730e1a12cbe017064fe140aefd2">slot_dup</a>(val, x, <a class="code" href="Syms_8h.html#8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>);
<a name="l00030"></a>00030     F77_CALL(dpptrf)(uplo, dims, REAL(GET_SLOT(val, <a class="code" href="Syms_8h.html#8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>)), &amp;info);
<a name="l00031"></a>00031     <span class="keywordflow">if</span> (info) {
<a name="l00032"></a>00032         <span class="keywordflow">if</span>(info &gt; 0) <span class="comment">/* e.g. x singular */</span>
<a name="l00033"></a>00033             error(<a class="code" href="Mutils_8h.html#32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">"the leading minor of order %d is not positive definite"</span>),
<a name="l00034"></a>00034                     info);
<a name="l00035"></a>00035         <span class="keywordflow">else</span> <span class="comment">/* should never happen! */</span>
<a name="l00036"></a>00036             error(<a class="code" href="Mutils_8h.html#32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">"Lapack routine %s returned error code %d"</span>), <span class="stringliteral">"dpptrf"</span>, info);
<a name="l00037"></a>00037     }
<a name="l00038"></a>00038     UNPROTECT(1);
<a name="l00039"></a>00039     <span class="keywordflow">return</span> <a class="code" href="Mutils_8c.html#cb9e30480c757f0c780a5d94853b7284">set_factors</a>(x, val, <span class="stringliteral">"pCholesky"</span>);
<a name="l00040"></a>00040 }
<a name="l00041"></a>00041 
<a name="l00042"></a><a class="code" href="dppMatrix_8h.html#192a0f023f8f371c79a98364ac64dfb7">00042</a> SEXP <a class="code" href="dppMatrix_8c.html#192a0f023f8f371c79a98364ac64dfb7">dppMatrix_rcond</a>(SEXP obj, SEXP type)
<a name="l00043"></a>00043 {
<a name="l00044"></a>00044     SEXP Chol = <a class="code" href="dppMatrix_8c.html#6111600bf96735d9b39d5bc193203b31">dppMatrix_chol</a>(obj);
<a name="l00045"></a>00045     <span class="keywordtype">char</span> typnm[] = {<span class="charliteral">'O'</span>, <span class="charliteral">'\0'</span>}; <span class="comment">/* always use the one norm */</span>
<a name="l00046"></a>00046     <span class="keywordtype">int</span> *dims = INTEGER(GET_SLOT(Chol, <a class="code" href="Syms_8h.html#2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>)), info;
<a name="l00047"></a>00047     <span class="keywordtype">double</span> anorm = <a class="code" href="dppMatrix_8h.html#2a8d63739f02971700f3a26bffe3ba52">get_norm_sp</a>(obj, typnm), rcond;
<a name="l00048"></a>00048 
<a name="l00049"></a>00049     F77_CALL(dppcon)(<a class="code" href="Mutils_8h.html#3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a>(Chol), dims,
<a name="l00050"></a>00050                      REAL(GET_SLOT(Chol, <a class="code" href="Syms_8h.html#8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>)), &amp;anorm, &amp;rcond,
<a name="l00051"></a>00051                      (<span class="keywordtype">double</span> *) R_alloc(3*dims[0], <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)),
<a name="l00052"></a>00052                      (<span class="keywordtype">int</span> *) R_alloc(dims[0], <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)), &amp;info);
<a name="l00053"></a>00053     <span class="keywordflow">return</span> ScalarReal(rcond);
<a name="l00054"></a>00054 }
<a name="l00055"></a>00055 
<a name="l00056"></a><a class="code" href="dppMatrix_8h.html#1b051e90cad1589623960a42821aae55">00056</a> SEXP <a class="code" href="dppMatrix_8c.html#55cb1fff8ff406d10f326c15379eec75">dppMatrix_solve</a>(SEXP x)
<a name="l00057"></a>00057 {
<a name="l00058"></a>00058     SEXP Chol = <a class="code" href="dppMatrix_8c.html#6111600bf96735d9b39d5bc193203b31">dppMatrix_chol</a>(x);
<a name="l00059"></a>00059     SEXP val = PROTECT(NEW_OBJECT(MAKE_CLASS(<span class="stringliteral">"dppMatrix"</span>)));
<a name="l00060"></a>00060     <span class="keywordtype">int</span> *dims = INTEGER(GET_SLOT(x, <a class="code" href="Syms_8h.html#2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>)), info;
<a name="l00061"></a>00061 
<a name="l00062"></a>00062     <a class="code" href="Mutils_8h.html#36a9a730e1a12cbe017064fe140aefd2">slot_dup</a>(val, Chol, <a class="code" href="Syms_8h.html#c4fa9962123be6abbeaf9c7219b62644">Matrix_uploSym</a>);
<a name="l00063"></a>00063     <a class="code" href="Mutils_8h.html#36a9a730e1a12cbe017064fe140aefd2">slot_dup</a>(val, Chol, <a class="code" href="Syms_8h.html#8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>);
<a name="l00064"></a>00064     <a class="code" href="Mutils_8h.html#36a9a730e1a12cbe017064fe140aefd2">slot_dup</a>(val, Chol, <a class="code" href="Syms_8h.html#2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>);
<a name="l00065"></a>00065     F77_CALL(dpptri)(<a class="code" href="Mutils_8h.html#3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a>(val), dims,
<a name="l00066"></a>00066                      REAL(GET_SLOT(val, <a class="code" href="Syms_8h.html#8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>)), &amp;info);
<a name="l00067"></a>00067     UNPROTECT(1);
<a name="l00068"></a>00068     <span class="keywordflow">return</span> val;
<a name="l00069"></a>00069 }
<a name="l00070"></a>00070 
<a name="l00071"></a><a class="code" href="dppMatrix_8h.html#0b9f86379aec800872a5267229a7b400">00071</a> SEXP <a class="code" href="dppMatrix_8c.html#0b9f86379aec800872a5267229a7b400">dppMatrix_matrix_solve</a>(SEXP a, SEXP b)
<a name="l00072"></a>00072 {
<a name="l00073"></a>00073     SEXP val = PROTECT(<a class="code" href="Mutils_8c.html#574d0797f3bfb4cb555038c8d90cceb8">dup_mMatrix_as_dgeMatrix</a>(b));
<a name="l00074"></a>00074     SEXP Chol = <a class="code" href="dppMatrix_8c.html#6111600bf96735d9b39d5bc193203b31">dppMatrix_chol</a>(a);
<a name="l00075"></a>00075     <span class="keywordtype">int</span> *adims = INTEGER(GET_SLOT(a, <a class="code" href="Syms_8h.html#2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>)),
<a name="l00076"></a>00076         *bdims = INTEGER(GET_SLOT(val, <a class="code" href="Syms_8h.html#2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>));
<a name="l00077"></a>00077     <span class="keywordtype">int</span> n = bdims[0], nrhs = bdims[1], info;
<a name="l00078"></a>00078 
<a name="l00079"></a>00079     <span class="keywordflow">if</span> (*adims != *bdims || bdims[1] &lt; 1 || *adims &lt; 1)
<a name="l00080"></a>00080         error(<a class="code" href="Mutils_8h.html#32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">"Dimensions of system to be solved are inconsistent"</span>));
<a name="l00081"></a>00081     F77_CALL(dpptrs)(<a class="code" href="Mutils_8h.html#3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a>(Chol), &amp;n, &amp;nrhs,
<a name="l00082"></a>00082                      REAL(GET_SLOT(Chol, <a class="code" href="Syms_8h.html#8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>)),
<a name="l00083"></a>00083                      REAL(GET_SLOT(val, <a class="code" href="Syms_8h.html#8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>)), &amp;n, &amp;info);
<a name="l00084"></a>00084     UNPROTECT(1);
<a name="l00085"></a>00085     <span class="keywordflow">return</span> val;
<a name="l00086"></a>00086 }
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Sun Jan 13 09:53:02 2008 for Matrix by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
