<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Matrix: dpoMatrix.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<h1>dpoMatrix.c</h1><a href="dpoMatrix_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include "<a class="code" href="dpoMatrix_8h.html">dpoMatrix.h</a>"</span>
<a name="l00002"></a>00002 
<a name="l00003"></a><a class="code" href="dpoMatrix_8h.html#96fe5b5c27dd647e5edf245601bba7ac">00003</a> SEXP <a class="code" href="dpoMatrix_8c.html#96fe5b5c27dd647e5edf245601bba7ac">dpoMatrix_validate</a>(SEXP obj)
<a name="l00004"></a>00004 {
<a name="l00005"></a>00005     <span class="keywordtype">int</span> i, n = INTEGER(GET_SLOT(obj, <a class="code" href="Syms_8h.html#2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>))[0];
<a name="l00006"></a>00006     <span class="keywordtype">int</span> np1 = n + 1;
<a name="l00007"></a>00007     <span class="keywordtype">double</span> *x = REAL(GET_SLOT(obj, <a class="code" href="Syms_8h.html#8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>));
<a name="l00008"></a>00008 
<a name="l00009"></a>00009     <span class="comment">/* quick but nondefinitive check on positive definiteness */</span>
<a name="l00010"></a>00010     <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l00011"></a>00011         <span class="keywordflow">if</span> (x[i * np1] &lt; 0)
<a name="l00012"></a>00012             <span class="keywordflow">return</span> mkString(<a class="code" href="Mutils_8h.html#32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">"dpoMatrix is not positive definite"</span>));
<a name="l00013"></a>00013     <span class="keywordflow">return</span> ScalarLogical(1);
<a name="l00014"></a>00014 }
<a name="l00015"></a>00015 
<a name="l00016"></a><a class="code" href="dpoMatrix_8h.html#a951f7c9871735266da55e7d92a6ae58">00016</a> SEXP <a class="code" href="dpoMatrix_8c.html#a951f7c9871735266da55e7d92a6ae58">dpoMatrix_chol</a>(SEXP x)
<a name="l00017"></a>00017 {
<a name="l00018"></a>00018     SEXP val = <a class="code" href="Mutils_8c.html#c8a9910ab35d85d32c6801477c2e6622">get_factors</a>(x, <span class="stringliteral">"Cholesky"</span>),
<a name="l00019"></a>00019         dimP = GET_SLOT(x, <a class="code" href="Syms_8h.html#2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>),
<a name="l00020"></a>00020         uploP = GET_SLOT(x, <a class="code" href="Syms_8h.html#c4fa9962123be6abbeaf9c7219b62644">Matrix_uploSym</a>);
<a name="l00021"></a>00021     <span class="keyword">const</span> <span class="keywordtype">char</span> *uplo = CHAR(STRING_ELT(uploP, 0));
<a name="l00022"></a>00022     <span class="keywordtype">int</span> *dims = INTEGER(dimP), info;
<a name="l00023"></a>00023     <span class="keywordtype">int</span> n = dims[0];
<a name="l00024"></a>00024     <span class="keywordtype">double</span> *vx;
<a name="l00025"></a>00025 
<a name="l00026"></a>00026     <span class="keywordflow">if</span> (val != R_NilValue) <span class="keywordflow">return</span> val;
<a name="l00027"></a>00027     dims = INTEGER(dimP);
<a name="l00028"></a>00028     val = PROTECT(NEW_OBJECT(MAKE_CLASS(<span class="stringliteral">"Cholesky"</span>)));
<a name="l00029"></a>00029     SET_SLOT(val, <a class="code" href="Syms_8h.html#c4fa9962123be6abbeaf9c7219b62644">Matrix_uploSym</a>, duplicate(uploP));
<a name="l00030"></a>00030     SET_SLOT(val, <a class="code" href="Syms_8h.html#aaa2d2105381747118da72d6f1aba4e9">Matrix_diagSym</a>, mkString(<span class="stringliteral">"N"</span>));
<a name="l00031"></a>00031     SET_SLOT(val, <a class="code" href="Syms_8h.html#2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>, duplicate(dimP));
<a name="l00032"></a>00032     vx = REAL(<a class="code" href="Mutils_8h.html#f7f59236ca18ab52131cf71f4a7b0786" title="Allocate an SEXP of given type and length, assign it as slot nm in the object, and...">ALLOC_SLOT</a>(val, <a class="code" href="Syms_8h.html#8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>, REALSXP, n * n));
<a name="l00033"></a>00033     <a class="code" href="Mutils_8h.html#8388ab26cceddaa6efaccc3c51add430">AZERO</a>(vx, n * n);
<a name="l00034"></a>00034     F77_CALL(dlacpy)(uplo, &amp;n, &amp;n, REAL(GET_SLOT(x, <a class="code" href="Syms_8h.html#8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>)), &amp;n, vx, &amp;n);
<a name="l00035"></a>00035     <span class="keywordflow">if</span> (n &gt; 0) {
<a name="l00036"></a>00036         F77_CALL(dpotrf)(uplo, &amp;n, vx, &amp;n, &amp;info);
<a name="l00037"></a>00037         <span class="keywordflow">if</span> (info) {
<a name="l00038"></a>00038             <span class="keywordflow">if</span>(info &gt; 0)
<a name="l00039"></a>00039                 error(<a class="code" href="Mutils_8h.html#32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">"the leading minor of order %d is not positive definite"</span>),
<a name="l00040"></a>00040                       info);
<a name="l00041"></a>00041             <span class="keywordflow">else</span> <span class="comment">/* should never happen! */</span>
<a name="l00042"></a>00042                 error(<a class="code" href="Mutils_8h.html#32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">"Lapack routine %s returned error code %d"</span>), <span class="stringliteral">"dpotrf"</span>, info);
<a name="l00043"></a>00043         }
<a name="l00044"></a>00044     }
<a name="l00045"></a>00045     UNPROTECT(1);
<a name="l00046"></a>00046     <span class="keywordflow">return</span> <a class="code" href="Mutils_8c.html#cb9e30480c757f0c780a5d94853b7284">set_factors</a>(x, val, <span class="stringliteral">"Cholesky"</span>);
<a name="l00047"></a>00047 }
<a name="l00048"></a>00048 
<a name="l00049"></a><a class="code" href="dpoMatrix_8h.html#e4b3c6190a4d12048befb3d3110c2377">00049</a> SEXP <a class="code" href="dpoMatrix_8c.html#e4b3c6190a4d12048befb3d3110c2377">dpoMatrix_rcond</a>(SEXP obj, SEXP type)
<a name="l00050"></a>00050 {
<a name="l00051"></a>00051     SEXP Chol = <a class="code" href="dpoMatrix_8c.html#a951f7c9871735266da55e7d92a6ae58">dpoMatrix_chol</a>(obj);
<a name="l00052"></a>00052     <span class="keyword">const</span> <span class="keywordtype">char</span> typnm[] = {<span class="charliteral">'O'</span>, <span class="charliteral">'\0'</span>};   <span class="comment">/* always use the one norm */</span>
<a name="l00053"></a>00053     <span class="keywordtype">int</span> *dims = INTEGER(GET_SLOT(Chol, <a class="code" href="Syms_8h.html#2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>)), info;
<a name="l00054"></a>00054     <span class="keywordtype">double</span> anorm = <a class="code" href="dpoMatrix_8h.html#886569af93c91d1856c961323c5d6bce">get_norm_sy</a>(obj, typnm), rcond;
<a name="l00055"></a>00055 
<a name="l00056"></a>00056     F77_CALL(dpocon)(<a class="code" href="Mutils_8h.html#3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a>(Chol),
<a name="l00057"></a>00057                      dims, REAL(GET_SLOT(Chol, <a class="code" href="Syms_8h.html#8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>)),
<a name="l00058"></a>00058                      dims, &amp;anorm, &amp;rcond,
<a name="l00059"></a>00059                      (<span class="keywordtype">double</span> *) R_alloc(3*dims[0], <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)),
<a name="l00060"></a>00060                      (<span class="keywordtype">int</span> *) R_alloc(dims[0], <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)), &amp;info);
<a name="l00061"></a>00061     <span class="keywordflow">return</span> ScalarReal(rcond);
<a name="l00062"></a>00062 }
<a name="l00063"></a>00063 
<a name="l00064"></a><a class="code" href="dpoMatrix_8h.html#cc9a68e6726285aaea483c6652019d47">00064</a> SEXP <a class="code" href="dpoMatrix_8c.html#faf79f203cef9efe99b56fce8e53c667">dpoMatrix_solve</a>(SEXP x)
<a name="l00065"></a>00065 {
<a name="l00066"></a>00066     SEXP Chol = <a class="code" href="dpoMatrix_8c.html#a951f7c9871735266da55e7d92a6ae58">dpoMatrix_chol</a>(x);
<a name="l00067"></a>00067     SEXP val = PROTECT(NEW_OBJECT(MAKE_CLASS(<span class="stringliteral">"dpoMatrix"</span>)));
<a name="l00068"></a>00068     <span class="keywordtype">int</span> *dims = INTEGER(GET_SLOT(x, <a class="code" href="Syms_8h.html#2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>)), info;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     SET_SLOT(val, <a class="code" href="Syms_8h.html#4b5b55e9543500874053fafea7b81e52">Matrix_factorSym</a>, allocVector(VECSXP, 0));
<a name="l00071"></a>00071     <a class="code" href="Mutils_8h.html#36a9a730e1a12cbe017064fe140aefd2">slot_dup</a>(val, Chol, <a class="code" href="Syms_8h.html#c4fa9962123be6abbeaf9c7219b62644">Matrix_uploSym</a>);
<a name="l00072"></a>00072     <a class="code" href="Mutils_8h.html#36a9a730e1a12cbe017064fe140aefd2">slot_dup</a>(val, Chol, <a class="code" href="Syms_8h.html#8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>);
<a name="l00073"></a>00073     <a class="code" href="Mutils_8h.html#36a9a730e1a12cbe017064fe140aefd2">slot_dup</a>(val, Chol, <a class="code" href="Syms_8h.html#2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>);
<a name="l00074"></a>00074     SET_SLOT(val, <a class="code" href="Syms_8h.html#93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>,
<a name="l00075"></a>00075              duplicate(GET_SLOT(x, <a class="code" href="Syms_8h.html#93d8b8a3cd9c897599b3e2d996821a0b">Matrix_DimNamesSym</a>)));
<a name="l00076"></a>00076     F77_CALL(dpotri)(<a class="code" href="Mutils_8h.html#3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a>(val), dims,
<a name="l00077"></a>00077                      REAL(GET_SLOT(val, <a class="code" href="Syms_8h.html#8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>)), dims, &amp;info);
<a name="l00078"></a>00078     UNPROTECT(1);
<a name="l00079"></a>00079     <span class="keywordflow">return</span> val;
<a name="l00080"></a>00080 }
<a name="l00081"></a>00081 
<a name="l00082"></a><a class="code" href="dpoMatrix_8h.html#6fdf4fea856fcb48318714aaa43375d5">00082</a> SEXP <a class="code" href="dpoMatrix_8c.html#6fdf4fea856fcb48318714aaa43375d5">dpoMatrix_dgeMatrix_solve</a>(SEXP a, SEXP b)
<a name="l00083"></a>00083 {
<a name="l00084"></a>00084     SEXP Chol = <a class="code" href="dpoMatrix_8c.html#a951f7c9871735266da55e7d92a6ae58">dpoMatrix_chol</a>(a),
<a name="l00085"></a>00085         val = PROTECT(NEW_OBJECT(MAKE_CLASS(<span class="stringliteral">"dgeMatrix"</span>)));
<a name="l00086"></a>00086     <span class="keywordtype">int</span> *adims = INTEGER(GET_SLOT(a, <a class="code" href="Syms_8h.html#2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>)),
<a name="l00087"></a>00087         *bdims = INTEGER(GET_SLOT(b, <a class="code" href="Syms_8h.html#2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>)),
<a name="l00088"></a>00088         info;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090     <span class="keywordflow">if</span> (adims[1] != bdims[0])
<a name="l00091"></a>00091         error(<a class="code" href="Mutils_8h.html#32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">"Dimensions of system to be solved are inconsistent"</span>));
<a name="l00092"></a>00092     <span class="keywordflow">if</span> (adims[0] &lt; 1 || bdims[1] &lt; 1)
<a name="l00093"></a>00093         error(<a class="code" href="Mutils_8h.html#32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">"Cannot solve() for matrices with zero extents"</span>));
<a name="l00094"></a>00094     SET_SLOT(val, <a class="code" href="Syms_8h.html#4b5b55e9543500874053fafea7b81e52">Matrix_factorSym</a>, allocVector(VECSXP, 0));
<a name="l00095"></a>00095     <a class="code" href="Mutils_8h.html#36a9a730e1a12cbe017064fe140aefd2">slot_dup</a>(val, b, <a class="code" href="Syms_8h.html#2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>);
<a name="l00096"></a>00096     <a class="code" href="Mutils_8h.html#36a9a730e1a12cbe017064fe140aefd2">slot_dup</a>(val, b, <a class="code" href="Syms_8h.html#8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>);
<a name="l00097"></a>00097     F77_CALL(dpotrs)(<a class="code" href="Mutils_8h.html#3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a>(Chol), adims, bdims + 1,
<a name="l00098"></a>00098                      REAL(GET_SLOT(Chol, <a class="code" href="Syms_8h.html#8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>)), adims,
<a name="l00099"></a>00099                      REAL(GET_SLOT(val, <a class="code" href="Syms_8h.html#8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>)),
<a name="l00100"></a>00100                      bdims, &amp;info);
<a name="l00101"></a>00101     UNPROTECT(1);
<a name="l00102"></a>00102     <span class="keywordflow">return</span> val;
<a name="l00103"></a>00103 }
<a name="l00104"></a>00104 
<a name="l00105"></a><a class="code" href="dpoMatrix_8h.html#915278646a8dc39fbffe059c53d19569">00105</a> SEXP <a class="code" href="dpoMatrix_8c.html#915278646a8dc39fbffe059c53d19569">dpoMatrix_matrix_solve</a>(SEXP a, SEXP b)
<a name="l00106"></a>00106 {
<a name="l00107"></a>00107     SEXP Chol = <a class="code" href="dpoMatrix_8c.html#a951f7c9871735266da55e7d92a6ae58">dpoMatrix_chol</a>(a),
<a name="l00108"></a>00108         val = PROTECT(duplicate(b));
<a name="l00109"></a>00109     <span class="keywordtype">int</span> *adims = INTEGER(GET_SLOT(a, <a class="code" href="Syms_8h.html#2b91d011a529c5665e032a6565275374">Matrix_DimSym</a>)),
<a name="l00110"></a>00110         *bdims = INTEGER(getAttrib(b, R_DimSymbol)),
<a name="l00111"></a>00111         info;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113     <span class="keywordflow">if</span> (!(isReal(b) &amp;&amp; isMatrix(b)))
<a name="l00114"></a>00114         error(<a class="code" href="Mutils_8h.html#32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">"Argument b must be a numeric matrix"</span>));
<a name="l00115"></a>00115     <span class="keywordflow">if</span> (*adims != *bdims || bdims[1] &lt; 1 || *adims &lt; 1)
<a name="l00116"></a>00116         error(<a class="code" href="Mutils_8h.html#32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">"Dimensions of system to be solved are inconsistent"</span>));
<a name="l00117"></a>00117     F77_CALL(dpotrs)(<a class="code" href="Mutils_8h.html#3a43f83d21f80a9d484da9f2731f76d2">uplo_P</a>(Chol), adims, bdims + 1,
<a name="l00118"></a>00118                      REAL(GET_SLOT(Chol, <a class="code" href="Syms_8h.html#8e6ccf1b89de0c7d61722fd1579eb085">Matrix_xSym</a>)), adims,
<a name="l00119"></a>00119                      REAL(val), bdims, &amp;info);
<a name="l00120"></a>00120     UNPROTECT(1);
<a name="l00121"></a>00121     <span class="keywordflow">return</span> val;
<a name="l00122"></a>00122 }
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Sun Jan 13 09:53:01 2008 for Matrix by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
